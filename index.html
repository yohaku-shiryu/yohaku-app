<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="‰ΩôÁôΩ">
    <meta name="theme-color" content="#0d0d14">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="manifest" href="manifest.json">
    <title>‰ΩôÁôΩ 2026</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@300;400;500;700&family=Noto+Serif+JP:wght@300;400;500;600&family=Cormorant+Garamond:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Light Mode (Default - Day) */
            --bg-primary: #faf9f7;
            --bg-secondary: #f5f4f2;
            --bg-card: #ffffff;
            --bg-card-hover: #f8f7f5;
            --text-primary: #1a1a1a;
            --text-secondary: #4a4a4a;
            --text-muted: #8a8a8a;
            --accent-gold: #c4956a;
            --accent-gold-dim: rgba(196, 149, 106, 0.12);
            --accent-sage: #6b8f71;
            --accent-sage-dim: rgba(107, 143, 113, 0.12);
            --accent-blue: #5a7d9a;
            --accent-blue-dim: rgba(90, 125, 154, 0.12);
            --accent-rose: #b07878;
            --border-subtle: rgba(0, 0, 0, 0.06);
            --border-medium: rgba(0, 0, 0, 0.1);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.06);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 28px;
            --font-sans: 'Zen Kaku Gothic New', sans-serif;
            --font-serif: 'Noto Serif JP', serif;
            --font-display: 'Cormorant Garamond', serif;
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }
        
        [data-theme="dark"] {
            --bg-primary: #0d0d14;
            --bg-secondary: #151520;
            --bg-card: #1a1a28;
            --bg-card-hover: #22222f;
            --text-primary: #f8f0e3;
            --text-secondary: #a8a4a0;
            --text-muted: #6b6b70;
            --accent-gold: #d4a574;
            --accent-gold-dim: rgba(212, 165, 116, 0.15);
            --accent-sage: #8fa68a;
            --accent-sage-dim: rgba(143, 166, 138, 0.15);
            --accent-blue: #7d9db7;
            --accent-blue-dim: rgba(125, 157, 183, 0.15);
            --accent-rose: #c49191;
            --border-subtle: rgba(248, 240, 227, 0.08);
            --border-medium: rgba(248, 240, 227, 0.12);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.2);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; overflow: hidden; }
        body { 
            font-family: var(--font-sans); 
            background: var(--bg-primary); 
            color: var(--text-primary); 
            line-height: 1.7; 
            font-weight: 300;
            transition: background 0.5s ease, color 0.5s ease;
        }
        .app { 
            height: 100%; 
            display: flex; 
            flex-direction: column; 
            max-width: 480px; 
            margin: 0 auto; 
            background: var(--bg-primary);
            transition: background 0.5s ease;
        }
        
        /* Header */
        .header { 
            padding: calc(var(--safe-top) + 12px) 20px 16px; 
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-subtle); 
            position: relative; 
            z-index: 100;
            transition: background 0.5s ease;
        }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .logo { font-family: var(--font-serif); font-size: 26px; font-weight: 400; color: var(--text-primary); letter-spacing: 0.15em; }
        .logo span { color: var(--accent-gold); font-size: 10px; vertical-align: super; margin-left: 4px; }
        .header-actions { display: flex; gap: 8px; }
        .header-btn { 
            background: var(--bg-card); 
            border: 1px solid var(--border-subtle); 
            color: var(--text-secondary); 
            padding: 8px; 
            border-radius: 50%; 
            cursor: pointer; 
            transition: all 0.2s;
            box-shadow: var(--shadow-sm);
        }
        .header-btn:hover { background: var(--bg-card-hover); color: var(--accent-gold); }
        .header-btn svg { width: 20px; height: 20px; display: block; }
        .date-nav { display: flex; align-items: center; justify-content: center; gap: 16px; }
        .date-nav button { background: none; border: none; color: var(--text-secondary); padding: 8px; cursor: pointer; border-radius: 50%; transition: all 0.2s; }
        .date-nav button:hover { background: var(--border-subtle); color: var(--text-primary); }
        .date-nav button svg { width: 20px; height: 20px; display: block; }
        .current-date { font-family: var(--font-serif); font-size: 15px; color: var(--text-primary); cursor: pointer; padding: 6px 16px; border-radius: var(--radius-sm); transition: background 0.2s; }
        .current-date:hover { background: var(--border-subtle); }
        .current-date .weekday { color: var(--accent-gold); margin-left: 8px; font-size: 13px; }

        /* Main */
        .main { flex: 1; overflow-y: auto; overflow-x: hidden; padding: 0 0 calc(80px + var(--safe-bottom)); scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }
        .main::-webkit-scrollbar { display: none; }
        .view { display: none; padding: 20px; animation: fadeIn 0.4s ease; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Time Display */
        .time-section { text-align: center; margin-bottom: 24px; }
        .current-time { font-family: var(--font-display); font-size: 56px; color: var(--text-primary); letter-spacing: 0.05em; }
        .time-period { font-size: 14px; color: var(--text-muted); margin-top: 8px; padding: 6px 16px; display: inline-block; border-radius: 20px; }
        .time-period.morning { background: var(--accent-gold-dim); color: var(--accent-gold); }
        .time-period.evening { background: var(--accent-blue-dim); color: var(--accent-blue); }

        /* Quote Card */
        .quote-card { 
            background: var(--bg-card); 
            border: 1px solid var(--border-subtle); 
            border-radius: var(--radius-xl); 
            padding: 28px 24px; 
            margin-bottom: 24px; 
            position: relative; 
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }
        .quote-card::before { content: '"'; position: absolute; top: -10px; left: 16px; font-family: var(--font-display); font-size: 120px; color: var(--accent-gold); opacity: 0.08; line-height: 1; }
        .quote-text { font-family: var(--font-serif); font-size: 15px; line-height: 2; color: var(--text-primary); margin-bottom: 16px; position: relative; z-index: 1; }
        .quote-source { font-size: 12px; color: var(--text-muted); text-align: right; }

        /* Month Card */
        .month-card { 
            background: linear-gradient(145deg, var(--accent-gold-dim) 0%, var(--bg-card) 60%); 
            border: 1px solid var(--border-subtle); 
            border-radius: var(--radius-xl); 
            padding: 24px; 
            margin-bottom: 24px;
            box-shadow: var(--shadow-md);
        }
        .month-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .month-label { font-size: 11px; color: var(--accent-gold); text-transform: uppercase; letter-spacing: 0.2em; margin-bottom: 4px; }
        .month-theme { font-family: var(--font-serif); font-size: 28px; font-weight: 500; color: var(--text-primary); }
        .month-revenue { text-align: right; }
        .month-revenue-label { font-size: 10px; color: var(--text-muted); margin-bottom: 2px; }
        .month-revenue-value { font-family: var(--font-display); font-size: 22px; color: var(--accent-gold); }
        .month-quote { font-family: var(--font-serif); font-size: 13px; color: var(--text-secondary); font-style: italic; padding-left: 12px; border-left: 2px solid var(--accent-gold); opacity: 0.9; }

        /* Section */
        .section { margin-bottom: 28px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .section-title { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.15em; font-weight: 500; }
        .section-progress { font-size: 13px; color: var(--accent-sage); font-weight: 500; }
        .section-badge { font-size: 11px; padding: 4px 10px; border-radius: 12px; cursor: pointer; }
        .section-badge.morning { background: var(--accent-gold-dim); color: var(--accent-gold); }
        .section-badge.evening { background: var(--accent-blue-dim); color: var(--accent-blue); }
        .section.highlighted { background: var(--accent-gold-dim); margin: -12px -20px 28px; padding: 20px; border-radius: var(--radius-lg); }
        .section.highlighted.evening { background: var(--accent-blue-dim); }

        /* Habit Item */
        .habit-list { display: flex; flex-direction: column; gap: 10px; }
        .habit-item { 
            display: flex; 
            align-items: center; 
            gap: 14px; 
            background: var(--bg-card); 
            border: 1px solid var(--border-subtle); 
            border-radius: var(--radius-md); 
            padding: 16px 18px; 
            cursor: pointer; 
            transition: all 0.25s ease;
            box-shadow: var(--shadow-sm);
        }
        .habit-item:hover { background: var(--bg-card-hover); border-color: var(--border-medium); }
        .habit-item.completed { background: var(--accent-sage-dim); border-color: rgba(107, 143, 113, 0.3); }
        .habit-checkbox { width: 24px; height: 24px; border: 2px solid var(--text-muted); border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.25s; flex-shrink: 0; }
        .habit-item.completed .habit-checkbox { background: var(--accent-sage); border-color: var(--accent-sage); }
        .habit-checkbox svg { width: 14px; height: 14px; color: transparent; }
        .habit-item.completed .habit-checkbox svg { color: var(--bg-primary); }
        .habit-info { flex: 1; }
        .habit-name { font-size: 15px; color: var(--text-primary); margin-bottom: 2px; }
        .habit-time { font-size: 12px; color: var(--accent-gold); font-weight: 500; }
        .habit-item.completed .habit-name { text-decoration: line-through; opacity: 0.7; }

        /* Health Grid */
        .health-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .health-item { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 18px; box-shadow: var(--shadow-sm); }
        .health-icon { font-size: 24px; margin-bottom: 8px; }
        .health-label { font-size: 11px; color: var(--text-muted); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.1em; }
        .health-value input { background: transparent; border: none; color: var(--text-primary); font-family: var(--font-display); font-size: 24px; width: 80px; outline: none; }
        .health-unit { font-size: 12px; color: var(--text-muted); font-family: var(--font-sans); }

        /* Note Card */
        .note-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 20px; box-shadow: var(--shadow-sm); }
        .note-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
        .note-title { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.15em; }
        .note-textarea { width: 100%; min-height: 120px; background: transparent; border: none; color: var(--text-primary); font-family: var(--font-serif); font-size: 14px; line-height: 1.9; resize: none; outline: none; }
        .note-textarea::placeholder { color: var(--text-muted); }

        /* Image Upload */
        .image-upload-area { margin-top: 16px; border: 2px dashed var(--border-medium); border-radius: var(--radius-md); padding: 20px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .image-upload-area:hover { border-color: var(--accent-gold); background: var(--accent-gold-dim); }
        .image-upload-area svg { width: 32px; height: 32px; color: var(--text-muted); margin-bottom: 8px; }
        .image-upload-area p { font-size: 12px; color: var(--text-muted); }
        .uploaded-images { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 12px; }
        .uploaded-image { position: relative; aspect-ratio: 1; border-radius: var(--radius-sm); overflow: hidden; }
        .uploaded-image img { width: 100%; height: 100%; object-fit: cover; }
        .uploaded-image .remove-btn { position: absolute; top: 4px; right: 4px; width: 24px; height: 24px; background: rgba(0,0,0,0.7); border: none; border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* News Section */
        .keyword-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
        .keyword-tag { 
            padding: 8px 14px; 
            background: var(--bg-card); 
            border: 1px solid var(--border-subtle); 
            border-radius: 20px; 
            font-size: 13px; 
            color: var(--text-secondary); 
            cursor: pointer; 
            transition: all 0.2s; 
            display: flex; 
            align-items: center; 
            gap: 8px;
            box-shadow: var(--shadow-sm);
        }
        .keyword-tag:hover { border-color: var(--accent-gold); }
        .keyword-tag .remove { font-size: 16px; opacity: 0.6; line-height: 1; }
        .keyword-tag .remove:hover { opacity: 1; }
        .add-keyword-btn { padding: 8px 14px; background: transparent; border: 2px dashed var(--border-medium); border-radius: 20px; font-size: 13px; color: var(--text-muted); cursor: pointer; }
        .add-keyword-btn:hover { border-color: var(--accent-gold); color: var(--accent-gold); }
        
        .news-card { 
            background: var(--bg-card); 
            border: 1px solid var(--border-subtle); 
            border-radius: var(--radius-lg); 
            overflow: hidden; 
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
        }
        .news-card-header { 
            padding: 14px 16px; 
            border-bottom: 1px solid var(--border-subtle); 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            background: var(--accent-gold-dim);
        }
        .news-keyword { font-size: 14px; color: var(--accent-gold); font-weight: 500; }
        .news-link-btn { 
            background: var(--accent-gold); 
            border: none; 
            color: var(--bg-primary); 
            padding: 6px 12px; 
            border-radius: 16px; 
            font-size: 11px; 
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
        }
        .news-link-btn:hover { opacity: 0.9; }
        .news-list { max-height: 250px; overflow-y: auto; }
        .news-item { 
            padding: 14px 16px; 
            border-bottom: 1px solid var(--border-subtle); 
            cursor: pointer; 
            transition: background 0.2s;
            text-decoration: none;
            display: block;
        }
        .news-item:last-child { border-bottom: none; }
        .news-item:hover { background: var(--bg-card-hover); }
        .news-item-title { font-size: 13px; color: var(--text-primary); line-height: 1.6; margin-bottom: 6px; }
        .news-item-meta { display: flex; justify-content: space-between; align-items: center; }
        .news-item-source { font-size: 11px; color: var(--text-muted); }
        .news-loading { padding: 30px 16px; text-align: center; font-size: 13px; color: var(--text-muted); }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(10px); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--bg-secondary); border: 1px solid var(--border-medium); border-radius: var(--radius-xl); width: 100%; max-width: 400px; max-height: 90vh; overflow-y: auto; animation: modalIn 0.3s ease; box-shadow: var(--shadow-md); }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-bottom: 1px solid var(--border-subtle); }
        .modal-title { font-family: var(--font-serif); font-size: 18px; color: var(--text-primary); }
        .modal-close { background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 8px; }
        .modal-body { padding: 20px 24px; }

        /* Settings */
        .settings-section { margin-bottom: 24px; }
        .settings-section-title { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .settings-item { padding: 16px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); margin-bottom: 8px; }
        .settings-item-label { font-size: 14px; color: var(--text-primary); margin-bottom: 4px; }
        .settings-item-desc { font-size: 12px; color: var(--text-muted); margin-bottom: 12px; }
        .time-input-group { display: flex; align-items: center; gap: 8px; }
        .time-input { background: var(--bg-secondary); border: 1px solid var(--border-medium); border-radius: var(--radius-sm); padding: 10px 14px; color: var(--text-primary); font-family: var(--font-display); font-size: 18px; width: 100px; text-align: center; outline: none; }
        .time-input:focus { border-color: var(--accent-gold); }
        .time-separator { color: var(--text-muted); font-size: 18px; }

        /* Form */
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 12px; color: var(--text-muted); margin-bottom: 8px; }
        .form-input { width: 100%; padding: 12px 16px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-family: var(--font-sans); font-size: 14px; outline: none; }
        .form-input:focus { border-color: var(--accent-gold); }
        .btn-primary { width: 100%; padding: 14px; background: var(--accent-gold); border: none; border-radius: var(--radius-md); color: white; font-family: var(--font-sans); font-size: 14px; font-weight: 500; cursor: pointer; }
        .btn-primary:hover { opacity: 0.9; }

        /* Calendar */
        .calendar { width: 100%; }
        .calendar-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .calendar-nav button { background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 8px; }
        .calendar-month { font-family: var(--font-serif); font-size: 16px; color: var(--text-primary); }
        .calendar-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-bottom: 8px; }
        .calendar-weekday { text-align: center; font-size: 11px; color: var(--text-muted); padding: 8px 0; }
        .calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .calendar-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 14px; color: var(--text-secondary); background: none; border: none; border-radius: 50%; cursor: pointer; transition: all 0.2s; position: relative; }
        .calendar-day:hover { background: var(--border-subtle); }
        .calendar-day.today { border: 1px solid var(--accent-gold); color: var(--accent-gold); }
        .calendar-day.selected { background: var(--accent-gold); color: white; }
        .calendar-day.other-month { opacity: 0.3; }

        /* Week View */
        .week-calendar { display: flex; gap: 6px; margin-bottom: 24px; overflow-x: auto; padding: 4px 0; }
        .week-day { flex: 1; min-width: 44px; text-align: center; padding: 12px 8px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s; box-shadow: var(--shadow-sm); }
        .week-day:hover { border-color: var(--border-medium); }
        .week-day.active { background: var(--accent-gold-dim); border-color: var(--accent-gold); }
        .week-day-name { font-size: 10px; color: var(--text-muted); margin-bottom: 4px; }
        .week-day-num { font-family: var(--font-display); font-size: 18px; color: var(--text-primary); }
        .week-day.active .week-day-num { color: var(--accent-gold); }
        .week-day-progress { width: 100%; height: 3px; background: var(--border-subtle); border-radius: 2px; margin-top: 8px; overflow: hidden; }
        .week-day-progress-bar { height: 100%; background: var(--accent-sage); border-radius: 2px; }

        /* Activity List */
        .activity-list { display: flex; flex-direction: column; gap: 8px; }
        .activity-item { display: flex; align-items: center; justify-content: space-between; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 14px 16px; box-shadow: var(--shadow-sm); }
        .activity-info { display: flex; align-items: center; gap: 12px; }
        .activity-icon { font-size: 20px; }
        .activity-name { font-size: 14px; color: var(--text-primary); }
        .activity-day { font-size: 12px; color: var(--text-muted); }
        .activity-status { padding: 6px 12px; border-radius: 16px; font-size: 11px; font-weight: 500; }
        .activity-status.scheduled { background: var(--accent-gold-dim); color: var(--accent-gold); }

        /* Book List */
        .book-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 12px; }
        .book-item { display: flex; align-items: flex-start; gap: 14px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 16px; cursor: pointer; transition: all 0.2s; box-shadow: var(--shadow-sm); }
        .book-item:hover { border-color: var(--border-medium); }
        .book-item.completed { background: var(--accent-sage-dim); border-color: rgba(107, 143, 113, 0.3); }
        .book-checkbox { width: 22px; height: 22px; border: 2px solid var(--text-muted); border-radius: 4px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px; }
        .book-item.completed .book-checkbox { background: var(--accent-sage); border-color: var(--accent-sage); }
        .book-checkbox svg { width: 14px; height: 14px; color: transparent; }
        .book-item.completed .book-checkbox svg { color: var(--bg-primary); }
        .book-info { flex: 1; }
        .book-title { font-size: 14px; color: var(--text-primary); margin-bottom: 3px; }
        .book-author { font-size: 12px; color: var(--text-muted); }
        .book-item.completed .book-title { text-decoration: line-through; opacity: 0.7; }
        .add-book-btn { display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 14px; background: transparent; border: 2px dashed var(--border-medium); border-radius: var(--radius-md); color: var(--text-muted); font-size: 13px; cursor: pointer; }
        .add-book-btn:hover { border-color: var(--accent-gold); color: var(--accent-gold); }

        /* Goals */
        .goal-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 18px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; box-shadow: var(--shadow-sm); }
        .goal-card:hover { border-color: var(--border-medium); }
        .goal-card.completed { background: var(--accent-sage-dim); border-color: rgba(107, 143, 113, 0.3); }
        .goal-header { display: flex; align-items: flex-start; gap: 14px; }
        .goal-checkbox { width: 24px; height: 24px; border: 2px solid var(--text-muted); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .goal-card.completed .goal-checkbox { background: var(--accent-sage); border-color: var(--accent-sage); }
        .goal-checkbox svg { width: 14px; height: 14px; color: transparent; }
        .goal-card.completed .goal-checkbox svg { color: var(--bg-primary); }
        .goal-content { flex: 1; }
        .goal-title { font-size: 15px; color: var(--text-primary); margin-bottom: 4px; }
        .goal-card.completed .goal-title { text-decoration: line-through; opacity: 0.7; }
        .goal-deadline { font-size: 12px; color: var(--text-muted); }

        /* Month Tabs */
        .month-tabs { display: flex; gap: 8px; overflow-x: auto; padding: 4px 0 16px; margin-bottom: 16px; }
        .month-tabs::-webkit-scrollbar { display: none; }
        .month-tab { flex-shrink: 0; padding: 10px 18px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); font-size: 13px; color: var(--text-secondary); cursor: pointer; box-shadow: var(--shadow-sm); }
        .month-tab:hover { border-color: var(--border-medium); }
        .month-tab.active { background: var(--accent-gold-dim); border-color: var(--accent-gold); color: var(--accent-gold); }

        /* Five Year Plan */
        .plan-tabs { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; }
        .plan-tab { flex-shrink: 0; padding: 12px 20px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); font-family: var(--font-display); font-size: 18px; color: var(--text-secondary); cursor: pointer; box-shadow: var(--shadow-sm); }
        .plan-tab.active { background: var(--accent-gold-dim); border-color: var(--accent-gold); color: var(--accent-gold); }
        
        .plan-year-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 24px; margin-bottom: 16px; box-shadow: var(--shadow-sm); }
        .plan-year-card.current { background: linear-gradient(145deg, var(--accent-gold-dim) 0%, var(--bg-card) 40%); }
        .plan-year-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
        .plan-year { font-family: var(--font-display); font-size: 36px; color: var(--accent-gold); }
        .plan-year-theme { font-family: var(--font-serif); font-size: 18px; color: var(--text-primary); margin-top: 4px; }
        .plan-year-revenue { text-align: right; }
        .plan-year-revenue-label { font-size: 11px; color: var(--text-muted); }
        .plan-year-revenue-value { font-family: var(--font-display); font-size: 24px; color: var(--text-primary); }
        .plan-breakdown { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px; }
        .plan-breakdown-item { text-align: center; padding: 12px; background: var(--bg-secondary); border-radius: var(--radius-sm); }
        .plan-breakdown-label { font-size: 10px; color: var(--text-muted); margin-bottom: 4px; }
        .plan-breakdown-value { font-size: 14px; color: var(--text-primary); }
        .plan-section { margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border-subtle); }
        .plan-section-title { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 12px; }
        .plan-milestones { display: flex; flex-direction: column; gap: 8px; }
        .plan-milestone { display: flex; align-items: flex-start; gap: 12px; padding: 10px 0; }
        .plan-milestone-dot { width: 8px; height: 8px; background: var(--accent-gold); border-radius: 50%; margin-top: 6px; flex-shrink: 0; }
        .plan-milestone-text { font-size: 13px; color: var(--text-secondary); }
        .plan-quarter { background: var(--bg-secondary); border-radius: var(--radius-md); padding: 16px; margin-bottom: 12px; }
        .plan-quarter-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .plan-quarter-name { font-weight: 500; color: var(--text-primary); }
        .plan-quarter-revenue { font-family: var(--font-display); color: var(--accent-gold); }
        .plan-quarter-events { font-size: 13px; color: var(--text-secondary); }

        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 24px; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 20px; text-align: center; box-shadow: var(--shadow-sm); }
        .stat-value { font-family: var(--font-display); font-size: 36px; color: var(--accent-gold); margin-bottom: 4px; }
        .stat-label { font-size: 12px; color: var(--text-muted); }

        /* Guidelines */
        .guidelines { background: linear-gradient(145deg, var(--accent-gold-dim) 0%, var(--bg-card) 60%); border: 1px solid var(--border-subtle); border-radius: var(--radius-xl); padding: 24px; box-shadow: var(--shadow-sm); }
        .guideline-item { display: flex; align-items: flex-start; gap: 14px; padding: 12px 0; border-bottom: 1px solid var(--border-subtle); }
        .guideline-item:last-child { border-bottom: none; padding-bottom: 0; }
        .guideline-icon { width: 32px; height: 32px; background: var(--accent-gold-dim); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .guideline-icon svg { width: 16px; height: 16px; color: var(--accent-gold); }
        .guideline-text { font-family: var(--font-serif); font-size: 14px; color: var(--text-primary); line-height: 1.7; }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--bg-primary); border-top: 1px solid var(--border-subtle); padding: 10px 0 calc(var(--safe-bottom) + 6px); z-index: 100; transition: background 0.5s ease; }
        .nav-list { display: flex; justify-content: space-around; max-width: 480px; margin: 0 auto; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 3px; padding: 6px 10px; background: none; border: none; color: var(--text-muted); font-size: 9px; cursor: pointer; transition: color 0.2s; }
        .nav-item:hover { color: var(--text-secondary); }
        .nav-item.active { color: var(--accent-gold); }
        .nav-item svg { width: 22px; height: 22px; }

        /* Toast */
        .toast { position: fixed; bottom: calc(90px + var(--safe-bottom)); left: 50%; transform: translateX(-50%) translateY(100px); background: var(--accent-sage); color: white; padding: 12px 24px; border-radius: var(--radius-md); font-size: 13px; font-weight: 500; opacity: 0; transition: all 0.3s; z-index: 200; }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        
        /* Theme indicator */
        .theme-indicator { font-size: 11px; color: var(--text-muted); margin-left: 8px; }
        
        /* Daily Paper */
        .daily-paper-card { 
            background: linear-gradient(145deg, #f5f0e8 0%, #ebe5d9 100%); 
            border: 1px solid rgba(139, 90, 43, 0.2); 
            border-radius: var(--radius-lg); 
            padding: 20px; 
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
        }
        [data-theme="dark"] .daily-paper-card {
            background: linear-gradient(145deg, #2a2520 0%, #1f1a16 100%);
            border-color: rgba(212, 165, 116, 0.2);
        }
        .paper-card-header { display: flex; align-items: center; gap: 14px; margin-bottom: 16px; }
        .paper-card-icon { font-size: 32px; }
        .paper-card-title { font-family: var(--font-serif); font-size: 18px; color: var(--text-primary); font-weight: 500; }
        .paper-card-desc { font-size: 12px; color: var(--text-muted); margin-top: 2px; }
        .paper-generate-btn { 
            width: 100%; 
            padding: 14px; 
            background: linear-gradient(135deg, #8b5a2b 0%, #6b4423 100%); 
            border: none; 
            border-radius: var(--radius-md); 
            color: #f5f0e8; 
            font-family: var(--font-serif); 
            font-size: 15px; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px;
            transition: all 0.2s;
        }
        .paper-generate-btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .paper-generate-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .paper-generate-btn.loading { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
        
        /* Daily Paper Full View */
        .daily-paper {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #f8f5f0;
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
            animation: paperIn 0.3s ease;
        }
        [data-theme="dark"] .daily-paper { background: #1a1714; }
        @keyframes paperIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        
        .paper-header { 
            text-align: center; 
            padding: 30px 20px 24px; 
            border-bottom: 3px double #8b5a2b; 
            margin-bottom: 24px; 
        }
        .paper-title { 
            font-family: var(--font-serif); 
            font-size: 36px; 
            font-weight: 600; 
            color: #2c1810; 
            letter-spacing: 0.2em; 
            margin-bottom: 8px; 
        }
        [data-theme="dark"] .paper-title { color: #f5f0e8; }
        .paper-date { 
            font-family: var(--font-display); 
            font-size: 14px; 
            color: #8b5a2b; 
            margin-bottom: 8px; 
        }
        .paper-subtitle { 
            font-family: var(--font-serif); 
            font-size: 12px; 
            color: #6b5a4a; 
            font-style: italic; 
        }
        [data-theme="dark"] .paper-subtitle { color: #a89888; }
        
        .paper-content { 
            max-width: 600px; 
            margin: 0 auto; 
            padding: 0 10px; 
        }
        .paper-section { 
            margin-bottom: 28px; 
            padding-bottom: 20px; 
            border-bottom: 1px solid rgba(139, 90, 43, 0.2); 
        }
        .paper-section:last-child { border-bottom: none; }
        .paper-section-title { 
            font-family: var(--font-serif); 
            font-size: 18px; 
            font-weight: 600; 
            color: #8b5a2b; 
            margin-bottom: 12px; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        .paper-section-content { 
            font-family: var(--font-serif); 
            font-size: 14px; 
            line-height: 2; 
            color: #2c1810; 
            text-align: justify; 
        }
        [data-theme="dark"] .paper-section-content { color: #e8e0d8; }
        .paper-headline { 
            font-family: var(--font-serif); 
            font-size: 16px; 
            font-weight: 600; 
            color: #2c1810; 
            margin-bottom: 8px; 
        }
        [data-theme="dark"] .paper-headline { color: #f5f0e8; }
        .paper-summary { 
            font-size: 13px; 
            color: #4a3a2a; 
            margin-bottom: 16px; 
            padding-left: 12px; 
            border-left: 2px solid #8b5a2b; 
        }
        [data-theme="dark"] .paper-summary { color: #c8b8a8; }
        
        .paper-footer { 
            text-align: center; 
            padding: 24px 20px calc(var(--safe-bottom) + 24px); 
        }
        .paper-close-btn { 
            padding: 12px 32px; 
            background: transparent; 
            border: 2px solid #8b5a2b; 
            border-radius: var(--radius-md); 
            color: #8b5a2b; 
            font-family: var(--font-serif); 
            font-size: 14px; 
            cursor: pointer; 
        }
        .paper-close-btn:hover { background: rgba(139, 90, 43, 0.1); }
        
        /* Paper Archive */
        .paper-archive-list { display: flex; flex-direction: column; gap: 10px; }
        .paper-archive-empty { text-align: center; padding: 20px; color: var(--text-muted); font-size: 13px; }
        .paper-archive-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: linear-gradient(145deg, #f5f0e8 0%, #ebe5d9 100%);
            border: 1px solid rgba(139, 90, 43, 0.2);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
        }
        [data-theme="dark"] .paper-archive-item {
            background: linear-gradient(145deg, #2a2520 0%, #1f1a16 100%);
            border-color: rgba(212, 165, 116, 0.2);
        }
        .paper-archive-item:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .paper-archive-date { font-family: var(--font-serif); font-size: 14px; color: var(--text-primary); }
        .paper-archive-headline { font-size: 12px; color: var(--text-muted); margin-top: 4px; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .paper-archive-badge { padding: 4px 10px; background: #8b5a2b; color: #f5f0e8; font-size: 10px; border-radius: 12px; }
    </style>
</head>
<body>
    <div class="app">
        <header class="header">
            <div class="header-top">
                <div class="logo">‰ΩôÁôΩ<span>2026</span></div>
                <div class="header-actions">
                    <button class="header-btn" onclick="openSettings()" title="Ë®≠ÂÆö">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                    </button>
                </div>
            </div>
            <div class="date-nav">
                <button id="prevDay"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg></button>
                <div class="current-date" id="currentDate" onclick="openCalendar()"><span class="date-text"></span><span class="weekday"></span></div>
                <button id="nextDay"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg></button>
            </div>
        </header>
        <main class="main">
            <!-- Today View -->
            <div class="view active" id="todayView">
                <div class="time-section">
                    <div class="current-time" id="currentTime">00:00</div>
                    <div class="time-period" id="timePeriod"></div>
                </div>
                <div class="quote-card"><p class="quote-text" id="dailyQuote"></p><p class="quote-source">‚Äî Ë≥™Èáè„Å®‰ΩôÁôΩ„ÅÆÈñì„Åß</p></div>
                <div class="month-card">
                    <div class="month-card-header">
                        <div><div class="month-label">‰ªäÊúà„ÅÆ„ÉÜ„Éº„Éû</div><div class="month-theme" id="monthTheme">ÂßãÂãï</div></div>
                        <div class="month-revenue"><div class="month-revenue-label">ÁõÆÊ®ôÊúàÂïÜ</div><div class="month-revenue-value" id="monthRevenue">¬•20‰∏á</div></div>
                    </div>
                    <p class="month-quote" id="monthQuote"></p>
                </div>
                <div class="section" id="morningSection">
                    <div class="section-header"><span class="section-title">üåÖ Êúù„ÅÆ„É´„Éº„ÉÜ„Ç£„É≥</span><span class="section-badge morning" id="morningTimeBadge" onclick="openSettings()">7:00„Äú</span></div>
                    <div class="section-header"><span></span><span class="section-progress" id="morningProgress">0/5</span></div>
                    <div class="habit-list" id="morningHabits"></div>
                </div>
                <div class="section" id="daytimeSection">
                    <div class="section-header"><span class="section-title">‚òÄÔ∏è Êó•‰∏≠„ÅÆ„É´„Éº„ÉÜ„Ç£„É≥</span><span class="section-badge" style="background: var(--accent-sage-dim); color: var(--accent-sage);" id="daytimeTimeBadge">11:00„Äú</span></div>
                    <div class="section-header"><span style="font-size: 11px; color: var(--accent-sage);">14ÊôÇÈñì„Éï„Ç°„Çπ„ÉÜ„Ç£„É≥„Ç∞Âæå</span><span class="section-progress" id="daytimeProgress">0/5</span></div>
                    <div class="habit-list" id="daytimeHabits"></div>
                </div>
                <div class="section" id="eveningSection">
                    <div class="section-header"><span class="section-title">üåÜ Â§ïÊñπ„ÅÆ„É´„Éº„ÉÜ„Ç£„É≥</span><span class="section-badge evening" id="eveningTimeBadge" onclick="openSettings()">20:00„Äú</span></div>
                    <div class="section-header"><span style="font-size: 11px; color: var(--accent-blue);">ÊúÄÂæå„ÅÆÈ£ü‰∫ã„ÅØ21ÊôÇ„Åæ„Åß</span><span class="section-progress" id="eveningProgress">0/4</span></div>
                    <div class="habit-list" id="eveningHabits"></div>
                </div>
                <div class="section" id="nightSection">
                    <div class="section-header"><span class="section-title">üåô Â§ú„ÅÆ„É´„Éº„ÉÜ„Ç£„É≥</span><span class="section-badge" style="background: rgba(139, 92, 246, 0.15); color: #8b5cf6;" id="nightTimeBadge">22:00„Äú</span></div>
                    <div class="section-header"><span></span><span class="section-progress" id="nightProgress">0/3</span></div>
                    <div class="habit-list" id="nightHabits"></div>
                </div>
                <div class="section" id="strengthSection">
                    <div class="section-header"><span class="section-title">üí™ Á≠ã„Éà„É¨ÔºàÈÄ±3ÂõûÔºâ</span><span class="section-badge" style="background: var(--accent-rose); color: white;" id="strengthDayBadge">Êúà„ÉªÊ∞¥„ÉªÈáë</span></div>
                    <div class="section-header"><span></span><span class="section-progress" id="strengthProgress">0/3</span></div>
                    <div class="habit-list" id="strengthHabits"></div>
                </div>
                <div class="section"><div class="section-header"><span class="section-title">„Éò„É´„Çπ„Ç±„Ç¢</span></div><div class="health-grid" id="healthGrid"></div></div>
                <div class="section">
                    <div class="note-card">
                        <div class="note-header"><span class="note-title">‰ªäÊó•„ÅÆË®òÈå≤</span></div>
                        <textarea class="note-textarea" id="dailyNote" placeholder="‰ªäÊó•„ÅÆÊ∞ó„Å•„Åç„ÄÅÊÑüË¨ù„ÄÅÊåØ„ÇäËøî„Çä„ÇíË®òÈå≤„Åô„Çã..."></textarea>
                        <div class="image-upload-area" id="imageUploadArea"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg><p>ÁîªÂÉè„ÇíËøΩÂä†</p></div>
                        <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
                        <div class="uploaded-images" id="uploadedImages"></div>
                    </div>
                </div>
            </div>
            
            <!-- News View -->
            <div class="view" id="newsView">
                <!-- ‰ΩôÁôΩÊó•Â†± -->
                <div class="daily-paper" id="dailyPaper" style="display: none;">
                    <div class="paper-header">
                        <div class="paper-title">‰ΩôÁôΩÊó•Â†±</div>
                        <div class="paper-date" id="paperDate"></div>
                        <div class="paper-subtitle">‚Äî Ë≥™Èáè„Å®‰ΩôÁôΩ„ÅÆÈñì„Åß„ÄÅ‰ªäÊó•„ÇíÁü•„Çã ‚Äî</div>
                    </div>
                    <div class="paper-content" id="paperContent"></div>
                    <div class="paper-footer">
                        <button class="paper-close-btn" onclick="closeDailyPaper()">Èñâ„Åò„Çã</button>
                    </div>
                </div>
                
                <!-- Êó•Â†±ÁîüÊàê„ÉªË°®Á§∫„Ç®„É™„Ç¢ -->
                <div class="section">
                    <div class="daily-paper-card" id="dailyPaperCard">
                        <div class="paper-card-header">
                            <span class="paper-card-icon">üì∞</span>
                            <div>
                                <div class="paper-card-title" id="paperCardTitle">‰ªäÊó•„ÅÆ‰ΩôÁôΩÊó•Â†±</div>
                                <div class="paper-card-desc" id="paperStatus">AI„Åå„Éã„É•„Éº„Çπ„ÇíË¶ÅÁ¥Ñ„Åó„Åæ„Åô</div>
                            </div>
                        </div>
                        <div id="paperActionArea">
                            <button class="paper-generate-btn" id="generatePaperBtn" onclick="generateDailyPaper()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                                Êó•Â†±„ÇíÁîüÊàê
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- ÈÅéÂéª„ÅÆÊó•Â†±„Ç¢„Éº„Ç´„Ç§„Éñ -->
                <div class="section">
                    <div class="section-header"><span class="section-title">üìö Êó•Â†±„Ç¢„Éº„Ç´„Ç§„Éñ</span></div>
                    <div class="paper-archive-list" id="paperArchiveList">
                        <div class="paper-archive-empty">„Åæ„Å†Êó•Â†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-header"><span class="section-title">„Éã„É•„Éº„Çπ„Ç≠„Éº„ÉØ„Éº„Éâ</span></div>
                    <div class="keyword-tags" id="keywordTags"></div>
                </div>
                <div id="newsContainer"></div>
            </div>
            
            <!-- Week View -->
            <div class="view" id="weekView">
                <div class="week-calendar" id="weekCalendar"></div>
                <div class="section"><div class="section-header"><span class="section-title">ÈÄ±Èñì„Ç¢„ÇØ„ÉÜ„Ç£„Éì„ÉÜ„Ç£</span></div><div class="activity-list" id="weeklyActivities"></div></div>
                <div class="section"><div class="section-header"><span class="section-title">‰ªäÊúà„ÅÆË™≠Êõ∏</span><span class="section-progress" id="bookProgress">0/5</span></div><div class="book-list" id="bookList"></div><button class="add-book-btn" onclick="openAddBookModal()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>Êú¨„ÇíËøΩÂä†</button></div>
            </div>
            
            <!-- Goals View -->
            <div class="view" id="goalsView">
                <div class="section"><div class="section-header"><span class="section-title">2026Âπ¥ Âπ¥ÈñìÁõÆÊ®ô</span></div><div id="yearGoals"></div></div>
                <div class="month-tabs" id="monthTabs"></div>
                <div class="section"><div class="section-header"><span class="section-title" id="monthGoalsTitle">1Êúà„ÅÆÁõÆÊ®ô</span></div><div id="monthGoals"></div></div>
            </div>
            
            <!-- Plan View -->
            <div class="view" id="planView">
                <div class="quote-card" style="margin-bottom: 24px;"><p class="quote-text">Ë≥™Èáè„Å®‰ΩôÁôΩ„ÅÆÈñì„Åß„ÄÇ2030Âπ¥„Å∏Âêë„Åë„Å¶„ÄÇ</p><p class="quote-source">‚Äî Ë±ä„Åã„Å™ÂæåÊÇî„ÅÆÂ§ö„ÅÑ‰∫∫Áîü„Çí</p></div>
                <div class="plan-tabs" id="planTabs"></div>
                <div id="fiveYearPlan"></div>
            </div>
            
            <!-- Stats View -->
            <div class="view" id="statsView">
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value" id="totalStreak">0</div><div class="stat-label">Á∂ôÁ∂öÊó•Êï∞</div></div>
                    <div class="stat-card"><div class="stat-value" id="totalHabits">0</div><div class="stat-label">ÂÆå‰∫Ü„Åó„ÅüÁøíÊÖ£</div></div>
                    <div class="stat-card"><div class="stat-value" id="totalGoals">0</div><div class="stat-label">ÈÅîÊàê„Åó„ÅüÁõÆÊ®ô</div></div>
                    <div class="stat-card"><div class="stat-value" id="totalBooks">0</div><div class="stat-label">Ë™≠„Çì„Å†Êú¨</div></div>
                </div>
                <div class="guidelines">
                    <div class="section-title" style="margin-bottom: 16px;">Âπ¥ÈñìÊåáÈáù</div>
                    <div class="guideline-item"><div class="guideline-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2z"/></svg></div><p class="guideline-text">ÊâπË©ïÂÆ∂„Å´„Å™„Çâ„Åö„ÄÅÊâã„ÇíÂãï„Åã„ÅóÁ∂ö„Åë„Çã</p></div>
                    <div class="guideline-item"><div class="guideline-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></div><p class="guideline-text">ËÑÜÂº±ÊÄß„ÇíË™ç„ÇÅÂêà„ÅÜÈñ¢‰øÇÊÄß„Çí‰Ωú„Çã</p></div>
                    <div class="guideline-item"><div class="guideline-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg></div><p class="guideline-text">‰∏çÂèØÈÄÜÊÄß„Å®‰∏ÄÂõûÊÄß„ÇíÂ§ßÂàá„Å´„Åô„Çã</p></div>
                    <div class="guideline-item"><div class="guideline-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg></div><p class="guideline-text">„Ç®„ÉÉ„Çª„É≥„Ç∑„É£„É´„ÉØ„Éº„Ç´„Éº„ÅåË™∞„Çà„Çä„ÇÇÂπ∏„Åõ„Åß„ÅÇ„Å£„Å¶„Åª„Åó„ÅÑ</p></div>
                </div>
                <div class="guidelines" style="margin-top: 20px; background: linear-gradient(145deg, var(--accent-blue-dim) 0%, var(--bg-card) 60%);">
                    <div class="section-title" style="margin-bottom: 16px;">üß† „É°„É≥„Çø„É´„É´„Éº„É´Ôºà2ÈÄ±ÈñìÈôêÂÆö„Éó„É≠„Ç∞„É©„É†Ôºâ</div>
                    <div class="guideline-item"><div class="guideline-icon" style="background: var(--accent-blue-dim);"><svg viewBox="0 0 24 24" fill="none" stroke="var(--accent-blue)" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg></div><p class="guideline-text">È†≠„ÅåÂõû„Çâ„Å™„ÅÑÔºùÊÑèÂøó‰∏çË∂≥„Åß„ÅØ„Å™„Åè‰ºëÊÜ©‰∏çË∂≥</p></div>
                    <div class="guideline-item"><div class="guideline-icon" style="background: var(--accent-blue-dim);"><svg viewBox="0 0 24 24" fill="none" stroke="var(--accent-blue)" stroke-width="2"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg></div><p class="guideline-text">Â§ú„ÅØËá™Â∑±Ë©ï‰æ°„ÉªÂèçÁúÅ„Çí„Åó„Å™„ÅÑ</p></div>
                    <div class="guideline-item"><div class="guideline-icon" style="background: var(--accent-blue-dim);"><svg viewBox="0 0 24 24" fill="none" stroke="var(--accent-blue)" stroke-width="2"><path d="M18 8h1a4 4 0 0 1 0 8h-1M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg></div><p class="guideline-text">È£ü‰∫ã„Å®ÈÖí„ÇíÊÑüÊÉÖÂá¶ÁêÜ„Å´‰Ωø„Çè„Å™„ÅÑ</p></div>
                    <div class="guideline-item"><div class="guideline-icon" style="background: var(--accent-blue-dim);"><svg viewBox="0 0 24 24" fill="none" stroke="var(--accent-blue)" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v4l3 3"/></svg></div><p class="guideline-text">7Ââ≤ÈÅîÊàê„ÅßOK„ÉªÁøåÊó•„É™„Çª„ÉÉ„Éà</p></div>
                </div>
            </div>
        </main>
        
        <nav class="bottom-nav">
            <div class="nav-list">
                <button class="nav-item active" data-view="todayView"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>‰ªäÊó•</button>
                <button class="nav-item" data-view="newsView"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 20H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v1m2 13a2 2 0 0 1-2-2V7m2 13a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2m-4-3H9M7 16h6M7 12h6"/></svg>„Éã„É•„Éº„Çπ</button>
                <button class="nav-item" data-view="weekView"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>ÈÄ±Èñì</button>
                <button class="nav-item" data-view="goalsView"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>ÁõÆÊ®ô</button>
                <button class="nav-item" data-view="planView"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>Ë®àÁîª</button>
                <button class="nav-item" data-view="statsView"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>Áµ±Ë®à</button>
            </div>
        </nav>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="calendarModal"><div class="modal"><div class="modal-header"><span class="modal-title">Êó•‰ªò„ÇíÈÅ∏Êäû</span><button class="modal-close" onclick="closeCalendar()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div><div class="modal-body"><div class="calendar"><div class="calendar-nav"><button onclick="prevMonth()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg></button><span class="calendar-month" id="calendarMonth"></span><button onclick="nextMonth()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg></button></div><div class="calendar-weekdays"><div class="calendar-weekday">Êó•</div><div class="calendar-weekday">Êúà</div><div class="calendar-weekday">ÁÅ´</div><div class="calendar-weekday">Ê∞¥</div><div class="calendar-weekday">Êú®</div><div class="calendar-weekday">Èáë</div><div class="calendar-weekday">Âúü</div></div><div class="calendar-days" id="calendarDays"></div></div></div></div></div>
    
    <div class="modal-overlay" id="settingsModal"><div class="modal"><div class="modal-header"><span class="modal-title">Ë®≠ÂÆö</span><button class="modal-close" onclick="closeSettings()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div><div class="modal-body">
        <div class="settings-section"><div class="settings-section-title">üåÖ Êúù„ÅÆ„É´„Éº„ÉÜ„Ç£„É≥ÈñãÂßãÊôÇÂàª</div><div class="settings-item"><div class="settings-item-label">ÈñãÂßãÊôÇÂàª„ÇíË®≠ÂÆö</div><div class="settings-item-desc">„Åì„ÅÆÊôÇÂàª„Åã„ÇâÊúù„É´„Éº„ÉÜ„Ç£„É≥„ÅåÂßã„Åæ„Çä„Åæ„Åô</div><div class="time-input-group"><input type="time" class="time-input" id="morningStart" value="07:00"></div></div></div>
        <div class="settings-section"><div class="settings-section-title">üåô Â§ú„ÅÆ„É´„Éº„ÉÜ„Ç£„É≥ÈñãÂßãÊôÇÂàª</div><div class="settings-item"><div class="settings-item-label">ÈñãÂßãÊôÇÂàª„ÇíË®≠ÂÆö</div><div class="settings-item-desc">„Åì„ÅÆÊôÇÂàª„Åã„ÇâÂ§ú„É´„Éº„ÉÜ„Ç£„É≥„ÅåÂßã„Åæ„Çä„Åæ„Åô</div><div class="time-input-group"><input type="time" class="time-input" id="eveningStart" value="20:00"></div></div></div>
        <button class="btn-primary" onclick="saveSettings()">‰øùÂ≠ò„Åô„Çã</button>
        
        <div class="settings-section" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border-subtle);">
            <div class="settings-section-title">üì∞ ‰ΩôÁôΩÊó•Â†±ÔºàAIË®≠ÂÆöÔºâ</div>
            <div class="settings-item">
                <div class="settings-item-label">OpenAI API„Ç≠„Éº</div>
                <div class="settings-item-desc">„Éã„É•„Éº„Çπ„ÅÆË¶ÅÁ¥ÑÁîüÊàê„Å´‰ΩøÁî®„Åó„Åæ„ÅôÔºà„Ç≠„Éº„ÅØÁ´ØÊú´ÂÜÖ„Å´‰øùÂ≠òÔºâ</div>
                <input type="password" class="form-input" id="openaiApiKey" placeholder="sk-..." style="margin-top: 8px;">
                <button class="btn-primary" style="margin-top: 12px; background: var(--accent-sage);" onclick="saveApiKey()">API„Ç≠„Éº„Çí‰øùÂ≠ò</button>
            </div>
        </div>
        
        <div class="settings-section" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border-subtle);">
            <div class="settings-section-title">üîÑ „Ç¢„Éó„É™„ÅÆÊõ¥Êñ∞</div>
            <div class="settings-item">
                <div class="settings-item-label">ÊúÄÊñ∞Áâà„Å´Êõ¥Êñ∞</div>
                <div class="settings-item-desc">„Éõ„Éº„É†ÁîªÈù¢„Å´ËøΩÂä†„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅÊõ¥Êñ∞„ÅåÂèçÊò†„Åï„Çå„Å™„ÅÑ„Åì„Å®„Åå„ÅÇ„Çä„Åæ„Åô</div>
                <button class="btn-primary" style="margin-top: 12px; background: var(--accent-blue);" onclick="forceUpdateApp()">„Ç¢„Éó„É™„ÇíÊõ¥Êñ∞„Åô„Çã</button>
            </div>
        </div>
        
        <div class="settings-section" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border-subtle);">
            <div class="settings-section-title">‚ÑπÔ∏è „Ç¢„Éó„É™ÊÉÖÂ†±</div>
            <div class="settings-item">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span class="settings-item-label">„Éê„Éº„Ç∏„Éß„É≥</span>
                    <span style="color: var(--text-muted); font-family: var(--font-display);" id="appVersion">v1.2.0</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                    <span class="settings-item-label">ÊúÄÁµÇÊõ¥Êñ∞</span>
                    <span style="color: var(--text-muted); font-size: 12px;" id="appLastUpdate">2026-01-10</span>
                </div>
            </div>
        </div>
    </div></div></div>
    
    <div class="modal-overlay" id="addBookModal"><div class="modal"><div class="modal-header"><span class="modal-title">Êú¨„ÇíËøΩÂä†</span><button class="modal-close" onclick="closeAddBookModal()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div><div class="modal-body"><div class="form-group"><label class="form-label">„Çø„Ç§„Éà„É´</label><input type="text" class="form-input" id="bookTitleInput" placeholder="Êú¨„ÅÆ„Çø„Ç§„Éà„É´"></div><div class="form-group"><label class="form-label">ËëóËÄÖ</label><input type="text" class="form-input" id="bookAuthorInput" placeholder="ËëóËÄÖÂêç"></div><button class="btn-primary" onclick="addCustomBook()">ËøΩÂä†„Åô„Çã</button></div></div></div>
    
    <div class="modal-overlay" id="addKeywordModal"><div class="modal"><div class="modal-header"><span class="modal-title">„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíËøΩÂä†</span><button class="modal-close" onclick="closeAddKeywordModal()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div><div class="modal-body"><div class="form-group"><label class="form-label">„Ç≠„Éº„ÉØ„Éº„Éâ</label><input type="text" class="form-input" id="keywordInput" placeholder="‰æã: AI, Ë™çÁü•Áóá, „Ç¢„Éº„Éà"></div><button class="btn-primary" onclick="addKeyword()">ËøΩÂä†„Åô„Çã</button></div></div></div>
    
    <div class="toast" id="toast">‰øùÂ≠ò„Åó„Åæ„Åó„Åü</div>

    <script>
        // ============================================
        // APP VERSION
        // ============================================
        const APP_VERSION = 'v1.5.0';
        const APP_LAST_UPDATE = '2026-01-10';
        
        // ============================================
        // DATA
        // ============================================
        const QUOTES = [
            "„Ç®„ÉÉ„Çª„É≥„Ç∑„É£„É´„ÉØ„Éº„Ç´„Éº„ÅåË™∞„Çà„Çä„ÇÇÂπ∏„Åõ„Åß„ÅÇ„Å£„Å¶„Åª„Åó„ÅÑ„ÄÇ„Åì„ÅÆÁ•à„Çä„Çí„ÄÅÁ•à„Çä„ÅÆ„Åæ„Åæ„Å´„Åó„Å™„ÅÑ„ÄÇ",
            "Ë±ä„Åã„Å™ÂæåÊÇî„Å®„ÅØ„ÄÅËµ∑„Åì„Çâ„Å™„Åã„Å£„Åü„Åì„Å®„ÇÑËµ∑„Åì„Åï„Å™„Åã„Å£„ÅüÈÅéÂéª„ÇíË≤¨„ÇÅ„Çã„ÅÆ„Åß„ÅØ„Å™„Åè„ÄÅËµ∑„Åì„Çâ„Å™„Åã„Å£„Åü„Åæ„ÅæÁæé„Åó„ÅèÊÆã„Åó„Å¶„Åä„ÅèÊÖãÂ∫¶„ÅÆ„Åì„Å®„Å†„ÄÇ",
            "ÂÇç„Å´„ÅÑ„Çã„Å®„ÅÑ„ÅÜ„Åì„Å®„ÅØ„ÄÅÁõ∏Êâã„ÇíÂ§â„Åà„Çà„ÅÜ„Å®„Åó„Å™„ÅÑ„Åì„Å®„Å†„ÄÇÂä©„Åë„Çà„ÅÜ„Å®„Åó„Å™„ÅÑ„Åì„Å®„Å†„ÄÇ„Åü„Å†„ÄÅ„Åù„Åì„Å´„ÅÑ„Çã„Åì„Å®„ÄÇ",
            "Áí∞‰∏ñÁïå„ÅÆÈÅï„ÅÑ„ÇíË™ç„ÇÅ„ÄÅÂ∞äÈáç„Åô„Çã„Åì„Å®„Åå„ÄÅÁúü„ÅÆÂØæË©±„ÅÆÂâçÊèêÊù°‰ª∂„Å®„Å™„Çã„ÄÇ",
            "Ëã¶Áóõ„ÇÇ„Åæ„Åü„ÄÅÁô∫ÈÖµ„ÅÆÁ¥†Êùê„Å´„Å™„ÇäÂæó„Çã„ÄÇ",
            "‰ΩôÁôΩ„Å®„ÅØ„ÄÅÂäπÁéáÊÄß„ÅÆË´ñÁêÜ„Åã„ÇâÂ§ñ„Çå„Åü„ÇÇ„ÅÆ„Å†„ÄÇ„Åó„Åã„Åó„ÄÅ‰∫∫Èñì„Å®„Åó„Å¶Áîü„Åç„Çã„Åü„ÇÅ„Å´„ÅØ„ÄÅ„Åù„ÅÆ„Çà„ÅÜ„Å™‰ΩôÁôΩ„Åå‰∏çÂèØÊ¨†„Å†„ÄÇ",
            "ÊâπË©ïÂÆ∂„Å´„Å™„Çâ„Åö„ÄÅÊâã„ÇíÂãï„Åã„ÅóÁ∂ö„Åë„Çã„ÄÇ",
            "ËÑÜÂº±ÊÄß„ÇíË™ç„ÇÅÂêà„ÅÜÈñ¢‰øÇÊÄß„Çí„ÄÅ„Å©„Çå„Å†„Åë‰Ωú„Çå„Çã„Åã„ÄÇ",
            "ÂæåÊÇî„ÅØ„ÄÅÈÅ∏Êäû„ÅÆË®º„Å†„ÄÇÂæåÊÇî„Åß„Åç„Çã„Å®„ÅÑ„ÅÜ„Åì„Å®„ÅØ„ÄÅÈÅ∏ÊäûËÇ¢„Åå„ÅÇ„Å£„Åü„Å®„ÅÑ„ÅÜ„Åì„Å®„ÄÇ",
            "‰∫∫Èñì„Åã„Çâ„Åô„Åπ„Å¶„ÇíÂ•™„ÅÜ„Åì„Å®„Åå„Åß„Åç„Çã„ÄÇ„Åü„Å†‰∏Ä„Å§„ÅÆ„Åì„Å®„ÇíÈô§„ÅÑ„Å¶„ÄÇ„Åù„Çå„ÅØ„ÄÅ‰∏é„Åà„Çâ„Çå„ÅüÁí∞Â¢É„ÅÆ‰∏≠„ÅßËá™„Çâ„ÅÆÊÖãÂ∫¶„ÇíÈÅ∏„Å∂„Å®„ÅÑ„ÅÜ„ÄÅ‰∫∫Èñì„ÅÆÊúÄÂæå„ÅÆËá™Áî±„Åß„ÅÇ„Çã„ÄÇ",
            "„Å™„ÅúÁîü„Åç„Çã„Åã„ÇíÁü•„Å£„Å¶„ÅÑ„ÇãËÄÖ„ÅØ„ÄÅ„Å©„ÅÆ„Çà„ÅÜ„Å´Áîü„Åç„Çã„Åì„Å®„Å´„ÇÇËÄê„Åà„Çã„ÄÇ",
            "ÁßÅ„Åü„Å°„ÅÆÊôÇÈñì„ÅØÊúâÈôê„Å†„ÄÇÈôê„Çâ„Çå„ÅüÊôÇÈñì„ÅÆ‰∏≠„Åß„ÄÅ‰Ωï„ÇíÂ§ßÂàá„Å´„Åó„ÄÅ‰Ωï„ÇíÈÅ∏„Å≥Âèñ„Çã„Åã„ÄÇ",
            "Ë≥™Èáè„Å®‰ΩôÁôΩ„ÅÆÈñì„Åß„ÄÇË±ä„Åã„Å™ÂæåÊÇî„ÅÆÂ§ö„ÅÑ‰∫∫Áîü„Çí„ÄÇ",
            "ÁßÅ„Å´ÂøÖË¶Å„Å™ÁµåÈ®ì„Çí„Åè„Å†„Åï„ÅÑ„ÄÇ„Åæ„Å†„ÅÇ„Çã„Å®„Åô„Çã„ÅÆ„Å™„Çâ„ÄÅ„Åù„Çå„ÇíÁßÅ„Å´„Åè„Å†„Åï„ÅÑ„ÄÇ"
        ];

        const MONTHS = {
            1: { theme: 'ÂßãÂãï', revenue: '20‰∏á', quote: 'Âπ¥ÈñìË®àÁîªÁ¢∫ÂÆö„ÄÅ„Éâ„É©„É†Á∑¥ÁøíÈñãÂßã„ÄÅ„Éï„Ç°„Çπ„ÉÜ„Ç£„É≥„Ç∞ÁøíÊÖ£Âåñ', goals: ['Âπ¥ÈñìË®àÁîªÁ¢∫ÂÆö„ÉªÂÖ±Êúâ', '„Éâ„É©„É†Á∑¥ÁøíÈñãÂßã', '„Éï„Ç°„Çπ„ÉÜ„Ç£„É≥„Ç∞ÁøíÊÖ£Âåñ', 'Êúù„É´„Éº„ÉÜ„Ç£„É≥ÂÆöÁùÄ', 'ÊäïË≥áÂÆ∂„É™„Çπ„Éà‰ΩúÊàê', 'noteË®ò‰∫ã2Êú¨', 'ÁæéË°ìÂ±ï3Âõû', 'Ë™≠Êõ∏5ÂÜä'] },
            2: { theme: 'Ê∑±Êéò„Çä', revenue: '25‰∏á', quote: 'MBAÈõÜ‰∏≠„ÄÅ„Ç≥„Éº„ÉÅ„É≥„Ç∞Á†î‰øÆÁî≥Ëæº', goals: ['MBAÔºàË≤°Âãô„Éª‰ºöË®àÔºâÈõÜ‰∏≠', '„Ç≥„Éº„ÉÅ„É≥„Ç∞Á†î‰øÆÁî≥Ëæº', 'ËÑÜÂº±ÊÄßË´ñÊñá3Êú¨', '„Éî„ÉÉ„ÉÅÁ∑¥Áøí10Âõû', 'Ë™≠Êõ∏5ÂÜä', 'ÁæéË°ìÂ±ï3Âõû'] },
            3: { theme: 'ÂØæË©±', revenue: '30‰∏á', quote: '‰πÉÊú®ÂùÇÁâ©‰ª∂Êé¢„Åó„ÄÅyohakuÂñ∂Ê•≠Âº∑Âåñ', goals: ['‰πÉÊú®ÂùÇÁâ©‰ª∂ÂÜÖË¶ã3‰ª∂', 'ÊäïË≥áÂÆ∂Èù¢Ë´á3‰ª∂', 'NVC„ÉØ„Éº„ÇØ„Ç∑„Éß„ÉÉ„Éó', 'Ë™≠Êõ∏5ÂÜä', 'ÁæéË°ìÂ±ï3Âõû'] },
            4: { theme: 'ÁßªËª¢', revenue: '35‰∏á', quote: '‰πÉÊú®ÂùÇÂºïË∂ä„Åó„ÄÅÂÜôÁúüÂ±ï‰ºÅÁîªÈñãÂßã', goals: ['‰πÉÊú®ÂùÇÂºïË∂ä„ÅóÂÆå‰∫Ü', 'ÂÜôÁúüÂ±ï‰ºÅÁîªÊõ∏‰ΩúÊàê', '„Éï„Ç£„É´„É†5Êú¨ÊíÆÂΩ±', 'Ë™≠Êõ∏5ÂÜä', 'ÁæéË°ìÂ±ï3Âõû'] },
            5: { theme: '‰∫ãÊ•≠', revenue: '45‰∏á', quote: '„Ç∑„Éº„ÉâË™øÈÅî„ÄÅPxDT‰∏äÊúüÊàêÊûú', goals: ['yohakuÊúàÂïÜ50‰∏áÂÜÜ', 'PxDT‰∏äÊúüÊàêÊûú„Åæ„Å®„ÇÅ', 'ÊäïË≥áÂÆ∂Èù¢Ë´á5‰ª∂', 'Ë™≠Êõ∏5ÂÜä', 'ÁæéË°ìÂ±ï3Âõû'] },
            6: { theme: 'Ë©ï‰æ°', revenue: '50‰∏á', quote: 'PxDT‰∏äÊúüË©ï‰æ°„ÄÅ‰∏äÂçäÊúüÊåØ„ÇäËøî„Çä', goals: ['PxDT‰∏äÊúüË©ï‰æ°Èù¢Ë´á', '‰∏äÂçäÊúüÁ∑èÊåØ„ÇäËøî„Çä', '„Ç≥„Éº„ÉÅ„É≥„Ç∞Á†î‰øÆÈñãÂßã', 'Ë™≠Êõ∏4ÂÜä', 'ÁæéË°ìÂ±ï3Âõû'] },
            7: { theme: 'Á∂ôÊâø', revenue: '55‰∏á', quote: 'Ë≥áÊ†ºÁ†î‰øÆÈõÜ‰∏≠„ÄÅÂ∫ÉÂ≥∂', goals: ['„Ç≥„Éº„ÉÅ„É≥„Ç∞Ë≥áÊ†ºÁ†î‰øÆ', 'Êà¶‰∫â„Å®Ë®òÊÜ∂„ÅÆnote', 'Â∫ÉÂ≥∂Ë®™ÂïèË®àÁîªÁ¢∫ÂÆö', 'Ë™≠Êõ∏5ÂÜä', 'ÁæéË°ìÂ±ï3Âõû'] },
            8: { theme: 'Á•à„Çä', revenue: '55‰∏á', quote: '8Êúà6Êó•„ÄÅÂÇç„Å´„ÅÑ„Çã„Åì„Å®„ÅÆÊÑèÂë≥', goals: ['8/6 Â∫ÉÂ≥∂Ë®™Âïè', 'Ë≥áÊ†ºË©¶È®ìÊ∫ñÂÇô', 'ÂÜôÁúüÈÅ∏ÂÆö', 'Ë™≠Êõ∏4ÂÜä'] },
            9: { theme: 'Ë≥áÊ†º', revenue: '60‰∏á', quote: '„Ç≥„Éº„ÉÅ„É≥„Ç∞Ë≥áÊ†ºË©¶È®ì„ÄÅÂÜôÁúüÂ±ïÊ∫ñÂÇô', goals: ['„Ç≥„Éº„ÉÅ„É≥„Ç∞Ë≥áÊ†ºÂêàÊ†º', 'ÂÜôÁúüÂ±ïÊ∫ñÂÇôÊú¨Ê†ºÂåñ', '„Éó„É≠„Éà„Çø„Ç§„ÉóÈñãÁô∫', 'Ë™≠Êõ∏5ÂÜä', 'ÁæéË°ìÂ±ï3Âõû'] },
            10: { theme: 'Êé•Á∂ö', revenue: '70‰∏á', quote: '„ÉÜ„ÇØ„Éé„É≠„Ç∏„Éº„Å®„Ç±„Ç¢„ÅÆÈñì', goals: ['yohakuÊúàÂïÜ80‰∏áÂÜÜ', '„ÉÜ„ÇØ„Éé„É≠„Ç∏„Éº√ó„Ç±„Ç¢Ë´ñËÄÉ', 'ÂÜôÁúüÂ±ïÂëäÁü•', 'Ë™≠Êõ∏5ÂÜä', 'ÁæéË°ìÂ±ï3Âõû'] },
            11: { theme: 'Áô∫Ë°®', revenue: '85‰∏á', quote: '„Éï„Ç£„É´„É†ÂÜôÁúüÂ±ïÈñãÂÇ¨„ÄÅ„Çπ„Ç§„ÇπÊ∫ñÂÇô', goals: ['ÂÜôÁúüÂ±ïÈñãÂÇ¨„ÉªÊàêÂäü', 'PxDT‰∏ãÊúüÊàêÊûú', '„Çπ„Ç§„ÇπÊ∏°Ëà™Ê∫ñÂÇô', 'Ë™≠Êõ∏5ÂÜä', 'ÁæéË°ìÂ±ï2Âõû'] },
            12: { theme: 'ÈÅîÊàê', revenue: '100‰∏á', quote: 'yohakuÊúàÂïÜ100‰∏á„ÄÅ„Çπ„Ç§„ÇπÊ∏°Ëà™', goals: ['yohakuÊúàÂïÜ100‰∏áÂÜÜ', 'PxDT‰∏ãÊúüË©ï‰æ°„ÉªÊòáÊ†º', '„Çπ„Ç§„ÇπÊ∏°Ëà™', '2026Âπ¥Á∑èÊã¨note', '2027Âπ¥Ë®àÁîªÁ≠ñÂÆö', 'Ë™≠Êõ∏4ÂÜä'] }
        };

        const YEAR_GOALS = [
            { text: 'yohakuÊúàÂïÜ100‰∏áÂÜÜÈÅîÊàê', deadline: '12Êúà' },
            { text: 'PxDTÊòáÊ†º„ÉªÊòáÁµ¶', deadline: 'Ë©ï‰æ°Êúü' },
            { text: '„Ç≥„Éº„ÉÅ„É≥„Ç∞Ë≥áÊ†ºÂèñÂæó', deadline: '9Êúà' },
            { text: '„Éï„Ç£„É´„É†ÂÜôÁúüÂ±ïÈñãÂÇ¨', deadline: '11Êúà' },
            { text: '„Éâ„É©„É†Âü∫Á§éÁøíÂæó', deadline: 'ÈÄöÂπ¥' },
            { text: 'MBAÁßëÁõÆ‰øÆ‰∫Ü', deadline: 'ÈÄöÂπ¥' },
            { text: '‰πÉÊú®ÂùÇ„Å∏ÂºïË∂ä„Åó', deadline: '4Êúà' },
            { text: '„Çπ„Ç§„ÇπÊ∏°Ëà™', deadline: '12Êúà' }
        ];

        // Êúù„É´„Éº„ÉÜ„Ç£„É≥Ôºà7:00„ÄúÔºâ- 14ÊôÇÈñì„Éï„Ç°„Çπ„ÉÜ„Ç£„É≥„Ç∞ÂØæÂøú
        const MORNING_HABITS = [
            { id: 'water', name: 'Ëµ∑Â∫äÂæå„Åô„ÅêÊ∞¥„ÇíÈ£≤„ÇÄÔºà500mlÔºâ', duration: 2 },
            { id: 'sunlight', name: 'Êó•ÂÖâ„ÇíÊµ¥„Å≥„ÇãÔºà5ÂàÜÔºâ', duration: 5 },
            { id: 'morning_move', name: 'ËªΩ„ÅèÊ≠©„Åè or ‰Ωì„ÇíÂãï„Åã„ÅôÔºà5ÂàÜÔºâ', duration: 5 },
            { id: 'weight', name: '„Éà„Ç§„É¨Âæå„Å´‰ΩìÈáçÊ∏¨ÂÆö', duration: 2 },
            { id: 'caffeine', name: '„Ç´„Éï„Çß„Ç§„É≥„ÅØÂçàÂâç‰∏≠„ÅÆ„Åø ‚úì', duration: 1 }
        ];

        // Êó•‰∏≠„É´„Éº„ÉÜ„Ç£„É≥Ôºà11:00„ÄúÔºâ- 14ÊôÇÈñì„Éï„Ç°„Çπ„ÉÜ„Ç£„É≥„Ç∞Âæå„ÅÆÈ£ü‰∫ãÈñãÂßã
        const DAYTIME_HABITS = [
            { id: 'lunch', name: 'ÊòºÈ£üÔºöÈ´ò„Çø„É≥„Éë„ÇØ„Éª‰ΩéËÑÇË≥™„Éª‰ΩéÁ≥ñË≥™Ôºà11ÊôÇ‰ª•ÈôçÔºâ', duration: 30 },
            { id: 'no_snack', name: 'Áîò„ÅÑÁâ©„ÉªÈñìÈ£ü„Çí„Åó„Å™„ÅÑ ‚úì', duration: 1 },
            { id: 'hydration', name: 'Ê∞¥„Çí„Åì„Åæ„ÇÅ„Å´È£≤„ÇÄÔºàÂêàË®à2„Äú3LÔºâ‚úì', duration: 1 },
            { id: 'walk_17', name: '17ÊôÇÂâçÂæå„Å´5ÂàÜÊ≠©„Åè or „Çπ„Éà„É¨„ÉÉ„ÉÅ', duration: 5 },
            { id: 'walking', name: '„Ç¶„Ç©„Éº„Ç≠„É≥„Ç∞ÂêàË®à60„Äú90ÂàÜ', duration: 90 }
        ];

        // Â§ïÊñπ„É´„Éº„ÉÜ„Ç£„É≥Ôºà20:00„ÄúÔºâ- ÊúÄÂæå„ÅÆÈ£ü‰∫ã„ÅØ21ÊôÇ„Åæ„Åß
        const EVENING_HABITS = [
            { id: 'dinner', name: 'Â§ïÈ£üÔºà20:00-21:00Ôºâ‚Üí 14ÊôÇÈñì„Éï„Ç°„Çπ„ÉÜ„Ç£„É≥„Ç∞ÈñãÂßã', duration: 60 },
            { id: 'work_end', name: '21:00„Å´‰ªï‰∫ãÁµÇ‰∫ÜÔºàPC„ÇíÈñâ„Åò„ÇãÔºâ', duration: 5 },
            { id: 'review', name: '‰ªäÊó•„ÇÑ„Å£„Åü„Åì„Å®„Çí3„Å§Êõ∏„ÅèÔºàË©ï‰æ°„Åó„Å™„ÅÑÔºâ', duration: 10 },
            { id: 'reset', name: 'Êï£Ê≠© or „Ç∑„É£„ÉØ„ÉºÔºà15ÂàÜ„ÉªËÄÉ„Åà‰∫ãÁ¶ÅÊ≠¢Ôºâ', duration: 15 }
        ];

        // Â§ú„É´„Éº„ÉÜ„Ç£„É≥Ôºà22:00„ÄúÔºâ- Âà§Êñ≠Á¶ÅÊ≠¢„Çæ„Éº„É≥
        const NIGHT_HABITS = [
            { id: 'no_calorie', name: '22ÊôÇ‰ª•Èôç„ÅØ„Éé„É≥„Ç´„É≠„É™„Éº„ÅÆ„Åø ‚úì', duration: 1 },
            { id: 'no_decision', name: 'Âà§Êñ≠„ÉªÊÄùËÄÉ„ÅåÂøÖË¶Å„Å™‰ΩúÊ•≠„Çí„Åó„Å™„ÅÑ ‚úì', duration: 1 },
            { id: 'bed', name: '0ÊôÇÂâç„Å´Â∏ÉÂõ£„Å´ÂÖ•„Çã', duration: 10 }
        ];

        // ÈÄ±3Âõû„ÅÆÁ≠ã„Éà„É¨
        const STRENGTH_HABITS = [
            { id: 'squat', name: '„Çπ„ÇØ„ÉØ„ÉÉ„Éà20Âõû√ó3', duration: 10 },
            { id: 'pushup', name: 'ËÖïÁ´ã„Å¶10Âõû√ó3', duration: 10 },
            { id: 'plank', name: '„Éó„É©„É≥„ÇØ30Áßí√ó3', duration: 5 }
        ];

        const WEEKLY_ACTIVITIES = [
            { id: 'mba', name: 'MBAÂ≠¶Áøí', icon: 'üìö', day: 'Êúà„ÉªÊ∞¥„ÉªÊó•' },
            { id: 'drum', name: '„Éâ„É©„É†Á∑¥Áøí', icon: 'ü•Å', day: 'ÁÅ´„ÉªÊú®' },
            { id: 'nvc', name: 'NVC„Çª„ÉÉ„Ç∑„Éß„É≥', icon: 'üí¨', day: 'ÁÅ´' },
            { id: 'film', name: '„Éï„Ç£„É´„É†ÊíÆÂΩ±', icon: 'üì∑', day: 'Âúü„ÉªÊó•' },
            { id: 'art', name: 'ÁæéË°ìÂ±ï', icon: 'üé®', day: 'Âúü„ÉªÊó•' },
            { id: 'tea', name: 'Ëå∂ÈÅì', icon: 'üçµ', day: 'Êúà1Âõû ÂúüÊõú' },
            { id: 'fasting', name: '24h„Éï„Ç°„Çπ„ÉÜ„Ç£„É≥„Ç∞', icon: 'üåô', day: 'Êúà1Âõû' }
        ];

        const MONTHLY_BOOKS = {
            1: [{ title: '„Éó„É≠„Éï„Çß„ÉÉ„Ç∑„Éß„Éä„É´ÂéüË´ñ', author: 'Ê≥¢È†≠‰∫Æ' }, { title: '„Ç±„Ç¢„ÅÆÂÄ´ÁêÜ', author: 'Â≤°ÈáéÂÖ´‰ª£' }, { title: 'Â≠òÂú®„Å®ÊôÇÈñìÔºàÂÖ•ÈñÄÊõ∏Ôºâ', author: '„Éè„Ç§„Éá„Ç¨„Éº' }, { title: '‰∫∫ÈñìÂ§±Ê†º', author: 'Â§™ÂÆ∞Ê≤ª' }, { title: 'Áèæ‰ª£„Ç¢„Éº„Éà„Å®„ÅØ‰Ωï„Åã', author: 'Â∞èÂ¥éÂì≤Âìâ' }],
            2: [{ title: '„ÇÇ„ÅÜ„Å≤„Å®„Å§„ÅÆÂ£∞„Åß', author: '„ÇÆ„É™„Ç¨„É≥' }, { title: 'MBA„Éï„Ç°„Ç§„Éä„É≥„Çπ', author: '„Ç∞„É≠„Éº„Éì„Çπ' }, { title: 'Ë´ñË™ûÔºàÊñ∞Ë®≥Ôºâ', author: '' }, { title: '„Åì„Åì„Çç', author: 'Â§èÁõÆÊº±Áü≥' }, { title: 'ÁæéË°ì„ÅÆÁâ©Ë™û', author: '„Ç¥„É≥„Éñ„É™„ÉÉ„ÉÅ' }],
            3: [{ title: '„Ç±„Ç¢„ÅÆÂÄ´ÁêÜ„Å®ÂÖ±ÊÑü', author: '„Çπ„É≠„Éº„Éà' }, { title: 'NVC ‰∫∫„Å®‰∫∫„Å®„ÅÆÈñ¢‰øÇ„Å´„ÅÑ„ÅÆ„Å°„ÇíÂêπ„ÅçËæº„ÇÄÊ≥ï', author: '„É≠„Éº„Çº„É≥„Éê„Éº„Ç∞' }],
            4: [{ title: 'Êòé„Çã„ÅÑÈÉ®Â±ã', author: '„Éê„É´„Éà' }, { title: 'ÂÜôÁúüË´ñ', author: '„ÇΩ„É≥„Çø„Ç∞' }],
            5: [{ title: '2030Âπ¥„ÅÆ‰∏ñÁïåÂú∞Âõ≥Â∏≥', author: 'ËêΩÂêàÈôΩ‰∏Ä' }, { title: '„Éá„Ç∏„Çø„É´„Éç„Ç§„ÉÅ„É£„Éº', author: 'ËêΩÂêàÈôΩ‰∏Ä' }],
            6: [{ title: '„ÅÑ„ÅÆ„Å°„ÅØ„ÅÆ„Å°„ÅÆ„ÅÑ„ÅÆ„Å°„Å∏', author: 'Á®≤Ëëâ‰øäÈÉé' }],
            7: [{ title: '‰ªñËÄÖ„ÅÆËã¶Áóõ„Å∏„ÅÆ„Åæ„Å™„Åñ„Åó', author: '„ÇΩ„É≥„Çø„Ç∞' }, { title: 'Â§ú„Å®Èúß', author: '„Éï„É©„É≥„ÇØ„É´' }],
            8: [{ title: 'ÂéüÁàÜË©©ÈõÜ', author: 'Â≥†‰∏âÂêâ' }, { title: '„Éí„É≠„Ç∑„Éû„Éª„Éé„Éº„Éà', author: 'Â§ßÊ±üÂÅ•‰∏âÈÉé' }],
            9: [{ title: 'ÊÑõ„Åô„Çã„Å®„ÅÑ„ÅÜ„Åì„Å®', author: '„Éï„É≠„É†' }, { title: 'Êöá„Å®ÈÄÄÂ±à„ÅÆÂÄ´ÁêÜÂ≠¶', author: 'ÂúãÂàÜÂäü‰∏ÄÈÉé' }],
            10: [{ title: 'ÁîüÂëΩ„Å®„ÅØ‰Ωï„Åã', author: '„Ç∑„É•„É¨„Éº„Éá„Ç£„É≥„Ç¨„Éº' }, { title: 'ÁîüÁâ©„Åã„ÇâË¶ã„Åü‰∏ñÁïå', author: '„É¶„ÇØ„Çπ„Ç≠„É•„É´' }],
            11: [{ title: 'Ë¥à‰∏éË´ñ', author: '„É¢„Éº„Çπ' }],
            12: [{ title: '„ÉÑ„Ç°„É©„Éà„Ç•„Çπ„Éà„É©', author: '„Éã„Éº„ÉÅ„Çß' }, { title: 'Èõ™ÂõΩ', author: 'Â∑ùÁ´ØÂ∫∑Êàê' }]
        };

        // 5Âπ¥Ë®àÁîª„ÅÆË©≥Á¥∞„Éá„Éº„Çø
        const FIVE_YEAR_PLAN = {
            2026: {
                theme: 'Âü∫Áõ§ÊßãÁØâ', revenue: '1,500‰∏á',
                breakdown: { pxdt: '900‰∏á', hb: '100‰∏á', yohaku: '500‰∏á' },
                yohakuMonthly: '42‰∏á',
                quarters: [
                    { q: 'Q1', period: '1-3Êúà', revenue: '20‚Üí30‰∏á', cumulative: '75‰∏á', events: '„Ç≥„Éº„ÉÅ„É≥„Ç∞Ë≥áÊ†ºÁ†î‰øÆÈñãÂßã' },
                    { q: 'Q2', period: '4-6Êúà', revenue: '35‚Üí50‰∏á', cumulative: '200‰∏á', events: '‰πÉÊú®ÂùÇÂºïË∂ä„Åó„ÄÅPxDT‰∏äÊúüË©ï‰æ°' },
                    { q: 'Q3', period: '7-9Êúà', revenue: '50‚Üí60‰∏á', cumulative: '365‰∏á', events: '„Ç≥„Éº„ÉÅ„É≥„Ç∞Ë≥áÊ†ºÂèñÂæó' },
                    { q: 'Q4', period: '10-12Êúà', revenue: '70‚Üí100‰∏á', cumulative: '500‰∏á', events: 'ÂÜôÁúüÂ±ï„ÄÅ„Çπ„Ç§„Çπ„ÄÅPxDT‰∏ãÊúüË©ï‰æ°' }
                ],
                smartGoals: {
                    business: ['PxDTÔºöÊòáÊ†ºÔºà6ÊúàË©ï‰æ°Ôºâ„ÄÅÂπ¥Âèé900‰∏áÂÜÜÈÅîÊàê', 'HERALBONYÔºöÊúàÈ°ç8‰∏áÂÜÜÂÆâÂÆö„ÄÅÂπ¥Èñì100‰∏áÂÜÜ', 'yohakuÔºö12Êúà„Å´ÊúàÂïÜ100‰∏áÂÜÜÈÅîÊàê', '„Ç≥„Éº„ÉÅ„É≥„Ç∞Ë≥áÊ†ºÔºö9ÊúàÂèñÂæó'],
                    skill: ['MBAÁßëÁõÆÔºöÂπ¥Èñì12ÁßëÁõÆ‰øÆ‰∫Ü', 'Ë™≠Êõ∏Ôºö57ÂÜäÔºàÊúà4-5ÂÜäÔºâ', 'ÁæéË°ìÂ±ïÔºö36ÂõûÔºàÊúà3ÂõûÔºâ'],
                    artist: ['„Éï„Ç£„É´„É†ÂÜôÁúüÂ±ïÔºö11ÊúàÈñãÂÇ¨', '„Éâ„É©„É†ÔºöÂü∫Á§éÁøíÂæó„ÄÅ„Çπ„Çø„Ç∏„Ç™Á∑¥ÁøíÈÄ±2Âõû'],
                    life: ['‰πÉÊú®ÂùÇÂºïË∂ä„ÅóÔºö4Êúà', '‰ΩìÈáç60kgÁ∂≠ÊåÅ', '„Çπ„Ç§„ÇπÊ∏°Ëà™Ôºö12Êúà']
                }
            },
            2027: {
                theme: 'Â∞ÇÈñÄÊ∑±Âåñ', revenue: '2,000‰∏á',
                breakdown: { pxdt: '1,100‰∏á', hb: '100‰∏á', yohaku: '800‰∏á' },
                yohakuMonthly: '67‰∏á',
                quarters: [
                    { q: 'Q1', period: '1-3Êúà', revenue: '50‚Üí60‰∏á', cumulative: '165‰∏á', events: '„Ç≥„Éº„ÉÅ„É≥„Ç∞È°ßÂÆ¢5Âêç‰ΩìÂà∂' },
                    { q: 'Q2', period: '4-6Êúà', revenue: '65‚Üí75‰∏á', cumulative: '375‰∏á', events: '„Éê„Ç§„ÇØÂÖçË®±ÂèñÂæó„ÄÅÂÜôÁúüÂ±ï‰ºÅÁîª' },
                    { q: 'Q3', period: '7-9Êúà', revenue: '75‚Üí85‰∏á', cumulative: '615‰∏á', events: '„Éâ„É©„É†Âàù„É©„Ç§„Éñ„ÄÅ„É®„Éº„É≠„ÉÉ„ÉëÊóÖË°å' },
                    { q: 'Q4', period: '10-12Êúà', revenue: '90‚Üí100‰∏á', cumulative: '800‰∏á', events: 'ÂÜôÁúüÂ±ï„ÄÅyohaku App‰ºÅÁîªÈñãÂßã' }
                ],
                smartGoals: {
                    business: ['PxDTÔºöÂπ¥Âèé1,100‰∏áÂÜÜ', 'yohakuÔºöÊúàÂïÜ100‰∏áÂÜÜÂÆâÂÆöÂåñ', '„Ç≥„Éº„ÉÅ„É≥„Ç∞È°ßÂÆ¢ÔºöÊúà5ÂêçÁ∂ôÁ∂ö', 'Ë¨õÊºîÔºöÂπ¥8Âõû'],
                    skill: ['MBAÔºöÂÖ®ÁßëÁõÆ‰øÆ‰∫Ü', 'Ë™≠Êõ∏Ôºö60ÂÜä', 'ÁæéË°ìÂ±ïÔºö36Âõû'],
                    artist: ['ÂÜôÁúüÂ±ïÔºöÁ¨¨2ÂõûÈñãÂÇ¨', '„Éâ„É©„É†ÔºöÂàù„É©„Ç§„ÉñÂá∫Êºî', '„Éî„Ç¢„ÉéÔºöÂü∫Á§éÊõ≤3Êõ≤ÁøíÂæó'],
                    life: ['„Éê„Ç§„ÇØÂÖçË®±ÔºöÂèñÂæó', 'Êµ∑Â§ñÊóÖË°åÔºö„É®„Éº„É≠„ÉÉ„Éë']
                }
            },
            2028: {
                theme: '‰∫ãÊ•≠Êã°Â§ß', revenue: '5,000‰∏á',
                breakdown: { pxdt: '1,300‰∏á', hb: '120‰∏á', yohaku: '3,580‰∏á' },
                yohakuMonthly: '300‰∏á',
                quarters: [
                    { q: 'Q1', period: '1-3Êúà', revenue: '150‚Üí200‰∏á', cumulative: '525‰∏á', events: '„ÉÅ„Éº„É†„É°„É≥„Éê„ÉºÊé°Áî®ÈñãÂßã' },
                    { q: 'Q2', period: '4-6Êúà', revenue: '220‚Üí270‰∏á', cumulative: '1,260‰∏á', events: 'yohaku AppŒ≤Áâà„É≠„Éº„É≥„ÉÅ' },
                    { q: 'Q3', period: '7-9Êúà', revenue: '280‚Üí300‰∏á', cumulative: '2,130‰∏á', events: '„Éê„É≥„ÉâÊ¥ªÂãïÊú¨Ê†ºÂåñ' },
                    { q: 'Q4', period: '10-12Êúà', revenue: '310‚Üí330‰∏á', cumulative: '3,580‰∏á', events: 'Á¨¨3ÂõûÂÜôÁúüÂ±ï' }
                ],
                smartGoals: {
                    business: ['yohakuÔºöÊúàÂïÜ300‰∏áÂÜÜÈÅîÊàê', 'yohaku AppÔºö„É≠„Éº„É≥„ÉÅ„ÄÅMAU 1,000', '„ÉÅ„Éº„É†Ôºö2ÂêçÊé°Áî®', '„Ç±„Ç¢‰∫ãÊ•≠ÔºöBtoBÁ†î‰øÆ10Á§æÂ∞éÂÖ•'],
                    skill: ['Ë¨õÊºîÔºöÂπ¥20Âõû'],
                    artist: ['ÂÜôÁúüÂ±ïÔºöÁ¨¨3Âõû', '„Éâ„É©„É†Ôºö„Éê„É≥„ÉâÂä†ÂÖ• or ÁµêÊàê'],
                    life: ['„Éê„Ç§„ÇØË≥ºÂÖ•„Éª„ÉÑ„Éº„É™„É≥„Ç∞ÈñãÂßã', 'Êµ∑Â§ñÔºö3Âõû']
                }
            },
            2029: {
                theme: 'Â§öËßíÂåñ', revenue: '7,000‰∏á',
                breakdown: { pxdt: '1,500‰∏á', hb: '120‰∏á', yohaku: '5,380‰∏á' },
                yohakuMonthly: '450‰∏á',
                quarters: [
                    { q: 'Q1', period: '1-3Êúà', revenue: '350‚Üí400‰∏á', cumulative: '1,125‰∏á', events: '„ÉÅ„Éº„É†5ÂêçÂåñ' },
                    { q: 'Q2', period: '4-6Êúà', revenue: '420‚Üí450‰∏á', cumulative: '2,430‰∏á', events: 'Êµ∑Â§ñÂ∏ÇÂ†¥Ë™øÊüª' },
                    { q: 'Q3', period: '7-9Êúà', revenue: '460‚Üí480‰∏á', cumulative: '3,840‰∏á', events: 'Ëá™‰∏ª‰ºÅÁîª„É©„Ç§„Éñ' },
                    { q: 'Q4', period: '10-12Êúà', revenue: '490‚Üí500‰∏á', cumulative: '5,380‰∏á', events: 'Á¨¨4ÂõûÂÜôÁúüÂ±ïÔºàÊµ∑Â§ñÊ§úË®éÔºâ' }
                ],
                smartGoals: {
                    business: ['yohakuÔºöÊúàÂïÜ500‰∏áÂÜÜÈÅîÊàê', '„ÉÅ„Éº„É†Ôºö5Âêç‰ΩìÂà∂', 'yohaku AppÔºöMAU 5,000', '„Ç±„Ç¢‰∫ãÊ•≠ÔºöSaaSÂåñÁùÄÊâã'],
                    skill: ['Ë¨õÊºîÔºöÂπ¥30ÂõûÔºàÊ•≠ÁïåË™çÁü•Á¢∫Á´ãÔºâ'],
                    artist: ['ÂÜôÁúüÂ±ïÔºöÁ¨¨4ÂõûÔºàÊµ∑Â§ñÊ§úË®éÔºâ', '„Éâ„É©„É†ÔºöËá™‰∏ª‰ºÅÁîª„É©„Ç§„ÉñÈñãÂÇ¨'],
                    life: ['„Éê„Ç§„ÇØ„ÉÑ„Éº„É™„É≥„Ç∞ÔºöÂõΩÂÜÖÂà∂Ë¶áË®àÁîª', 'Êµ∑Â§ñÔºö3Âõû‰ª•‰∏ä']
                }
            },
            2030: {
                theme: 'Áµ±Âêà', revenue: '1ÂÑÑ',
                breakdown: { pxdt: '1,800‰∏á', hb: '120‰∏á', yohaku: '8,080‰∏á' },
                yohakuMonthly: '670‰∏á',
                quarters: [
                    { q: 'Q1', period: '1-3Êúà', revenue: '550‚Üí600‰∏á', cumulative: '1,725‰∏á', events: '‰∫ãÊ•≠Áµ±Âêà„ÄÅÂäπÁéáÂåñ' },
                    { q: 'Q2', period: '4-6Êúà', revenue: '620‚Üí670‰∏á', cumulative: '3,660‰∏á', events: 'Êµ∑Â§ñÂ±ïÈñãÊú¨Ê†ºÂåñ' },
                    { q: 'Q3', period: '7-9Êúà', revenue: '680‚Üí700‰∏á', cumulative: '5,730‰∏á', events: 'Èü≥Ê•ΩÊ¥ªÂãïÈõÜÂ§ßÊàê' },
                    { q: 'Q4', period: '10-12Êúà', revenue: '720‚Üí800‰∏á', cumulative: '8,080‰∏á', events: 'Á¨¨5ÂõûÂÜôÁúüÂ±ï„ÄÅÂπ¥Âèé1ÂÑÑÈÅîÊàê' }
                ],
                smartGoals: {
                    business: ['yohakuÔºöÂπ¥ÂïÜ1ÂÑÑÂÜÜÈÅîÊàê', '„ÉÅ„Éº„É†Ôºö10Âêç‰ΩìÂà∂', 'yohaku AppÔºöMAU 20,000', '„Ç±„Ç¢SaaSÔºöARR 1,800‰∏áÂÜÜ'],
                    skill: ['Ê•≠Áïå„Åß„ÅÆË™çÁü•Ôºö„Ç±„Ç¢√ó„ÉÜ„ÇØ„Éé„É≠„Ç∏„Éº„ÅÆÁ¨¨‰∏Ä‰∫∫ËÄÖ'],
                    artist: ['ÂÜôÁúüÂ±ïÔºöÁ¨¨5ÂõûÔºà5Âπ¥ÈÄ£Á∂öÈÅîÊàêÔºâ', 'Èü≥Ê•ΩÔºö„Ç¢„É´„Éê„É†Âà∂‰Ωú or ÂÆöÊúü„É©„Ç§„Éñ'],
                    life: ['ÁµåÊ∏àÁöÑËá™Áî±„ÅÆÂü∫Áõ§Á¢∫Á´ã', 'Êµ∑Â§ñÔºö4Âõû‰ª•‰∏ä']
                }
            }
        };

        const HEALTH_ITEMS = [
            { id: 'weight', label: '‰ΩìÈáç', icon: '‚öñÔ∏è', unit: 'kg', default: '60.0' },
            { id: 'sleep', label: 'Áù°Áú†', icon: 'üò¥', unit: 'ÊôÇÈñì', default: '7.0' },
            { id: 'steps', label: 'Ê≠©Êï∞', icon: 'üëü', unit: 'Ê≠©', default: '8000' },
            { id: 'water', label: 'Ê∞¥ÂàÜ', icon: 'üíß', unit: 'L', default: '2.0' }
        ];

        const DEFAULT_KEYWORDS = ['AI', 'Èõ£ËÅ¥', '„Éò„É©„É´„Éú„Éã„Éº', '„Ç¢„Éº„Éà', '„Éî„ÇØ„Ç∑„Éº„ÉÄ„Çπ„Éà„ÉÜ„ÇØ„Éé„É≠„Ç∏„Éº„Ç∫', 'Ë™çÁü•Áóá'];

        // ============================================
        // STATE
        // ============================================
        let currentDate = new Date();
        let calendarViewDate = new Date();
        let selectedGoalMonth = 1;
        let selectedPlanYear = 2026;
        let db = null;
        let newsKeywords = [...DEFAULT_KEYWORDS];
        let settings = { morningStart: '07:00', daytimeStart: '11:00', eveningStart: '20:00', nightStart: '22:00' };
        
        // Âè§„ÅÑID„Åã„ÇâÊñ∞„Åó„ÅÑID„Å∏„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞Ôºà„Éá„Éº„ÇøÁßªË°åÁî®Ôºâ
        const HABIT_ID_MIGRATION = {
            // ÊóßÊúù„É´„Éº„ÉÜ„Ç£„É≥ ‚Üí Êñ∞Êúù„É´„Éº„ÉÜ„Ç£„É≥
            'wake': 'water',           // Ëµ∑Â∫ä„ÉªÁôΩÊπØ ‚Üí Ê∞¥500ml
            'meditation': null,        // ÁûëÊÉ≥ÔºàÂâäÈô§Ôºâ
            'walk': 'morning_move',    // ÊúùÊï£Ê≠© ‚Üí ËªΩÈÅãÂãï
            'exercise': null,          // „Éà„É¨„Éº„Éã„É≥„Ç∞ÔºàÂâäÈô§Ôºâ
            'breakfast': null,         // ÊúùÈ£üÔºàÂâäÈô§ - „Éï„Ç°„Çπ„ÉÜ„Ç£„É≥„Ç∞Ôºâ
            // ÊóßÂ§ú„É´„Éº„ÉÜ„Ç£„É≥ ‚Üí Êñ∞Â§ïÊñπ/Â§ú„É´„Éº„ÉÜ„Ç£„É≥
            'reading': null,           // Ë™≠Êõ∏ÔºàÂâäÈô§Ôºâ
            'study': null,             // MBAÂ≠¶ÁøíÔºàÂâäÈô§Ôºâ
            'journal': 'review',       // Êó•Ë®ò ‚Üí ÊåØ„ÇäËøî„Çä
            'night_meditation': 'reset' // ÂÖ•Êµ¥ ‚Üí „É™„Çª„ÉÉ„Éà
        };

        // ============================================
        // THEME
        // ============================================
        function updateTheme() {
            const hour = new Date().getHours();
            const isDark = hour >= 18 || hour < 6;
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
            document.querySelector('meta[name="theme-color"]').content = isDark ? '#0d0d14' : '#faf9f7';
        }

        // ============================================
        // IndexedDB
        // ============================================
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('YohakuDB', 5);
                request.onerror = () => reject(request.error);
                request.onsuccess = () => { db = request.result; resolve(db); };
                request.onupgradeneeded = (e) => {
                    const database = e.target.result;
                    ['habits', 'goals', 'health', 'notes', 'books', 'images', 'customBooks', 'settings', 'keywords'].forEach(store => {
                        if (!database.objectStoreNames.contains(store)) {
                            database.createObjectStore(store, { keyPath: 'id', autoIncrement: store === 'customBooks' });
                        }
                    });
                };
            });
        }

        async function dbGet(store, key) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction([store], 'readonly');
                const req = tx.objectStore(store).get(key);
                req.onerror = () => reject(req.error);
                req.onsuccess = () => resolve(req.result);
            });
        }

        async function dbPut(store, data) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction([store], 'readwrite');
                const req = tx.objectStore(store).put(data);
                req.onerror = () => reject(req.error);
                req.onsuccess = () => resolve(req.result);
            });
        }

        async function dbGetAll(store) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction([store], 'readonly');
                const req = tx.objectStore(store).getAll();
                req.onerror = () => reject(req.error);
                req.onsuccess = () => resolve(req.result);
            });
        }
        
        // „Éá„Éº„Çø„Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥: Âè§„ÅÑID„ÅÆ„Éá„Éº„Çø„ÇíÊñ∞„Åó„ÅÑID„Å´„Ç≥„Éî„Éº
        async function migrateHabitData() {
            const migrationDone = await dbGet('settings', 'migrationV2Done');
            if (migrationDone?.done) return; // Êó¢„Å´„Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥Ê∏à„Åø
            
            const allHabits = await dbGetAll('habits');
            for (const habit of allHabits) {
                // Âè§„ÅÑID„ÇíÊ§úÂá∫„Åó„Å¶„Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥
                for (const [oldId, newId] of Object.entries(HABIT_ID_MIGRATION)) {
                    if (newId && habit.id.includes(`-morning-${oldId}`) && habit.completed) {
                        const newKey = habit.id.replace(`-morning-${oldId}`, `-morning-${newId}`);
                        const existing = await dbGet('habits', newKey);
                        if (!existing) {
                            await dbPut('habits', { id: newKey, completed: true });
                        }
                    }
                    if (newId && habit.id.includes(`-evening-${oldId}`) && habit.completed) {
                        const newKey = habit.id.replace(`-evening-${oldId}`, `-evening-${newId}`);
                        const existing = await dbGet('habits', newKey);
                        if (!existing) {
                            await dbPut('habits', { id: newKey, completed: true });
                        }
                    }
                }
            }
            
            await dbPut('settings', { id: 'migrationV2Done', done: true, timestamp: new Date().toISOString() });
            console.log('„Éá„Éº„Çø„Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥ÂÆå‰∫Ü');
        }
        
        // ‰ΩìÈáç„ÇíÂâçÊó•„Åã„ÇâÂºï„ÅçÁ∂ô„Åê
        async function getPreviousWeight() {
            // ÈÅéÂéª7Êó•Èñì„ÇíÊé¢„Åô
            for (let i = 1; i <= 7; i++) {
                const prevDate = new Date(currentDate);
                prevDate.setDate(prevDate.getDate() - i);
                const dateKey = formatDate(prevDate);
                const data = await dbGet('health', `${dateKey}-weight`);
                if (data?.value) {
                    return data.value;
                }
            }
            return '60.0'; // „Éá„Éï„Ç©„É´„ÉàÂÄ§
        }

        // ============================================
        // UTILITIES
        // ============================================
        function formatDate(date) { return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`; }
        function getDateKey() { return formatDate(currentDate); }
        function getWeekday(date) { return ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'][date.getDay()]; }
        function showToast(msg = '‰øùÂ≠ò„Åó„Åæ„Åó„Åü') { const t = document.getElementById('toast'); t.textContent = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2000); }
        
        function addMinutes(timeStr, minutes) {
            const [h, m] = timeStr.split(':').map(Number);
            const totalMinutes = h * 60 + m + minutes;
            const newH = Math.floor(totalMinutes / 60) % 24;
            const newM = totalMinutes % 60;
            return `${String(newH).padStart(2, '0')}:${String(newM).padStart(2, '0')}`;
        }
        
        function timeToMinutes(timeStr) { const [h, m] = timeStr.split(':').map(Number); return h * 60 + m; }
        
        function isInTimeRange(start, durationMinutes) {
            const now = new Date();
            const current = now.getHours() * 60 + now.getMinutes();
            const startM = timeToMinutes(start);
            const endM = startM + durationMinutes;
            return current >= startM && current <= endM;
        }

        // ============================================
        // TIME & PERIOD
        // ============================================
        function getTotalDuration(habits) {
            return habits.reduce((sum, h) => sum + h.duration, 0);
        }
        
        function updateDateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            const morningStart = timeToMinutes(settings.morningStart);           // 7:00
            const daytimeStart = timeToMinutes(settings.daytimeStart || '11:00'); // 11:00
            const eveningStart = timeToMinutes(settings.eveningStart);            // 20:00
            const nightStart = timeToMinutes(settings.nightStart || '22:00');     // 22:00
            
            const periodEl = document.getElementById('timePeriod');
            const morningSection = document.getElementById('morningSection');
            const daytimeSection = document.getElementById('daytimeSection');
            const eveningSection = document.getElementById('eveningSection');
            const nightSection = document.getElementById('nightSection');
            
            // „É™„Çª„ÉÉ„Éà
            periodEl.className = 'time-period';
            periodEl.style.background = '';
            periodEl.style.color = '';
            morningSection.classList.remove('highlighted');
            daytimeSection.classList.remove('highlighted');
            daytimeSection.style.background = '';
            eveningSection.classList.remove('highlighted', 'evening');
            nightSection.classList.remove('highlighted');
            nightSection.style.background = '';
            
            if (currentMinutes >= morningStart && currentMinutes < daytimeStart) {
                periodEl.textContent = 'üåÖ Êúù„ÅÆ„É´„Éº„ÉÜ„Ç£„É≥Ôºà„Éï„Ç°„Çπ„ÉÜ„Ç£„É≥„Ç∞‰∏≠Ôºâ';
                periodEl.classList.add('morning');
                morningSection.classList.add('highlighted');
            } else if (currentMinutes >= daytimeStart && currentMinutes < eveningStart) {
                periodEl.textContent = '‚òÄÔ∏è Êó•‰∏≠ÔºàÈ£ü‰∫ãOK 11:00-21:00Ôºâ';
                periodEl.style.background = 'var(--accent-sage-dim)';
                periodEl.style.color = 'var(--accent-sage)';
                daytimeSection.classList.add('highlighted');
                daytimeSection.style.background = 'var(--accent-sage-dim)';
            } else if (currentMinutes >= eveningStart && currentMinutes < nightStart) {
                periodEl.textContent = 'üåÜ Â§ïÊñπÔºàÂ§ïÈ£ü„ÅØ21ÊôÇ„Åæ„ÅßÔºâ';
                periodEl.classList.add('evening');
                eveningSection.classList.add('highlighted', 'evening');
            } else if (currentMinutes >= nightStart || currentMinutes < morningStart) {
                periodEl.textContent = 'üåô Âà§Êñ≠Á¶ÅÊ≠¢„Çæ„Éº„É≥Ôºà„Éé„É≥„Ç´„É≠„É™„Éº„ÅÆ„ÅøÔºâ';
                periodEl.style.background = 'rgba(139, 92, 246, 0.15)';
                periodEl.style.color = '#8b5cf6';
                nightSection.classList.add('highlighted');
                nightSection.style.background = 'rgba(139, 92, 246, 0.15)';
            }
            
            updateTheme();
        }

        function updateTimeRangeDisplay() {
            document.getElementById('morningTimeBadge').textContent = `${settings.morningStart}„Äú`;
            document.getElementById('daytimeTimeBadge').textContent = `${settings.daytimeStart || '12:00'}„Äú`;
            document.getElementById('eveningTimeBadge').textContent = `${settings.eveningStart}„Äú`;
            document.getElementById('nightTimeBadge').textContent = `${settings.nightStart || '22:00'}„Äú`;
        }

        // ============================================
        // RENDER FUNCTIONS
        // ============================================
        function updateDateDisplay() {
            document.querySelector('#currentDate .date-text').textContent = `${currentDate.getMonth() + 1}Êúà${currentDate.getDate()}Êó•`;
            document.querySelector('#currentDate .weekday').textContent = getWeekday(currentDate);
        }

        function updateQuote() {
            const dayOfYear = Math.floor((currentDate - new Date(currentDate.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            document.getElementById('dailyQuote').textContent = QUOTES[dayOfYear % QUOTES.length];
        }

        function updateMonthCard() {
            const month = currentDate.getMonth() + 1;
            const data = MONTHS[month];
            document.getElementById('monthTheme').textContent = data.theme;
            document.getElementById('monthRevenue').textContent = `¬•${data.revenue}`;
            document.getElementById('monthQuote').textContent = data.quote;
        }

        async function renderHabits(habits, containerId, period, progressId, startTime) {
            const container = document.getElementById(containerId);
            const dateKey = getDateKey();
            let completed = 0;
            let currentTime = startTime;
            container.innerHTML = '';
            
            for (const habit of habits) {
                const key = `${dateKey}-${period}-${habit.id}`;
                const data = await dbGet('habits', key);
                const isCompleted = data?.completed || false;
                if (isCompleted) completed++;
                
                const timeDisplay = currentTime;
                currentTime = addMinutes(currentTime, habit.duration);
                
                const item = document.createElement('div');
                item.className = `habit-item ${isCompleted ? 'completed' : ''}`;
                item.onclick = () => toggleHabit(period, habit.id);
                item.innerHTML = `
                    <div class="habit-checkbox"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div>
                    <div class="habit-info">
                        <div class="habit-name">${habit.name}</div>
                        <div class="habit-time">${timeDisplay}„ÄúÔºà${habit.duration}ÂàÜÔºâ</div>
                    </div>`;
                container.appendChild(item);
            }
            document.getElementById(progressId).textContent = `${completed}/${habits.length}`;
        }

        async function renderMorningHabits() { await renderHabits(MORNING_HABITS, 'morningHabits', 'morning', 'morningProgress', settings.morningStart); }
        async function renderDaytimeHabits() { await renderHabits(DAYTIME_HABITS, 'daytimeHabits', 'daytime', 'daytimeProgress', settings.daytimeStart || '12:00'); }
        async function renderEveningHabits() { await renderHabits(EVENING_HABITS, 'eveningHabits', 'evening', 'eveningProgress', settings.eveningStart); }
        async function renderNightHabits() { await renderHabits(NIGHT_HABITS, 'nightHabits', 'night', 'nightProgress', settings.nightStart || '22:00'); }
        
        async function renderStrengthHabits() {
            const container = document.getElementById('strengthHabits');
            const dateKey = getDateKey();
            const dayOfWeek = currentDate.getDay();
            const isStrengthDay = [1, 3, 5].includes(dayOfWeek); // Êúà„ÉªÊ∞¥„ÉªÈáë
            
            // Á≠ã„Éà„É¨Êó•„Åß„Å™„Åë„Çå„Å∞„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫
            const section = document.getElementById('strengthSection');
            if (!isStrengthDay) {
                section.style.display = 'none';
                return;
            }
            section.style.display = 'block';
            
            let completed = 0;
            container.innerHTML = '';
            
            for (const habit of STRENGTH_HABITS) {
                const key = `${dateKey}-strength-${habit.id}`;
                const data = await dbGet('habits', key);
                const isCompleted = data?.completed || false;
                if (isCompleted) completed++;
                
                const item = document.createElement('div');
                item.className = `habit-item ${isCompleted ? 'completed' : ''}`;
                item.onclick = () => toggleStrengthHabit(habit.id);
                item.innerHTML = `
                    <div class="habit-checkbox"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div>
                    <div class="habit-info">
                        <div class="habit-name">${habit.name}</div>
                        <div class="habit-time">Á¥Ñ${habit.duration}ÂàÜ</div>
                    </div>`;
                container.appendChild(item);
            }
            document.getElementById('strengthProgress').textContent = `${completed}/${STRENGTH_HABITS.length}`;
        }
        
        async function toggleStrengthHabit(habitId) {
            const key = `${getDateKey()}-strength-${habitId}`;
            const data = await dbGet('habits', key);
            const newValue = !(data?.completed || false);
            await dbPut('habits', { id: key, completed: newValue });
            renderStrengthHabits();
            renderStats();
            showToast(newValue ? 'ÂÆå‰∫ÜÔºÅ' : 'Âèñ„ÇäÊ∂à„Åó„Åæ„Åó„Åü');
        }

        async function renderHealthGrid() {
            const container = document.getElementById('healthGrid');
            const dateKey = getDateKey();
            container.innerHTML = '';
            for (const item of HEALTH_ITEMS) {
                const data = await dbGet('health', `${dateKey}-${item.id}`);
                let value = data?.value;
                
                // ‰ΩìÈáç„ÅØÂâçÊó•„Åã„ÇâÂºï„ÅçÁ∂ô„ÅêÔºà‰ªäÊó•„ÅÆÂÄ§„Åå„Å™„ÅÑÂ†¥ÂêàÔºâ
                if (!value && item.id === 'weight') {
                    value = await getPreviousWeight();
                }
                value = value || item.default;
                
                const div = document.createElement('div');
                div.className = 'health-item';
                div.innerHTML = `<div class="health-icon">${item.icon}</div><div class="health-label">${item.label}</div><div class="health-value"><input type="number" step="0.1" value="${value}" onchange="updateHealth('${item.id}', this.value)" onclick="this.select()"><span class="health-unit">${item.unit}</span></div>`;
                container.appendChild(div);
            }
        }

        async function renderDailyNote() {
            const data = await dbGet('notes', getDateKey());
            document.getElementById('dailyNote').value = data?.text || '';
        }

        async function renderUploadedImages() {
            const container = document.getElementById('uploadedImages');
            const data = await dbGet('images', getDateKey());
            const images = data?.images || [];
            container.innerHTML = images.map((img, i) => `<div class="uploaded-image"><img src="${img}" alt=""><button class="remove-btn" onclick="removeImage(${i})"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div>`).join('');
        }

        // ============================================
        // NEWS FUNCTIONS
        // ============================================
        async function loadKeywords() {
            const data = await dbGet('keywords', 'userKeywords');
            if (data?.keywords?.length) newsKeywords = data.keywords;
            else newsKeywords = [...DEFAULT_KEYWORDS];
        }

        async function saveKeywords() {
            await dbPut('keywords', { id: 'userKeywords', keywords: newsKeywords });
        }

        function renderKeywordTags() {
            const container = document.getElementById('keywordTags');
            container.innerHTML = newsKeywords.map((kw, i) => `<div class="keyword-tag"><span>${kw}</span><span class="remove" onclick="event.stopPropagation(); removeKeyword(${i})">√ó</span></div>`).join('') + '<button class="add-keyword-btn" onclick="openAddKeywordModal()">+ ËøΩÂä†</button>';
        }

        function renderNews() {
            const container = document.getElementById('newsContainer');
            container.innerHTML = newsKeywords.map(kw => {
                const searchUrl = `https://news.google.com/search?q=${encodeURIComponent(kw)}&hl=ja&gl=JP&ceid=JP:ja`;
                return `
                    <div class="news-card">
                        <div class="news-card-header">
                            <span class="news-keyword">${kw}</span>
                            <a href="${searchUrl}" target="_blank" class="news-link-btn">Google News„ÅßÈñã„Åè ‚Üí</a>
                        </div>
                        <div class="news-list">
                            <div class="news-item" onclick="window.open('${searchUrl}', '_blank')">
                                <div class="news-item-title">„Äå${kw}„Äç„ÅÆÊúÄÊñ∞„Éã„É•„Éº„Çπ„ÇíË¶ã„Çã</div>
                                <div class="news-item-meta">
                                    <span class="news-item-source">Google News</span>
                                    <span class="news-item-date">„Çø„ÉÉ„Éó„Åó„Å¶Èñã„Åè</span>
                                </div>
                            </div>
                        </div>
                    </div>`;
            }).join('');
        }

        function openAddKeywordModal() { document.getElementById('addKeywordModal').classList.add('active'); document.getElementById('keywordInput').value = ''; }
        function closeAddKeywordModal() { document.getElementById('addKeywordModal').classList.remove('active'); }

        async function addKeyword() {
            const input = document.getElementById('keywordInput').value.trim();
            if (!input) return;
            if (!newsKeywords.includes(input)) {
                newsKeywords.push(input);
                await saveKeywords();
                renderKeywordTags();
                renderNews();
            }
            closeAddKeywordModal();
            showToast('„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü');
        }

        async function removeKeyword(index) {
            newsKeywords.splice(index, 1);
            await saveKeywords();
            renderKeywordTags();
            renderNews();
            showToast('„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
        }

        // ============================================
        // WEEK VIEW
        // ============================================
        async function renderWeekCalendar() {
            const container = document.getElementById('weekCalendar');
            container.innerHTML = '';
            const startOfWeek = new Date(currentDate);
            startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + i);
                const dateKey = formatDate(date);
                const isActive = dateKey === formatDate(currentDate);
                let completed = 0;
                const total = MORNING_HABITS.length + DAYTIME_HABITS.length + EVENING_HABITS.length + NIGHT_HABITS.length;
                for (const h of MORNING_HABITS) { if ((await dbGet('habits', `${dateKey}-morning-${h.id}`))?.completed) completed++; }
                for (const h of DAYTIME_HABITS) { if ((await dbGet('habits', `${dateKey}-daytime-${h.id}`))?.completed) completed++; }
                for (const h of EVENING_HABITS) { if ((await dbGet('habits', `${dateKey}-evening-${h.id}`))?.completed) completed++; }
                for (const h of NIGHT_HABITS) { if ((await dbGet('habits', `${dateKey}-night-${h.id}`))?.completed) completed++; }
                const div = document.createElement('div');
                div.className = `week-day ${isActive ? 'active' : ''}`;
                div.onclick = () => { currentDate = new Date(date); renderAll(); };
                div.innerHTML = `<div class="week-day-name">${getWeekday(date)}</div><div class="week-day-num">${date.getDate()}</div><div class="week-day-progress"><div class="week-day-progress-bar" style="width: ${total > 0 ? (completed / total) * 100 : 0}%"></div></div>`;
                container.appendChild(div);
            }
        }

        function renderWeeklyActivities() {
            const container = document.getElementById('weeklyActivities');
            const today = getWeekday(currentDate);
            const isWeekend = today === 'Âúü' || today === 'Êó•';
            container.innerHTML = WEEKLY_ACTIVITIES.map(a => {
                let isToday = a.day.includes(today);
                if (a.id === 'film' && isWeekend) isToday = true;
                if (a.id === 'art' && isWeekend) isToday = true;
                return `<div class="activity-item"><div class="activity-info"><span class="activity-icon">${a.icon}</span><div><div class="activity-name">${a.name}</div><div class="activity-day">${a.day}</div></div></div><span class="activity-status ${isToday ? 'scheduled' : ''}">${isToday ? '‰ªäÊó•' : '‰∫àÂÆö'}</span></div>`;
            }).join('');
        }

        async function renderBookList() {
            const container = document.getElementById('bookList');
            const month = currentDate.getMonth() + 1;
            const books = MONTHLY_BOOKS[month] || [];
            container.innerHTML = '';
            let completed = 0;
            for (const book of books) {
                const key = `book-${month}-${book.title}`;
                const data = await dbGet('books', key);
                const isCompleted = data?.completed || false;
                if (isCompleted) completed++;
                const div = document.createElement('div');
                div.className = `book-item ${isCompleted ? 'completed' : ''}`;
                div.onclick = () => toggleBook(month, book.title);
                div.innerHTML = `<div class="book-checkbox"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div><div class="book-info"><div class="book-title">${book.title}</div><div class="book-author">${book.author}</div></div>`;
                container.appendChild(div);
            }
            const customBooks = (await dbGetAll('customBooks')).filter(b => b.month === month);
            for (const book of customBooks) {
                if (book.completed) completed++;
                const div = document.createElement('div');
                div.className = `book-item ${book.completed ? 'completed' : ''}`;
                div.onclick = () => toggleCustomBook(book.id);
                div.innerHTML = `<div class="book-checkbox"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div><div class="book-info"><div class="book-title">${book.title}</div><div class="book-author">${book.author}</div></div>`;
                container.appendChild(div);
            }
            document.getElementById('bookProgress').textContent = `${completed}/${books.length + customBooks.length}`;
        }

        // ============================================
        // GOALS
        // ============================================
        async function renderYearGoals() {
            const container = document.getElementById('yearGoals');
            container.innerHTML = '';
            for (let i = 0; i < YEAR_GOALS.length; i++) {
                const goal = YEAR_GOALS[i];
                const data = await dbGet('goals', `year-goal-${i}`);
                const isCompleted = data?.completed || false;
                const div = document.createElement('div');
                div.className = `goal-card ${isCompleted ? 'completed' : ''}`;
                div.onclick = () => toggleYearGoal(i);
                div.innerHTML = `<div class="goal-header"><div class="goal-checkbox"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div><div class="goal-content"><div class="goal-title">${goal.text}</div><div class="goal-deadline">${goal.deadline}</div></div></div>`;
                container.appendChild(div);
            }
        }

        function renderMonthTabs() {
            const container = document.getElementById('monthTabs');
            container.innerHTML = '';
            for (let m = 1; m <= 12; m++) {
                const tab = document.createElement('button');
                tab.className = `month-tab ${m === selectedGoalMonth ? 'active' : ''}`;
                tab.textContent = `${m}Êúà`;
                tab.onclick = () => { selectedGoalMonth = m; renderMonthTabs(); renderMonthGoals(); };
                container.appendChild(tab);
            }
        }

        async function renderMonthGoals() {
            const container = document.getElementById('monthGoals');
            const data = MONTHS[selectedGoalMonth];
            document.getElementById('monthGoalsTitle').textContent = `${selectedGoalMonth}Êúà„ÅÆÁõÆÊ®ô`;
            container.innerHTML = '';
            for (let i = 0; i < data.goals.length; i++) {
                const goalData = await dbGet('goals', `month-${selectedGoalMonth}-goal-${i}`);
                const isCompleted = goalData?.completed || false;
                const div = document.createElement('div');
                div.className = `goal-card ${isCompleted ? 'completed' : ''}`;
                div.onclick = () => toggleMonthGoal(selectedGoalMonth, i);
                div.innerHTML = `<div class="goal-header"><div class="goal-checkbox"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div><div class="goal-content"><div class="goal-title">${data.goals[i]}</div></div></div>`;
                container.appendChild(div);
            }
        }

        // ============================================
        // FIVE YEAR PLAN
        // ============================================
        function renderPlanTabs() {
            const container = document.getElementById('planTabs');
            container.innerHTML = [2026, 2027, 2028, 2029, 2030].map(year => 
                `<button class="plan-tab ${year === selectedPlanYear ? 'active' : ''}" onclick="selectPlanYear(${year})">${year}</button>`
            ).join('');
        }

        function selectPlanYear(year) {
            selectedPlanYear = year;
            renderPlanTabs();
            renderFiveYearPlan();
        }

        function renderFiveYearPlan() {
            const container = document.getElementById('fiveYearPlan');
            const y = FIVE_YEAR_PLAN[selectedPlanYear];
            const isCurrent = selectedPlanYear === 2026;
            
            container.innerHTML = `
                <div class="plan-year-card ${isCurrent ? 'current' : ''}">
                    <div class="plan-year-header">
                        <div>
                            <div class="plan-year">${selectedPlanYear}</div>
                            <div class="plan-year-theme">${y.theme}</div>
                        </div>
                        <div class="plan-year-revenue">
                            <div class="plan-year-revenue-label">Âπ¥ÂèéÁõÆÊ®ô</div>
                            <div class="plan-year-revenue-value">¬•${y.revenue}</div>
                        </div>
                    </div>
                    <div class="plan-breakdown">
                        <div class="plan-breakdown-item"><div class="plan-breakdown-label">PxDT</div><div class="plan-breakdown-value">¬•${y.breakdown.pxdt}</div></div>
                        <div class="plan-breakdown-item"><div class="plan-breakdown-label">HB</div><div class="plan-breakdown-value">¬•${y.breakdown.hb}</div></div>
                        <div class="plan-breakdown-item"><div class="plan-breakdown-label">yohaku</div><div class="plan-breakdown-value">¬•${y.breakdown.yohaku}</div></div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: var(--accent-gold-dim); border-radius: var(--radius-md); margin-bottom: 16px;">
                        <div style="font-size: 11px; color: var(--text-muted);">yohakuÊúàÂïÜÂπ≥Âùá</div>
                        <div style="font-family: var(--font-display); font-size: 28px; color: var(--accent-gold);">¬•${y.yohakuMonthly}</div>
                    </div>
                </div>
                
                <div class="section-title" style="margin: 20px 0 12px;">ÂõõÂçäÊúü„Éû„Ç§„É´„Çπ„Éà„Éº„É≥</div>
                ${y.quarters.map(q => `
                    <div class="plan-quarter">
                        <div class="plan-quarter-header">
                            <span class="plan-quarter-name">${q.q}Ôºà${q.period}Ôºâ</span>
                            <span class="plan-quarter-revenue">¬•${q.revenue}</span>
                        </div>
                        <div class="plan-quarter-events">${q.events}</div>
                        <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">Á¥ØË®à: ¬•${q.cumulative}</div>
                    </div>
                `).join('')}
                
                <div class="section-title" style="margin: 20px 0 12px;">SMARTÁõÆÊ®ô</div>
                <div class="plan-year-card">
                    ${Object.entries(y.smartGoals).map(([category, goals]) => `
                        <div class="plan-section" style="margin-top: 0; padding-top: 0; border-top: none;">
                            <div class="plan-section-title">${{business: 'üíº ‰∫ãÊ•≠„Éª„Ç≠„É£„É™„Ç¢', skill: 'üìö „Çπ„Ç≠„É´„ÉªÂ≠¶Áøí', artist: 'üé® „Ç¢„Éº„ÉÜ„Ç£„Çπ„ÉàÊ¥ªÂãï', life: 'üå± ÁîüÊ¥ª'}[category]}</div>
                            <div class="plan-milestones">
                                ${goals.map(g => `<div class="plan-milestone"><div class="plan-milestone-dot"></div><div class="plan-milestone-text">${g}</div></div>`).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function renderStats() {
            // 7Ââ≤ÈÅîÊàê„Çí„Ç´„Ç¶„É≥„Éà
            let streak = 0;
            let checkDate = new Date();
            const allHabits = [...MORNING_HABITS, ...DAYTIME_HABITS, ...EVENING_HABITS, ...NIGHT_HABITS];
            const requiredCompletion = Math.floor(allHabits.length * 0.7);
            
            while (streak < 365) {
                const dateKey = formatDate(checkDate);
                let completedCount = 0;
                
                for (const h of MORNING_HABITS) {
                    if ((await dbGet('habits', `${dateKey}-morning-${h.id}`))?.completed) completedCount++;
                }
                for (const h of DAYTIME_HABITS) {
                    if ((await dbGet('habits', `${dateKey}-daytime-${h.id}`))?.completed) completedCount++;
                }
                for (const h of EVENING_HABITS) {
                    if ((await dbGet('habits', `${dateKey}-evening-${h.id}`))?.completed) completedCount++;
                }
                for (const h of NIGHT_HABITS) {
                    if ((await dbGet('habits', `${dateKey}-night-${h.id}`))?.completed) completedCount++;
                }
                
                if (completedCount >= requiredCompletion) { 
                    streak++; 
                    checkDate.setDate(checkDate.getDate() - 1); 
                } else break;
            }
            document.getElementById('totalStreak').textContent = streak;
            document.getElementById('totalHabits').textContent = (await dbGetAll('habits')).filter(h => h.completed).length;
            document.getElementById('totalGoals').textContent = (await dbGetAll('goals')).filter(g => g.completed).length;
            document.getElementById('totalBooks').textContent = (await dbGetAll('books')).filter(b => b.completed).length + (await dbGetAll('customBooks')).filter(b => b.completed).length;
        }

        // ============================================
        // EVENT HANDLERS
        // ============================================
        async function toggleHabit(period, habitId) {
            const key = `${getDateKey()}-${period}-${habitId}`;
            const data = await dbGet('habits', key);
            const newValue = !(data?.completed || false);
            await dbPut('habits', { id: key, completed: newValue });
            if (period === 'morning') renderMorningHabits(); else renderEveningHabits();
            renderStats();
            showToast(newValue ? 'ÂÆå‰∫ÜÔºÅ' : 'Âèñ„ÇäÊ∂à„Åó„Åæ„Åó„Åü');
        }

        async function updateHealth(id, value) {
            await dbPut('health', { id: `${getDateKey()}-${id}`, value });
            showToast();
        }

        async function toggleBook(month, title) {
            const key = `book-${month}-${title}`;
            const data = await dbGet('books', key);
            await dbPut('books', { id: key, completed: !(data?.completed || false) });
            renderBookList(); renderStats();
            showToast(!(data?.completed) ? 'Ë™≠‰∫ÜÔºÅ' : 'Âèñ„ÇäÊ∂à„Åó„Åæ„Åó„Åü');
        }

        async function toggleCustomBook(id) {
            const book = await dbGet('customBooks', id);
            if (book) { book.completed = !book.completed; await dbPut('customBooks', book); renderBookList(); renderStats(); showToast(book.completed ? 'Ë™≠‰∫ÜÔºÅ' : 'Âèñ„ÇäÊ∂à„Åó„Åæ„Åó„Åü'); }
        }

        async function toggleYearGoal(index) {
            const key = `year-goal-${index}`;
            const data = await dbGet('goals', key);
            await dbPut('goals', { id: key, completed: !(data?.completed || false) });
            renderYearGoals(); renderStats();
            showToast(!(data?.completed) ? 'ÈÅîÊàêÔºÅ' : 'Âèñ„ÇäÊ∂à„Åó„Åæ„Åó„Åü');
        }

        async function toggleMonthGoal(month, index) {
            const key = `month-${month}-goal-${index}`;
            const data = await dbGet('goals', key);
            await dbPut('goals', { id: key, completed: !(data?.completed || false) });
            renderMonthGoals(); renderStats();
            showToast(!(data?.completed) ? 'ÈÅîÊàêÔºÅ' : 'Âèñ„ÇäÊ∂à„Åó„Åæ„Åó„Åü');
        }

        // Calendar
        function openCalendar() { calendarViewDate = new Date(currentDate); renderCalendar(); document.getElementById('calendarModal').classList.add('active'); }
        function closeCalendar() { document.getElementById('calendarModal').classList.remove('active'); }
        function prevMonth() { calendarViewDate.setMonth(calendarViewDate.getMonth() - 1); renderCalendar(); }
        function nextMonth() { calendarViewDate.setMonth(calendarViewDate.getMonth() + 1); renderCalendar(); }
        function renderCalendar() {
            document.getElementById('calendarMonth').textContent = `${calendarViewDate.getFullYear()}Âπ¥ ${calendarViewDate.getMonth() + 1}Êúà`;
            const container = document.getElementById('calendarDays');
            const firstDay = new Date(calendarViewDate.getFullYear(), calendarViewDate.getMonth(), 1);
            const lastDay = new Date(calendarViewDate.getFullYear(), calendarViewDate.getMonth() + 1, 0);
            const startDay = firstDay.getDay();
            const totalDays = lastDay.getDate();
            const today = new Date();
            const prevMonthLastDay = new Date(calendarViewDate.getFullYear(), calendarViewDate.getMonth(), 0).getDate();
            let html = '';
            for (let i = startDay - 1; i >= 0; i--) html += `<button class="calendar-day other-month">${prevMonthLastDay - i}</button>`;
            for (let i = 1; i <= totalDays; i++) {
                const dayDate = new Date(calendarViewDate.getFullYear(), calendarViewDate.getMonth(), i);
                const isToday = formatDate(dayDate) === formatDate(today);
                const isSelected = formatDate(dayDate) === formatDate(currentDate);
                html += `<button class="calendar-day ${isToday ? 'today' : ''} ${isSelected ? 'selected' : ''}" onclick="selectDate(${i})">${i}</button>`;
            }
            const remaining = 42 - (startDay + totalDays);
            for (let i = 1; i <= remaining; i++) html += `<button class="calendar-day other-month">${i}</button>`;
            container.innerHTML = html;
        }
        function selectDate(day) { currentDate = new Date(calendarViewDate.getFullYear(), calendarViewDate.getMonth(), day); closeCalendar(); renderAll(); }

        // Settings
        async function openSettings() {
            document.getElementById('morningStart').value = settings.morningStart;
            document.getElementById('eveningStart').value = settings.eveningStart;
            document.getElementById('appVersion').textContent = APP_VERSION;
            document.getElementById('appLastUpdate').textContent = APP_LAST_UPDATE;
            await loadApiKey();
            document.getElementById('settingsModal').classList.add('active');
        }
        function closeSettings() { document.getElementById('settingsModal').classList.remove('active'); }
        async function saveSettings() {
            settings.morningStart = document.getElementById('morningStart').value;
            settings.eveningStart = document.getElementById('eveningStart').value;
            await dbPut('settings', { id: 'routineTimes', ...settings });
            updateTimeRangeDisplay();
            updateDateTime();
            await renderMorningHabits();
            await renderEveningHabits();
            closeSettings();
            showToast('Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
        }
        async function loadSettings() {
            const data = await dbGet('settings', 'routineTimes');
            if (data) {
                settings.morningStart = data.morningStart || '07:00';
                settings.eveningStart = data.eveningStart || '20:00';
            }
            updateTimeRangeDisplay();
        }
        
        // API„Ç≠„ÉºÁÆ°ÁêÜ
        async function saveApiKey() {
            const apiKey = document.getElementById('openaiApiKey').value.trim();
            if (!apiKey) {
                showToast('API„Ç≠„Éº„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            await dbPut('settings', { id: 'openaiApiKey', key: apiKey });
            showToast('API„Ç≠„Éº„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
        }
        
        async function loadApiKey() {
            const data = await dbGet('settings', 'openaiApiKey');
            if (data?.key) {
                document.getElementById('openaiApiKey').value = data.key;
            }
        }
        
        // ‰ΩôÁôΩÊó•Â†±ÁîüÊàê
        async function generateDailyPaper() {
            const btn = document.getElementById('generatePaperBtn');
            const statusEl = document.getElementById('paperStatus');
            
            console.log('Êó•Â†±ÁîüÊàêÈñãÂßã...');
            
            // API„Ç≠„Éº„ÇíÂèñÂæó
            const apiKeyData = await dbGet('settings', 'openaiApiKey');
            console.log('API„Ç≠„ÉºÂèñÂæó:', apiKeyData ? 'ÊàêÂäü' : 'Â§±Êïó');
            
            if (!apiKeyData?.key) {
                showToast('Ë®≠ÂÆö„Åã„ÇâAPI„Ç≠„Éº„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                statusEl.textContent = 'API„Ç≠„Éº„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì';
                return;
            }
            
            // ‰ªäÊó•„ÅÆ„Ç≠„É£„ÉÉ„Ç∑„É•„ÇíÁ¢∫Ë™ç
            const today = formatDate(new Date());
            const cachedPaper = await dbGet('notes', `paper-${today}`);
            if (cachedPaper?.content) {
                console.log('„Ç≠„É£„ÉÉ„Ç∑„É•„Åã„ÇâË°®Á§∫');
                showDailyPaper(cachedPaper.content, today);
                return;
            }
            
            // ÁîüÊàêÈñãÂßã
            btn.disabled = true;
            btn.classList.add('loading');
            btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>ÁîüÊàê‰∏≠...';
            statusEl.textContent = '„Éã„É•„Éº„Çπ„ÇíÂèéÈõÜ„Åó„Å¶„ÅÑ„Åæ„Åô...';
            
            try {
                // „Ç≠„Éº„ÉØ„Éº„Éâ„Åß„Éã„É•„Éº„Çπ„ÇíÊ§úÁ¥¢
                console.log('„Éã„É•„Éº„ÇπÂèñÂæóÈñãÂßã... „Ç≠„Éº„ÉØ„Éº„Éâ:', newsKeywords.slice(0, 5));
                const newsItems = await fetchNewsForKeywords(newsKeywords.slice(0, 5));
                console.log('ÂèñÂæó„Åó„Åü„Éã„É•„Éº„ÇπÊï∞:', newsItems.length);
                
                if (newsItems.length === 0) {
                    // „Éã„É•„Éº„Çπ„ÅåÂèñÂæó„Åß„Åç„Å™„ÅÑÂ†¥Âêà„ÄÅ„Ç≠„Éº„ÉØ„Éº„Éâ„ÅÆ„Åø„ÅßAIÁîüÊàê
                    console.log('„Éã„É•„Éº„Çπ„Å™„Åó„ÄÅ„Ç≠„Éº„ÉØ„Éº„Éâ„ÅÆ„Åø„ÅßÁîüÊàê');
                    statusEl.textContent = '„Ç≠„Éº„ÉØ„Éº„Éâ„Åã„ÇâÊó•Â†±„ÇíÁîüÊàê„Åó„Å¶„ÅÑ„Åæ„Åô...';
                    const paperContent = await generatePaperWithoutNews(apiKeyData.key, newsKeywords);
                    await dbPut('notes', { id: `paper-${today}`, content: paperContent, date: today });
                    showDailyPaper(paperContent, today);
                    statusEl.textContent = '‰ªäÊó•„ÅÆÊó•Â†±„ÅåÁîüÊàê„Åï„Çå„Åæ„Åó„Åü';
                    return;
                }
                
                statusEl.textContent = 'AI„ÅåË¶ÅÁ¥Ñ„ÇíÁîüÊàê„Åó„Å¶„ÅÑ„Åæ„Åô...';
                
                // GPT„ÅßË¶ÅÁ¥Ñ„ÇíÁîüÊàê
                console.log('GPTÂëº„Å≥Âá∫„ÅóÈñãÂßã...');
                const paperContent = await generatePaperWithGPT(apiKeyData.key, newsItems, newsKeywords);
                console.log('GPTÂëº„Å≥Âá∫„ÅóÊàêÂäü');
                
                // „Ç≠„É£„ÉÉ„Ç∑„É•„Å´‰øùÂ≠ò
                await dbPut('notes', { id: `paper-${today}`, content: paperContent, date: today });
                
                // Ë°®Á§∫
                showDailyPaper(paperContent, today);
                statusEl.textContent = '‰ªäÊó•„ÅÆÊó•Â†±„ÅåÁîüÊàê„Åï„Çå„Åæ„Åó„Åü';
                
            } catch (error) {
                console.error('Paper generation error:', error);
                showToast('„Ç®„É©„Éº: ' + error.message);
                statusEl.textContent = '„Ç®„É©„Éº: ' + error.message;
            } finally {
                btn.disabled = false;
                btn.classList.remove('loading');
                btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>Êó•Â†±„ÇíÁîüÊàê';
            }
        }
        
        // „Éã„É•„Éº„ÇπÂèñÂæóÔºàË§áÊï∞„ÇΩ„Éº„ÇπÂØæÂøúÔºâ
        async function fetchNewsForKeywords(keywords) {
            const allNews = [];
            
            // ÂêÑ„Ç≠„Éº„ÉØ„Éº„Éâ„ÅßÂèñÂæóÔºàÊúÄÂ§ß5‰ª∂„Åö„Å§Ôºâ
            for (const keyword of keywords) {
                try {
                    console.log(`„Éã„É•„Éº„ÇπÂèñÂæó‰∏≠: ${keyword}`);
                    
                    // RSS2JSONÁµåÁî±„ÅßGoogle NewsÂèñÂæó
                    const rssUrl = `https://news.google.com/rss/search?q=${encodeURIComponent(keyword)}&hl=ja&gl=JP&ceid=JP:ja`;
                    const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}&count=5`;
                    
                    const response = await fetch(apiUrl);
                    const data = await response.json();
                    console.log(`${keyword}:`, data.status, data.items?.length || 0, '‰ª∂');
                    
                    if (data.status === 'ok' && data.items) {
                        data.items.forEach(item => {
                            // HTML„Çø„Ç∞„ÇíÈô§Âéª„Åó„Å¶„ÇØ„É™„Éº„É≥„Å™„ÉÜ„Ç≠„Çπ„Éà„Å´
                            const cleanDesc = item.description
                                ?.replace(/<[^>]*>/g, '')
                                .replace(/&nbsp;/g, ' ')
                                .replace(/&amp;/g, '&')
                                .replace(/&lt;/g, '<')
                                .replace(/&gt;/g, '>')
                                .trim()
                                .slice(0, 300) || '';
                            
                            allNews.push({
                                keyword,
                                title: item.title,
                                description: cleanDesc,
                                source: item.author || extractSource(item.title),
                                date: item.pubDate,
                                link: item.link
                            });
                        });
                    }
                    
                    // API„É¨„Éº„ÉàÂà∂ÈôêÂØæÁ≠ñ„ÅßÂ∞ë„ÅóÂæÖ„Å§
                    await new Promise(r => setTimeout(r, 200));
                    
                } catch (e) {
                    console.warn(`${keyword} ÂèñÂæóÂ§±Êïó:`, e);
                }
            }
            
            console.log('ÂêàË®à„Éã„É•„Éº„ÇπÊï∞:', allNews.length);
            console.log('ÂèñÂæó„Åó„Åü„Éã„É•„Éº„Çπ:', allNews.map(n => n.title).slice(0, 5));
            return allNews;
        }
        
        // „Éã„É•„Éº„Çπ„ÇΩ„Éº„Çπ„ÇíÊäΩÂá∫
        function extractSource(title) {
            const match = title.match(/ - ([^-]+)$/);
            return match ? match[1] : '„Éã„É•„Éº„Çπ';
        }
        
        // „Éã„É•„Éº„Çπ„Å™„Åó„ÅßGPTÁîüÊàêÔºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ
        async function generatePaperWithoutNews(apiKey, keywords) {
            const prompt = `„ÅÇ„Å™„Åü„ÅØ„Äå‰ΩôÁôΩÊó•Â†±„Äç„Å®„ÅÑ„ÅÜÂÄã‰∫∫Âêë„ÅëÊñ∞ËÅû„ÅÆÁ∑®ÈõÜËÄÖ„Åß„Åô„ÄÇ
‰ª•‰∏ã„ÅÆ„Ç≠„Éº„ÉØ„Éº„Éâ„Å´Èñ¢„Åô„ÇãÊúÄÊñ∞„ÅÆÂãïÂêë„ÇÑËÄÉÂØü„Çí„ÄÅÊó•Â†±ÂΩ¢Âºè„Åß‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

## Ë™≠ËÄÖ„ÅÆÈñ¢ÂøÉ„Ç≠„Éº„ÉØ„Éº„Éâ
${keywords.join('„ÄÅ')}

## Ë™≠ËÄÖ„Éó„É≠„Éï„Ç£„Éº„É´
30‰ª£Áî∑ÊÄß„ÄÅ„ÉÜ„ÇØ„Éé„É≠„Ç∏„Éº„Å®„Ç±„Ç¢„Éª„Ç¢„Éº„Éà„Å´Èñ¢ÂøÉ„Åå„ÅÇ„ÇãËµ∑Ê•≠ÂÆ∂

## Âá∫ÂäõÂΩ¢ÂºèÔºàJSONÔºâ
{
  "headline": "‰ªäÊó•„ÅÆ‰∏ÄË®ÄÔºà20ÊñáÂ≠ó‰ª•ÂÜÖÔºâ",
  "summary": "‰ªäÊó•„ÅÆ„ÉÜ„Éº„Éû„ÅÆÊ¶ÇË¶ÅÔºà100ÊñáÂ≠óÁ®ãÂ∫¶Ôºâ",
  "sections": [
    {
      "title": "„Çª„ÇØ„Ç∑„Éß„É≥„Çø„Ç§„Éà„É´",
      "emoji": "ÁµµÊñáÂ≠ó1„Å§",
      "content": "„Åù„ÅÆ„Éà„Éî„ÉÉ„ÇØ„ÅÆËÄÉÂØüÔºà150-200ÊñáÂ≠óÔºâ",
      "insight": "Ë™≠ËÄÖ„Å∏„ÅÆÁ§∫ÂîÜÔºà50ÊñáÂ≠óÁ®ãÂ∫¶Ôºâ"
    }
  ],
  "closing": "Á∑†„ÇÅ„ÅÆË®ÄËëâÔºà30ÊñáÂ≠óÁ®ãÂ∫¶Ôºâ"
}

ÈáçË¶ÅÔºöÂøÖ„ÅöÊúâÂäπ„Å™JSON„ÅÆ„Åø„ÇíÂá∫Âäõ„ÄÇ„Çª„ÇØ„Ç∑„Éß„É≥„ÅØ3ÂÄã„ÄÇ`;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    messages: [{ role: 'user', content: prompt }],
                    temperature: 0.7,
                    max_tokens: 1500
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                console.error('OpenAI API Error:', error);
                throw new Error(error.error?.message || 'APIÂëº„Å≥Âá∫„Åó„Å´Â§±Êïó');
            }
            
            const data = await response.json();
            const content = data.choices[0].message.content;
            console.log('GPT Response:', content);
            
            const jsonMatch = content.match(/\{[\s\S]*\}/);
            if (!jsonMatch) {
                throw new Error('JSON„Éë„Éº„Çπ„Ç®„É©„Éº');
            }
            
            return JSON.parse(jsonMatch[0]);
        }
        
        // GPT„ÅßÊó•Â†±ÁîüÊàêÔºàÂÖÖÂÆüÁâàÔºâ
        async function generatePaperWithGPT(apiKey, newsItems, keywords) {
            // „Éã„É•„Éº„Çπ„Çí„Ç≠„Éº„ÉØ„Éº„ÉâÂà•„Å´„Ç∞„É´„Éº„ÉóÂåñ
            const newsByKeyword = {};
            newsItems.forEach(n => {
                if (!newsByKeyword[n.keyword]) newsByKeyword[n.keyword] = [];
                newsByKeyword[n.keyword].push(n);
            });
            
            // „Éï„Ç©„Éº„Éû„ÉÉ„Éà
            let newsText = '';
            for (const [kw, items] of Object.entries(newsByKeyword)) {
                newsText += `\n### ${kw}\n`;
                items.slice(0, 3).forEach((n, i) => {
                    newsText += `${i + 1}. ${n.title}\n   ${n.description}\n   Âá∫ÂÖ∏: ${n.source}\n\n`;
                });
            }
            
            const today = new Date();
            const dateStr = `${today.getFullYear()}Âπ¥${today.getMonth() + 1}Êúà${today.getDate()}Êó•`;
            
            const prompt = `„ÅÇ„Å™„Åü„ÅØ„Äå‰ΩôÁôΩÊó•Â†±„Äç„Å®„ÅÑ„ÅÜÈ´òÂìÅË≥™„Å™ÂÄã‰∫∫Âêë„Åë„Éá„Ç∏„Çø„É´Êñ∞ËÅû„ÅÆÁ∑®ÈõÜÈï∑„Åß„Åô„ÄÇ
‰ªäÊó•Ôºà${dateStr}Ôºâ„ÅÆÊúÄÊñ∞„Éã„É•„Éº„Çπ„ÇíÂÖÉ„Å´„ÄÅË™≠ËÄÖÂ∞ÇÁî®„ÅÆÊó•Â†±„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

## Ë™≠ËÄÖ„Éó„É≠„Éï„Ç£„Éº„É´
- 30‰ª£Áî∑ÊÄß„ÄÅËµ∑Ê•≠ÂÆ∂
- Èñ¢ÂøÉÈ†òÂüü: „ÉÜ„ÇØ„Éé„É≠„Ç∏„Éº„ÄÅAI„ÄÅ„Ç±„Ç¢Ôºà‰ªãË≠∑„ÉªÁ¶èÁ•âÔºâ„ÄÅ„Ç¢„Éº„Éà„ÄÅÈõ£ËÅ¥ÊîØÊè¥
- ‰æ°ÂÄ§Ë¶≥: „Äå‰ΩôÁôΩ„Äç„ÇíÂ§ßÂàá„Å´„Åô„ÇãÔºàÂäπÁéá‰∏ÄËæ∫ÂÄí„Åß„ÅØ„Å™„ÅÑË±ä„Åã„ÅïÔºâ
- Ë™≠„ÇÄÊôÇÈñì: Êúù„ÅÆ„É´„Éº„ÉÜ„Ç£„É≥„Åß5-10ÂàÜ

## ‰ªäÊó•ÂèéÈõÜ„Åó„Åü„Éã„É•„Éº„Çπ
${newsText}

## Êó•Â†±‰ΩúÊàê„É´„Éº„É´
1. **„Éò„ÉÉ„Éâ„É©„Ç§„É≥**: „Åù„ÅÆÊó•„ÇíË±°Âæ¥„Åô„Çã‰∏ÄË®ÄÔºà„Ç≠„É£„ÉÉ„ÉÅ„Éº„ÅßË®òÊÜ∂„Å´ÊÆã„ÇãÔºâ
2. **„Ç®„Ç∞„Çº„ÇØ„ÉÜ„Ç£„Éñ„Çµ„Éû„É™„Éº**: ‰ªäÊó•Êäº„Åï„Åà„Çã„Åπ„Åç„Éù„Ç§„É≥„Éà„Çí3Êñá„Åß
3. **„Çª„ÇØ„Ç∑„Éß„É≥**: „Ç≠„Éº„ÉØ„Éº„Éâ„Åî„Å®„Å´Ê∑±Êéò„ÇäÔºàÊúÄ‰Ωé4„Çª„ÇØ„Ç∑„Éß„É≥Ôºâ
   - ÂêÑ„Çª„ÇØ„Ç∑„Éß„É≥300ÊñáÂ≠ó‰ª•‰∏ä„ÅÆÂÖÖÂÆü„Åó„ÅüÂÜÖÂÆπ
   - „Éã„É•„Éº„Çπ„ÅÆ‰∫ãÂÆü ‚Üí ËÉåÊôØ„ÉªÊñáËÑà ‚Üí Ë™≠ËÄÖ„Å∏„ÅÆÁ§∫ÂîÜ
4. **‰ªäÊó•„ÅÆÂïè„ÅÑ**: Ë™≠ËÄÖ„Åå1Êó•ËÄÉ„Åà„Çã„Åπ„ÅçÂïè„ÅÑ„Åã„Åë
5. **„ÇØ„É≠„Éº„Ç∏„É≥„Ç∞**: ‰ΩôÁôΩ„ÇíÂ§ßÂàá„Å´„Åô„ÇãÂì≤Â≠¶„Å´Âü∫„Å•„ÅèÁ∑†„ÇÅ

## Âá∫ÂäõÂΩ¢ÂºèÔºàJSONÔºâ
{
  "headline": "‰ªäÊó•„ÅÆ‰∏ÄË®ÄÔºàÂç∞Ë±°ÁöÑ„Å™„Éï„É¨„Éº„Ç∫„ÄÅ20ÊñáÂ≠ó‰ª•ÂÜÖÔºâ",
  "summary": "„Ç®„Ç∞„Çº„ÇØ„ÉÜ„Ç£„Éñ„Çµ„Éû„É™„ÉºÔºà150-200ÊñáÂ≠ó„ÄÅ3„Å§„ÅÆ„Éù„Ç§„É≥„Éà„ÇíÂê´„ÇÄÔºâ",
  "sections": [
    {
      "title": "„Çª„ÇØ„Ç∑„Éß„É≥„Çø„Ç§„Éà„É´",
      "emoji": "ÁµµÊñáÂ≠ó1„Å§",
      "news_summary": "Èñ¢ÈÄ£„Éã„É•„Éº„Çπ„ÅÆË¶ÅÁ¥ÑÔºà100ÊñáÂ≠óÔºâ",
      "analysis": "ËÉåÊôØ„Å®ÂàÜÊûêÔºà150ÊñáÂ≠óÔºâ",
      "insight": "Ë™≠ËÄÖ„Å∏„ÅÆÁ§∫ÂîÜÔºà100ÊñáÂ≠óÔºâ"
    }
  ],
  "question_of_day": "‰ªäÊó•„ÅÆÂïè„ÅÑÔºàË™≠ËÄÖ„ÅåËÄÉ„Åà„Çã„Åπ„ÅçÂïè„ÅÑ„Åã„ÅëÔºâ",
  "closing": "Á∑†„ÇÅ„ÅÆË®ÄËëâÔºà50ÊñáÂ≠óÁ®ãÂ∫¶Ôºâ",
  "news_count": ÂèñÂæó„Åó„Åü„Éã„É•„Éº„ÇπÁ∑èÊï∞
}

ÈáçË¶Å: ÂøÖ„ÅöÊúâÂäπ„Å™JSON„ÅÆ„Åø„ÇíÂá∫Âäõ„ÄÇ„Çª„ÇØ„Ç∑„Éß„É≥„ÅØ4-5ÂÄã„ÄÇÂêÑ„Çª„ÇØ„Ç∑„Éß„É≥„ÅØÂÖÖÂÆü„Åó„ÅüÂÜÖÂÆπ„Åß„ÄÇ`;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    messages: [{ role: 'user', content: prompt }],
                    temperature: 0.7,
                    max_tokens: 2000
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'APIÂëº„Å≥Âá∫„Åó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
            
            const data = await response.json();
            const content = data.choices[0].message.content;
            
            // JSON„Çí„Éë„Éº„Çπ
            const jsonMatch = content.match(/\{[\s\S]*\}/);
            if (!jsonMatch) {
                throw new Error('ÊúâÂäπ„Å™JSON„ÅåËøî„Åï„Çå„Åæ„Åõ„Çì„Åß„Åó„Åü');
            }
            
            return JSON.parse(jsonMatch[0]);
        }
        
        // Êó•Â†±„ÇíË°®Á§∫ÔºàÂÖÖÂÆüÁâàÂØæÂøúÔºâ
        function showDailyPaper(content, date) {
            const paper = document.getElementById('dailyPaper');
            const paperDate = document.getElementById('paperDate');
            const paperContent = document.getElementById('paperContent');
            
            const dateObj = new Date(date);
            const weekday = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'][dateObj.getDay()];
            paperDate.textContent = `${dateObj.getFullYear()}Âπ¥${dateObj.getMonth() + 1}Êúà${dateObj.getDate()}Êó•Ôºà${weekday}Ôºâ`;
            
            let html = `
                <div class="paper-section">
                    <div class="paper-headline" style="font-size: 22px; text-align: center; margin-bottom: 16px; color: #8b5a2b;">
                        „Äå${content.headline}„Äç
                    </div>
                    <div class="paper-summary" style="background: rgba(139,90,43,0.08); padding: 16px; border-radius: 8px; border-left: 4px solid #8b5a2b;">
                        <div style="font-size: 11px; color: #8b5a2b; margin-bottom: 8px; font-weight: 600;">üìã EXECUTIVE SUMMARY</div>
                        ${content.summary}
                    </div>
                    ${content.news_count ? `<div style="text-align: right; font-size: 11px; color: var(--text-muted); margin-top: 8px;">üì∞ ${content.news_count}‰ª∂„ÅÆ„Éã„É•„Éº„Çπ„ÇíÂàÜÊûê</div>` : ''}
                </div>
            `;
            
            content.sections?.forEach(section => {
                // Êñ∞„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÔºànews_summary, analysis, insightÔºâ„Å®Êóß„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÔºàcontentÔºâ„ÅÆ‰∏°Êñπ„Å´ÂØæÂøú
                const mainContent = section.analysis || section.content || '';
                const newsSum = section.news_summary || '';
                const insight = section.insight || '';
                
                html += `
                    <div class="paper-section">
                        <div class="paper-section-title">${section.emoji || 'üìå'} ${section.title}</div>
                        ${newsSum ? `<div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px; padding: 10px; background: var(--bg-secondary); border-radius: 6px;">üì∞ ${newsSum}</div>` : ''}
                        <div class="paper-section-content">${mainContent}</div>
                        ${insight ? `<div class="paper-summary" style="margin-top: 14px; font-style: italic; background: rgba(107,143,113,0.1); padding: 12px; border-radius: 6px; border-left: 3px solid var(--accent-sage);">üí° ${insight}</div>` : ''}
                    </div>
                `;
            });
            
            // ‰ªäÊó•„ÅÆÂïè„ÅÑ
            if (content.question_of_day) {
                html += `
                    <div class="paper-section" style="text-align: center; background: linear-gradient(135deg, rgba(139,90,43,0.1) 0%, rgba(107,143,113,0.1) 100%); padding: 24px; border-radius: 12px; margin: 20px 0;">
                        <div style="font-size: 12px; color: #8b5a2b; margin-bottom: 8px;">ü§î TODAY'S QUESTION</div>
                        <div style="font-family: var(--font-serif); font-size: 16px; color: var(--text-primary); line-height: 1.8;">
                            ${content.question_of_day}
                        </div>
                    </div>
                `;
            }
            
            html += `
                <div class="paper-section" style="text-align: center; border-bottom: none; padding-top: 20px;">
                    <div style="font-family: var(--font-serif); font-size: 14px; color: #8b5a2b; font-style: italic;">
                        ‚ú® ${content.closing}
                    </div>
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px dashed rgba(139,90,43,0.3); font-size: 11px; color: var(--text-muted);">
                        ‰ΩôÁôΩÊó•Â†± ‚Äî Ë≥™Èáè„Å®‰ΩôÁôΩ„ÅÆÈñì„Åß„ÄÅ‰ªäÊó•„ÇíÁü•„Çã
                    </div>
                </div>
            `;
            
            paperContent.innerHTML = html;
            paper.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        function closeDailyPaper() {
            document.getElementById('dailyPaper').style.display = 'none';
            document.body.style.overflow = '';
            renderPaperArchive(); // „Ç¢„Éº„Ç´„Ç§„Éñ„ÇíÊõ¥Êñ∞
        }
        
        // Êó•Â†±„Ç¢„Éº„Ç´„Ç§„ÉñË°®Á§∫
        async function renderPaperArchive() {
            const container = document.getElementById('paperArchiveList');
            const allNotes = await dbGetAll('notes');
            
            // paper-„ÅßÂßã„Åæ„Çã„ÇÇ„ÅÆ„Çí„Éï„Ç£„É´„Çø
            const papers = allNotes
                .filter(n => n.id.startsWith('paper-') && n.content)
                .sort((a, b) => b.date.localeCompare(a.date))
                .slice(0, 10); // ÊúÄÊñ∞10‰ª∂
            
            if (papers.length === 0) {
                container.innerHTML = '<div class="paper-archive-empty">„Åæ„Å†Êó•Â†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }
            
            const selectedDate = getDateKey();
            
            container.innerHTML = papers.map(p => {
                const dateObj = new Date(p.date);
                const weekday = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'][dateObj.getDay()];
                const headline = p.content.headline || 'Êó•Â†±';
                const isToday = p.date === formatDate(new Date());
                const isSelected = p.date === selectedDate;
                
                return `
                    <div class="paper-archive-item" style="${isSelected ? 'border-color: var(--accent-gold); background: var(--accent-gold-dim);' : ''}" onclick="showDailyPaper(${JSON.stringify(p.content).replace(/"/g, '&quot;')}, '${p.date}')">
                        <div>
                            <div class="paper-archive-date">${dateObj.getMonth() + 1}/${dateObj.getDate()}Ôºà${weekday}Ôºâ</div>
                            <div class="paper-archive-headline">${headline}</div>
                        </div>
                        ${isToday ? '<span class="paper-archive-badge">TODAY</span>' : isSelected ? '<span class="paper-archive-badge" style="background: var(--accent-gold);">ÈÅ∏Êäû‰∏≠</span>' : '<span style="color: var(--text-muted); font-size: 12px;">‚Üí</span>'}
                    </div>
                `;
            }).join('');
        }
        
        // ÈÅ∏Êäû„Åï„Çå„ÅüÊó•‰ªò„ÅÆÊó•Â†±Áä∂ÊÖã„ÇíÊõ¥Êñ∞
        async function updatePaperCardForDate() {
            const dateKey = getDateKey();
            const today = formatDate(new Date());
            const isToday = dateKey === today;
            
            const titleEl = document.getElementById('paperCardTitle');
            const statusEl = document.getElementById('paperStatus');
            const actionArea = document.getElementById('paperActionArea');
            
            const dateObj = new Date(currentDate);
            const weekday = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'][dateObj.getDay()];
            const dateStr = `${dateObj.getMonth() + 1}/${dateObj.getDate()}Ôºà${weekday}Ôºâ`;
            
            // „Åù„ÅÆÊó•„ÅÆÊó•Â†±„Åå„ÅÇ„Çã„ÅãÁ¢∫Ë™ç
            const cachedPaper = await dbGet('notes', `paper-${dateKey}`);
            
            if (cachedPaper?.content) {
                // Êó•Â†±„Åå„ÅÇ„ÇãÂ†¥Âêà
                titleEl.textContent = `${dateStr} „ÅÆ‰ΩôÁôΩÊó•Â†±`;
                statusEl.textContent = `„Äå${cachedPaper.content.headline || 'Êó•Â†±'}„Äç`;
                actionArea.innerHTML = `
                    <button class="paper-generate-btn" onclick="showDailyPaper(window._cachedPaperContent, '${dateKey}')" style="background: linear-gradient(135deg, var(--accent-sage) 0%, #4a7050 100%);">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                        Êó•Â†±„ÇíË™≠„ÇÄ
                    </button>
                    ${isToday ? `<button class="paper-generate-btn" onclick="regenerateDailyPaper()" style="margin-top: 8px; background: transparent; border: 1px solid var(--border-medium); color: var(--text-secondary);">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                        ÂÜçÁîüÊàê
                    </button>` : ''}
                `;
                // „Ç∞„É≠„Éº„Éê„É´„Å´„Ç≠„É£„ÉÉ„Ç∑„É•
                window._cachedPaperContent = cachedPaper.content;
            } else {
                // Êó•Â†±„Åå„Å™„ÅÑÂ†¥Âêà
                titleEl.textContent = isToday ? '‰ªäÊó•„ÅÆ‰ΩôÁôΩÊó•Â†±' : `${dateStr} „ÅÆ‰ΩôÁôΩÊó•Â†±`;
                
                if (isToday) {
                    statusEl.textContent = 'AI„Åå„Éã„É•„Éº„Çπ„ÇíË¶ÅÁ¥Ñ„Åó„Åæ„Åô';
                    actionArea.innerHTML = `
                        <button class="paper-generate-btn" id="generatePaperBtn" onclick="generateDailyPaper()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                            Êó•Â†±„ÇíÁîüÊàê
                        </button>
                    `;
                } else {
                    statusEl.textContent = '„Åì„ÅÆÊó•„ÅÆÊó•Â†±„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì';
                    actionArea.innerHTML = `
                        <div style="text-align: center; padding: 16px; color: var(--text-muted); font-size: 13px;">
                            üì≠ Êó•Â†±„ÅåÁîüÊàê„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì
                        </div>
                    `;
                }
            }
        }
        
        // Êó•Â†±„ÇíÂÜçÁîüÊàêÔºà‰ªäÊó•„ÅÆ„ÅøÔºâ
        async function regenerateDailyPaper() {
            // ‰ªäÊó•„ÅÆ„Ç≠„É£„ÉÉ„Ç∑„É•„ÇíÂâäÈô§
            const today = formatDate(new Date());
            await dbPut('notes', { id: `paper-${today}`, content: null, date: today });
            // ÂÜçÁîüÊàê
            generateDailyPaper();
        }
        
        // „Ç¢„Éó„É™„ÅÆÂº∑Âà∂Êõ¥Êñ∞
        async function forceUpdateApp() {
            showToast('Êõ¥Êñ∞„ÇíÁ¢∫Ë™ç‰∏≠...');
            
            try {
                // Service Worker„ÅÆ„Ç≠„É£„ÉÉ„Ç∑„É•„Çí„ÇØ„É™„Ç¢
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    await Promise.all(cacheNames.map(name => caches.delete(name)));
                }
                
                // Service Worker„ÇíÊõ¥Êñ∞
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (const registration of registrations) {
                        await registration.update();
                    }
                }
                
                // „Éè„Éº„Éâ„É™„É≠„Éº„ÉâÔºà„Ç≠„É£„ÉÉ„Ç∑„É•„ÇíÁÑ°Ë¶ñÔºâ
                showToast('Êõ¥Êñ∞„Åó„Å¶„ÅÑ„Åæ„Åô...');
                setTimeout(() => {
                    // URL„Å´„Çø„Ç§„É†„Çπ„Çø„É≥„Éó„ÇíËøΩÂä†„Åó„Å¶„Ç≠„É£„ÉÉ„Ç∑„É•„ÇíÂõûÈÅø
                    const url = new URL(window.location.href);
                    url.searchParams.set('_refresh', Date.now());
                    window.location.href = url.toString();
                }, 500);
                
            } catch (error) {
                console.error('Update error:', error);
                // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: ÈÄöÂ∏∏„ÅÆ„É™„É≠„Éº„Éâ
                window.location.reload(true);
            }
        }

        // Add Book
        function openAddBookModal() { document.getElementById('addBookModal').classList.add('active'); document.getElementById('bookTitleInput').value = ''; document.getElementById('bookAuthorInput').value = ''; }
        function closeAddBookModal() { document.getElementById('addBookModal').classList.remove('active'); }
        async function addCustomBook() {
            const title = document.getElementById('bookTitleInput').value.trim();
            const author = document.getElementById('bookAuthorInput').value.trim();
            if (!title) { showToast('„Çø„Ç§„Éà„É´„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; }
            await dbPut('customBooks', { title, author, month: currentDate.getMonth() + 1, completed: false, createdAt: new Date().toISOString() });
            closeAddBookModal(); renderBookList(); showToast('Êú¨„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü');
        }

        // Image Upload
        document.getElementById('imageUploadArea').addEventListener('click', () => document.getElementById('imageInput').click());
        document.getElementById('imageInput').addEventListener('change', async (e) => {
            const files = Array.from(e.target.files);
            const dateKey = getDateKey();
            const data = await dbGet('images', dateKey) || { id: dateKey, images: [] };
            for (const file of files) {
                const reader = new FileReader();
                reader.onload = async (ev) => { data.images.push(ev.target.result); await dbPut('images', data); renderUploadedImages(); showToast('ÁîªÂÉè„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü'); };
                reader.readAsDataURL(file);
            }
            e.target.value = '';
        });
        async function removeImage(index) {
            const data = await dbGet('images', getDateKey());
            if (data?.images) { data.images.splice(index, 1); await dbPut('images', data); renderUploadedImages(); showToast('ÁîªÂÉè„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü'); }
        }

        // Note
        let noteTimeout;
        document.getElementById('dailyNote').addEventListener('input', (e) => {
            clearTimeout(noteTimeout);
            noteTimeout = setTimeout(async () => { await dbPut('notes', { id: getDateKey(), text: e.target.value }); showToast(); }, 500);
        });

        // Navigation
        document.querySelectorAll('.nav-item').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.view).classList.add('active');
                if (btn.dataset.view === 'newsView') { renderKeywordTags(); renderNews(); renderPaperArchive(); updatePaperCardForDate(); }
                if (btn.dataset.view === 'planView') { renderPlanTabs(); renderFiveYearPlan(); }
            });
        });
        document.getElementById('prevDay').addEventListener('click', () => { currentDate.setDate(currentDate.getDate() - 1); renderAll(); });
        document.getElementById('nextDay').addEventListener('click', () => { currentDate.setDate(currentDate.getDate() + 1); renderAll(); });

        // ============================================
        // INIT
        // ============================================
        async function renderAll() {
            updateDateDisplay();
            updateQuote();
            updateMonthCard();
            await renderMorningHabits();
            await renderDaytimeHabits();
            await renderEveningHabits();
            await renderNightHabits();
            await renderStrengthHabits();
            await renderHealthGrid();
            await renderDailyNote();
            await renderUploadedImages();
            await renderWeekCalendar();
            renderWeeklyActivities();
            await renderBookList();
            await renderYearGoals();
            renderMonthTabs();
            await renderMonthGoals();
            renderPlanTabs();
            renderFiveYearPlan();
            await renderStats();
            await updatePaperCardForDate(); // Êó•Â†±„Ç´„Éº„ÉâÊõ¥Êñ∞
            await renderPaperArchive(); // Êó•Â†±„Ç¢„Éº„Ç´„Ç§„ÉñÊõ¥Êñ∞
        }

        async function init() {
            try {
                updateTheme();
                await initDB();
                await migrateHabitData(); // „Éá„Éº„Çø„Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥
                await loadSettings();
                await loadKeywords();
                updateDateTime();
                setInterval(updateDateTime, 1000);
                setInterval(updateTheme, 60000);
                selectedGoalMonth = currentDate.getMonth() + 1;
                await renderAll();
            } catch (error) { console.error('Init error:', error); }
        }

        init();
    </script>
</body>
</html>
