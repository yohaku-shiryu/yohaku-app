<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ä½™ç™½">
    <meta name="theme-color" content="#0d0d14">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="manifest" href="manifest.json">
    <title>ä½™ç™½ 2026</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@300;400;500;700&family=Noto+Serif+JP:wght@300;400;500;600&family=Cormorant+Garamond:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Light Mode (Default - Day) */
            --bg-primary: #faf9f7;
            --bg-secondary: #f5f4f2;
            --bg-card: #ffffff;
            --bg-card-hover: #f8f7f5;
            --text-primary: #1a1a1a;
            --text-secondary: #4a4a4a;
            --text-muted: #8a8a8a;
            --accent-gold: #c4956a;
            --accent-gold-dim: rgba(196, 149, 106, 0.12);
            --accent-sage: #6b8f71;
            --accent-sage-dim: rgba(107, 143, 113, 0.12);
            --accent-blue: #5a7d9a;
            --accent-blue-dim: rgba(90, 125, 154, 0.12);
            --accent-rose: #b07878;
            --border-subtle: rgba(0, 0, 0, 0.06);
            --border-medium: rgba(0, 0, 0, 0.1);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.06);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 28px;
            --font-sans: 'Zen Kaku Gothic New', sans-serif;
            --font-serif: 'Noto Serif JP', serif;
            --font-display: 'Cormorant Garamond', serif;
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }
        
        [data-theme="dark"] {
            --bg-primary: #0d0d14;
            --bg-secondary: #151520;
            --bg-card: #1a1a28;
            --bg-card-hover: #22222f;
            --text-primary: #f8f0e3;
            --text-secondary: #a8a4a0;
            --text-muted: #6b6b70;
            --accent-gold: #d4a574;
            --accent-gold-dim: rgba(212, 165, 116, 0.15);
            --accent-sage: #8fa68a;
            --accent-sage-dim: rgba(143, 166, 138, 0.15);
            --accent-blue: #7d9db7;
            --accent-blue-dim: rgba(125, 157, 183, 0.15);
            --accent-rose: #c49191;
            --border-subtle: rgba(248, 240, 227, 0.08);
            --border-medium: rgba(248, 240, 227, 0.12);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.2);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; overflow: hidden; }
        body { 
            font-family: var(--font-sans); 
            background: var(--bg-primary); 
            color: var(--text-primary); 
            line-height: 1.7; 
            font-weight: 300;
            transition: background 0.5s ease, color 0.5s ease;
        }
        .app { 
            height: 100%; 
            display: flex; 
            flex-direction: column; 
            max-width: 480px; 
            margin: 0 auto; 
            background: var(--bg-primary);
            transition: background 0.5s ease;
        }
        
        /* Header */
        .header { 
            padding: calc(var(--safe-top) + 12px) 20px 16px; 
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-subtle); 
            position: relative; 
            z-index: 100;
            transition: background 0.5s ease;
        }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .logo { font-family: var(--font-serif); font-size: 26px; font-weight: 400; color: var(--text-primary); letter-spacing: 0.15em; }
        .logo span { color: var(--accent-gold); font-size: 10px; vertical-align: super; margin-left: 4px; }
        .header-actions { display: flex; gap: 8px; }
        .header-btn { 
            background: var(--bg-card); 
            border: 1px solid var(--border-subtle); 
            color: var(--text-secondary); 
            padding: 8px; 
            border-radius: 50%; 
            cursor: pointer; 
            transition: all 0.2s;
            box-shadow: var(--shadow-sm);
        }
        .header-btn:hover { background: var(--bg-card-hover); color: var(--accent-gold); }
        .header-btn svg { width: 20px; height: 20px; display: block; }
        .date-nav { display: flex; align-items: center; justify-content: center; gap: 16px; }
        .date-nav button { background: none; border: none; color: var(--text-secondary); padding: 8px; cursor: pointer; border-radius: 50%; transition: all 0.2s; }
        .date-nav button:hover { background: var(--border-subtle); color: var(--text-primary); }
        .date-nav button svg { width: 20px; height: 20px; display: block; }
        .current-date { font-family: var(--font-serif); font-size: 15px; color: var(--text-primary); cursor: pointer; padding: 6px 16px; border-radius: var(--radius-sm); transition: background 0.2s; }
        .current-date:hover { background: var(--border-subtle); }
        .current-date .weekday { color: var(--accent-gold); margin-left: 8px; font-size: 13px; }

        /* Main */
        .main { flex: 1; overflow-y: auto; overflow-x: hidden; padding: 0 0 calc(80px + var(--safe-bottom)); scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }
        .main::-webkit-scrollbar { display: none; }
        .view { display: none; padding: 20px; animation: fadeIn 0.4s ease; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Time Display */
        .time-section { text-align: center; margin-bottom: 24px; }
        .current-time { font-family: var(--font-display); font-size: 56px; color: var(--text-primary); letter-spacing: 0.05em; }
        .time-period { font-size: 14px; color: var(--text-muted); margin-top: 8px; padding: 6px 16px; display: inline-block; border-radius: 20px; }
        .time-period.morning { background: var(--accent-gold-dim); color: var(--accent-gold); }
        .time-period.evening { background: var(--accent-blue-dim); color: var(--accent-blue); }

        /* Quote Card */
        .quote-card { 
            background: var(--bg-card); 
            border: 1px solid var(--border-subtle); 
            border-radius: var(--radius-xl); 
            padding: 28px 24px; 
            margin-bottom: 24px; 
            position: relative; 
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }
        .quote-card::before { content: '"'; position: absolute; top: -10px; left: 16px; font-family: var(--font-display); font-size: 120px; color: var(--accent-gold); opacity: 0.08; line-height: 1; }
        .quote-text { font-family: var(--font-serif); font-size: 15px; line-height: 2; color: var(--text-primary); margin-bottom: 16px; position: relative; z-index: 1; }
        .quote-source { font-size: 12px; color: var(--text-muted); text-align: right; }

        /* Month Card */
        .month-card { 
            background: linear-gradient(145deg, var(--accent-gold-dim) 0%, var(--bg-card) 60%); 
            border: 1px solid var(--border-subtle); 
            border-radius: var(--radius-xl); 
            padding: 24px; 
            margin-bottom: 24px;
            box-shadow: var(--shadow-md);
        }
        .month-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .month-label { font-size: 11px; color: var(--accent-gold); text-transform: uppercase; letter-spacing: 0.2em; margin-bottom: 4px; }
        .month-theme { font-family: var(--font-serif); font-size: 28px; font-weight: 500; color: var(--text-primary); }
        .month-revenue { text-align: right; }
        .month-revenue-label { font-size: 10px; color: var(--text-muted); margin-bottom: 2px; }
        .month-revenue-value { font-family: var(--font-display); font-size: 22px; color: var(--accent-gold); }
        .month-quote { font-family: var(--font-serif); font-size: 13px; color: var(--text-secondary); font-style: italic; padding-left: 12px; border-left: 2px solid var(--accent-gold); opacity: 0.9; }

        /* Section */
        .section { margin-bottom: 28px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .section-title { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.15em; font-weight: 500; }
        .section-progress { font-size: 13px; color: var(--accent-sage); font-weight: 500; }
        .section-badge { font-size: 11px; padding: 4px 10px; border-radius: 12px; cursor: pointer; }
        .section-badge.morning { background: var(--accent-gold-dim); color: var(--accent-gold); }
        .section-badge.evening { background: var(--accent-blue-dim); color: var(--accent-blue); }
        .section.highlighted { background: var(--accent-gold-dim); margin: -12px -20px 28px; padding: 20px; border-radius: var(--radius-lg); }
        .section.highlighted.evening { background: var(--accent-blue-dim); }

        /* Habit Item */
        .habit-list { display: flex; flex-direction: column; gap: 10px; }
        .habit-item { 
            display: flex; 
            align-items: center; 
            gap: 14px; 
            background: var(--bg-card); 
            border: 1px solid var(--border-subtle); 
            border-radius: var(--radius-md); 
            padding: 16px 18px; 
            cursor: pointer; 
            transition: all 0.25s ease;
            box-shadow: var(--shadow-sm);
        }
        .habit-item:hover { background: var(--bg-card-hover); border-color: var(--border-medium); }
        .habit-item.completed { background: var(--accent-sage-dim); border-color: rgba(107, 143, 113, 0.3); }
        .habit-checkbox { width: 24px; height: 24px; border: 2px solid var(--text-muted); border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.25s; flex-shrink: 0; }
        .habit-item.completed .habit-checkbox { background: var(--accent-sage); border-color: var(--accent-sage); }
        .habit-checkbox svg { width: 14px; height: 14px; color: transparent; }
        .habit-item.completed .habit-checkbox svg { color: var(--bg-primary); }
        .habit-info { flex: 1; }
        .habit-name { font-size: 15px; color: var(--text-primary); margin-bottom: 2px; }
        .habit-time { font-size: 12px; color: var(--accent-gold); font-weight: 500; }
        .habit-item.completed .habit-name { text-decoration: line-through; opacity: 0.7; }

        /* Health Grid */
        .health-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .health-item { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 18px; box-shadow: var(--shadow-sm); }
        .health-icon { font-size: 24px; margin-bottom: 8px; }
        .health-label { font-size: 11px; color: var(--text-muted); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.1em; }
        .health-value input { background: transparent; border: none; color: var(--text-primary); font-family: var(--font-display); font-size: 24px; width: 80px; outline: none; }
        .health-unit { font-size: 12px; color: var(--text-muted); font-family: var(--font-sans); }

        /* Note Card */
        .note-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 20px; box-shadow: var(--shadow-sm); }
        .note-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
        .note-title { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.15em; }
        .note-textarea { width: 100%; min-height: 120px; background: transparent; border: none; color: var(--text-primary); font-family: var(--font-serif); font-size: 14px; line-height: 1.9; resize: none; outline: none; }
        .note-textarea::placeholder { color: var(--text-muted); }

        /* Image Upload */
        .image-upload-area { margin-top: 16px; border: 2px dashed var(--border-medium); border-radius: var(--radius-md); padding: 20px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .image-upload-area:hover { border-color: var(--accent-gold); background: var(--accent-gold-dim); }
        .image-upload-area svg { width: 32px; height: 32px; color: var(--text-muted); margin-bottom: 8px; }
        .image-upload-area p { font-size: 12px; color: var(--text-muted); }
        .uploaded-images { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 12px; }
        .uploaded-image { position: relative; aspect-ratio: 1; border-radius: var(--radius-sm); overflow: hidden; }
        .uploaded-image img { width: 100%; height: 100%; object-fit: cover; }
        .uploaded-image .remove-btn { position: absolute; top: 4px; right: 4px; width: 24px; height: 24px; background: rgba(0,0,0,0.7); border: none; border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* News Section */
        .keyword-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
        .keyword-tag { 
            padding: 8px 14px; 
            background: var(--bg-card); 
            border: 1px solid var(--border-subtle); 
            border-radius: 20px; 
            font-size: 13px; 
            color: var(--text-secondary); 
            cursor: pointer; 
            transition: all 0.2s; 
            display: flex; 
            align-items: center; 
            gap: 8px;
            box-shadow: var(--shadow-sm);
        }
        .keyword-tag:hover { border-color: var(--accent-gold); }
        .keyword-tag .remove { font-size: 16px; opacity: 0.6; line-height: 1; }
        .keyword-tag .remove:hover { opacity: 1; }
        .add-keyword-btn { padding: 8px 14px; background: transparent; border: 2px dashed var(--border-medium); border-radius: 20px; font-size: 13px; color: var(--text-muted); cursor: pointer; }
        .add-keyword-btn:hover { border-color: var(--accent-gold); color: var(--accent-gold); }
        
        .news-card { 
            background: var(--bg-card); 
            border: 1px solid var(--border-subtle); 
            border-radius: var(--radius-lg); 
            overflow: hidden; 
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
        }
        .news-card-header { 
            padding: 14px 16px; 
            border-bottom: 1px solid var(--border-subtle); 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            background: var(--accent-gold-dim);
        }
        .news-keyword { font-size: 14px; color: var(--accent-gold); font-weight: 500; }
        .news-link-btn { 
            background: var(--accent-gold); 
            border: none; 
            color: var(--bg-primary); 
            padding: 6px 12px; 
            border-radius: 16px; 
            font-size: 11px; 
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
        }
        .news-link-btn:hover { opacity: 0.9; }
        .news-list { max-height: 250px; overflow-y: auto; }
        .news-item { 
            padding: 14px 16px; 
            border-bottom: 1px solid var(--border-subtle); 
            cursor: pointer; 
            transition: background 0.2s;
            text-decoration: none;
            display: block;
        }
        .news-item:last-child { border-bottom: none; }
        .news-item:hover { background: var(--bg-card-hover); }
        .news-item-title { font-size: 13px; color: var(--text-primary); line-height: 1.6; margin-bottom: 6px; }
        .news-item-meta { display: flex; justify-content: space-between; align-items: center; }
        .news-item-source { font-size: 11px; color: var(--text-muted); }
        .news-loading { padding: 30px 16px; text-align: center; font-size: 13px; color: var(--text-muted); }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(10px); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--bg-secondary); border: 1px solid var(--border-medium); border-radius: var(--radius-xl); width: 100%; max-width: 400px; max-height: 90vh; overflow-y: auto; animation: modalIn 0.3s ease; box-shadow: var(--shadow-md); }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-bottom: 1px solid var(--border-subtle); }
        .modal-title { font-family: var(--font-serif); font-size: 18px; color: var(--text-primary); }
        .modal-close { background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 8px; }
        .modal-body { padding: 20px 24px; }

        /* Settings */
        .settings-section { margin-bottom: 24px; }
        .settings-section-title { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .settings-item { padding: 16px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); margin-bottom: 8px; }
        .settings-item-label { font-size: 14px; color: var(--text-primary); margin-bottom: 4px; }
        .settings-item-desc { font-size: 12px; color: var(--text-muted); margin-bottom: 12px; }
        .time-input-group { display: flex; align-items: center; gap: 8px; }
        .time-input { background: var(--bg-secondary); border: 1px solid var(--border-medium); border-radius: var(--radius-sm); padding: 10px 14px; color: var(--text-primary); font-family: var(--font-display); font-size: 18px; width: 100px; text-align: center; outline: none; }
        .time-input:focus { border-color: var(--accent-gold); }
        .time-separator { color: var(--text-muted); font-size: 18px; }

        /* Form */
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 12px; color: var(--text-muted); margin-bottom: 8px; }
        .form-input { width: 100%; padding: 12px 16px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-family: var(--font-sans); font-size: 14px; outline: none; }
        .form-input:focus { border-color: var(--accent-gold); }
        .btn-primary { width: 100%; padding: 14px; background: var(--accent-gold); border: none; border-radius: var(--radius-md); color: white; font-family: var(--font-sans); font-size: 14px; font-weight: 500; cursor: pointer; }
        .btn-primary:hover { opacity: 0.9; }

        /* Calendar */
        .calendar { width: 100%; }
        .calendar-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .calendar-nav button { background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 8px; }
        .calendar-month { font-family: var(--font-serif); font-size: 16px; color: var(--text-primary); }
        .calendar-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-bottom: 8px; }
        .calendar-weekday { text-align: center; font-size: 11px; color: var(--text-muted); padding: 8px 0; }
        .calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .calendar-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 14px; color: var(--text-secondary); background: none; border: none; border-radius: 50%; cursor: pointer; transition: all 0.2s; position: relative; }
        .calendar-day:hover { background: var(--border-subtle); }
        .calendar-day.today { border: 1px solid var(--accent-gold); color: var(--accent-gold); }
        .calendar-day.selected { background: var(--accent-gold); color: white; }
        .calendar-day.other-month { opacity: 0.3; }

        /* Week View */
        .week-calendar { display: flex; gap: 6px; margin-bottom: 24px; overflow-x: auto; padding: 4px 0; }
        .week-day { flex: 1; min-width: 44px; text-align: center; padding: 12px 8px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s; box-shadow: var(--shadow-sm); }
        .week-day:hover { border-color: var(--border-medium); }
        .week-day.active { background: var(--accent-gold-dim); border-color: var(--accent-gold); }
        .week-day-name { font-size: 10px; color: var(--text-muted); margin-bottom: 4px; }
        .week-day-num { font-family: var(--font-display); font-size: 18px; color: var(--text-primary); }
        .week-day.active .week-day-num { color: var(--accent-gold); }
        .week-day-progress { width: 100%; height: 3px; background: var(--border-subtle); border-radius: 2px; margin-top: 8px; overflow: hidden; }
        .week-day-progress-bar { height: 100%; background: var(--accent-sage); border-radius: 2px; }

        /* Activity List */
        .activity-list { display: flex; flex-direction: column; gap: 8px; }
        .activity-item { display: flex; align-items: center; justify-content: space-between; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 14px 16px; box-shadow: var(--shadow-sm); }
        .activity-info { display: flex; align-items: center; gap: 12px; }
        .activity-icon { font-size: 20px; }
        .activity-name { font-size: 14px; color: var(--text-primary); }
        .activity-day { font-size: 12px; color: var(--text-muted); }
        .activity-status { padding: 6px 12px; border-radius: 16px; font-size: 11px; font-weight: 500; }
        .activity-status.scheduled { background: var(--accent-gold-dim); color: var(--accent-gold); }

        /* Book List */
        .book-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 12px; }
        .book-item { display: flex; align-items: flex-start; gap: 14px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 16px; cursor: pointer; transition: all 0.2s; box-shadow: var(--shadow-sm); }
        .book-item:hover { border-color: var(--border-medium); }
        .book-item.completed { background: var(--accent-sage-dim); border-color: rgba(107, 143, 113, 0.3); }
        .book-checkbox { width: 22px; height: 22px; border: 2px solid var(--text-muted); border-radius: 4px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px; }
        .book-item.completed .book-checkbox { background: var(--accent-sage); border-color: var(--accent-sage); }
        .book-checkbox svg { width: 14px; height: 14px; color: transparent; }
        .book-item.completed .book-checkbox svg { color: var(--bg-primary); }
        .book-info { flex: 1; }
        .book-title { font-size: 14px; color: var(--text-primary); margin-bottom: 3px; }
        .book-author { font-size: 12px; color: var(--text-muted); }
        .book-item.completed .book-title { text-decoration: line-through; opacity: 0.7; }
        .add-book-btn { display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 14px; background: transparent; border: 2px dashed var(--border-medium); border-radius: var(--radius-md); color: var(--text-muted); font-size: 13px; cursor: pointer; }
        .add-book-btn:hover { border-color: var(--accent-gold); color: var(--accent-gold); }

        /* Goals */
        .goal-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 18px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; box-shadow: var(--shadow-sm); }
        .goal-card:hover { border-color: var(--border-medium); }
        .goal-card.completed { background: var(--accent-sage-dim); border-color: rgba(107, 143, 113, 0.3); }
        .goal-header { display: flex; align-items: flex-start; gap: 14px; }
        .goal-checkbox { width: 24px; height: 24px; border: 2px solid var(--text-muted); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .goal-card.completed .goal-checkbox { background: var(--accent-sage); border-color: var(--accent-sage); }
        .goal-checkbox svg { width: 14px; height: 14px; color: transparent; }
        .goal-card.completed .goal-checkbox svg { color: var(--bg-primary); }
        .goal-content { flex: 1; }
        .goal-title { font-size: 15px; color: var(--text-primary); margin-bottom: 4px; }
        .goal-card.completed .goal-title { text-decoration: line-through; opacity: 0.7; }
        .goal-deadline { font-size: 12px; color: var(--text-muted); }

        /* Month Tabs */
        .month-tabs { display: flex; gap: 8px; overflow-x: auto; padding: 4px 0 16px; margin-bottom: 16px; }
        .month-tabs::-webkit-scrollbar { display: none; }
        .month-tab { flex-shrink: 0; padding: 10px 18px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); font-size: 13px; color: var(--text-secondary); cursor: pointer; box-shadow: var(--shadow-sm); }
        .month-tab:hover { border-color: var(--border-medium); }
        .month-tab.active { background: var(--accent-gold-dim); border-color: var(--accent-gold); color: var(--accent-gold); }

        /* Five Year Plan */
        .plan-tabs { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; }
        .plan-tab { flex-shrink: 0; padding: 12px 20px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); font-family: var(--font-display); font-size: 18px; color: var(--text-secondary); cursor: pointer; box-shadow: var(--shadow-sm); }
        .plan-tab.active { background: var(--accent-gold-dim); border-color: var(--accent-gold); color: var(--accent-gold); }
        
        .plan-year-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 24px; margin-bottom: 16px; box-shadow: var(--shadow-sm); }
        .plan-year-card.current { background: linear-gradient(145deg, var(--accent-gold-dim) 0%, var(--bg-card) 40%); }
        .plan-year-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
        .plan-year { font-family: var(--font-display); font-size: 36px; color: var(--accent-gold); }
        .plan-year-theme { font-family: var(--font-serif); font-size: 18px; color: var(--text-primary); margin-top: 4px; }
        .plan-year-revenue { text-align: right; }
        .plan-year-revenue-label { font-size: 11px; color: var(--text-muted); }
        .plan-year-revenue-value { font-family: var(--font-display); font-size: 24px; color: var(--text-primary); }
        .plan-breakdown { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px; }
        .plan-breakdown-item { text-align: center; padding: 12px; background: var(--bg-secondary); border-radius: var(--radius-sm); }
        .plan-breakdown-label { font-size: 10px; color: var(--text-muted); margin-bottom: 4px; }
        .plan-breakdown-value { font-size: 14px; color: var(--text-primary); }
        .plan-section { margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border-subtle); }
        .plan-section-title { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 12px; }
        .plan-milestones { display: flex; flex-direction: column; gap: 8px; }
        .plan-milestone { display: flex; align-items: flex-start; gap: 12px; padding: 10px 0; }
        .plan-milestone-dot { width: 8px; height: 8px; background: var(--accent-gold); border-radius: 50%; margin-top: 6px; flex-shrink: 0; }
        .plan-milestone-text { font-size: 13px; color: var(--text-secondary); }
        .plan-quarter { background: var(--bg-secondary); border-radius: var(--radius-md); padding: 16px; margin-bottom: 12px; }
        .plan-quarter-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .plan-quarter-name { font-weight: 500; color: var(--text-primary); }
        .plan-quarter-revenue { font-family: var(--font-display); color: var(--accent-gold); }
        .plan-quarter-events { font-size: 13px; color: var(--text-secondary); }

        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 24px; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 20px; text-align: center; box-shadow: var(--shadow-sm); }
        .stat-value { font-family: var(--font-display); font-size: 36px; color: var(--accent-gold); margin-bottom: 4px; }
        .stat-label { font-size: 12px; color: var(--text-muted); }

        /* Guidelines */
        .guidelines { background: linear-gradient(145deg, var(--accent-gold-dim) 0%, var(--bg-card) 60%); border: 1px solid var(--border-subtle); border-radius: var(--radius-xl); padding: 24px; box-shadow: var(--shadow-sm); }
        .guideline-item { display: flex; align-items: flex-start; gap: 14px; padding: 12px 0; border-bottom: 1px solid var(--border-subtle); }
        .guideline-item:last-child { border-bottom: none; padding-bottom: 0; }
        .guideline-icon { width: 32px; height: 32px; background: var(--accent-gold-dim); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .guideline-icon svg { width: 16px; height: 16px; color: var(--accent-gold); }
        .guideline-text { font-family: var(--font-serif); font-size: 14px; color: var(--text-primary); line-height: 1.7; }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--bg-primary); border-top: 1px solid var(--border-subtle); padding: 10px 0 calc(var(--safe-bottom) + 6px); z-index: 100; transition: background 0.5s ease; }
        .nav-list { display: flex; justify-content: space-around; max-width: 480px; margin: 0 auto; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 3px; padding: 6px 10px; background: none; border: none; color: var(--text-muted); font-size: 9px; cursor: pointer; transition: color 0.2s; }
        .nav-item:hover { color: var(--text-secondary); }
        .nav-item.active { color: var(--accent-gold); }
        .nav-item svg { width: 22px; height: 22px; }

        /* Toast */
        .toast { position: fixed; bottom: calc(90px + var(--safe-bottom)); left: 50%; transform: translateX(-50%) translateY(100px); background: var(--accent-sage); color: white; padding: 12px 24px; border-radius: var(--radius-md); font-size: 13px; font-weight: 500; opacity: 0; transition: all 0.3s; z-index: 200; }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        
        /* Theme indicator */
        .theme-indicator { font-size: 11px; color: var(--text-muted); margin-left: 8px; }
    </style>
</head>
<body>
    <div class="app">
        <header class="header">
            <div class="header-top">
                <div class="logo">ä½™ç™½<span>2026</span></div>
                <div class="header-actions">
                    <button class="header-btn" onclick="openSettings()" title="è¨­å®š">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                    </button>
                </div>
            </div>
            <div class="date-nav">
                <button id="prevDay"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg></button>
                <div class="current-date" id="currentDate" onclick="openCalendar()"><span class="date-text"></span><span class="weekday"></span></div>
                <button id="nextDay"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg></button>
            </div>
        </header>
        <main class="main">
            <!-- Today View -->
            <div class="view active" id="todayView">
                <div class="time-section">
                    <div class="current-time" id="currentTime">00:00</div>
                    <div class="time-period" id="timePeriod"></div>
                </div>
                <div class="quote-card"><p class="quote-text" id="dailyQuote"></p><p class="quote-source">â€” è³ªé‡ã¨ä½™ç™½ã®é–“ã§</p></div>
                <div class="month-card">
                    <div class="month-card-header">
                        <div><div class="month-label">ä»Šæœˆã®ãƒ†ãƒ¼ãƒ</div><div class="month-theme" id="monthTheme">å§‹å‹•</div></div>
                        <div class="month-revenue"><div class="month-revenue-label">ç›®æ¨™æœˆå•†</div><div class="month-revenue-value" id="monthRevenue">Â¥20ä¸‡</div></div>
                    </div>
                    <p class="month-quote" id="monthQuote"></p>
                </div>
                <div class="section" id="morningSection">
                    <div class="section-header"><span class="section-title">æœã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³</span><span class="section-badge morning" id="morningTimeBadge" onclick="openSettings()">6:00 - 9:00</span></div>
                    <div class="section-header"><span></span><span class="section-progress" id="morningProgress">0/5</span></div>
                    <div class="habit-list" id="morningHabits"></div>
                </div>
                <div class="section" id="eveningSection">
                    <div class="section-header"><span class="section-title">å¤œã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³</span><span class="section-badge evening" id="eveningTimeBadge" onclick="openSettings()">21:00 - 24:00</span></div>
                    <div class="section-header"><span></span><span class="section-progress" id="eveningProgress">0/4</span></div>
                    <div class="habit-list" id="eveningHabits"></div>
                </div>
                <div class="section"><div class="section-header"><span class="section-title">ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢</span></div><div class="health-grid" id="healthGrid"></div></div>
                <div class="section">
                    <div class="note-card">
                        <div class="note-header"><span class="note-title">ä»Šæ—¥ã®è¨˜éŒ²</span></div>
                        <textarea class="note-textarea" id="dailyNote" placeholder="ä»Šæ—¥ã®æ°—ã¥ãã€æ„Ÿè¬ã€æŒ¯ã‚Šè¿”ã‚Šã‚’è¨˜éŒ²ã™ã‚‹..."></textarea>
                        <div class="image-upload-area" id="imageUploadArea"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg><p>ç”»åƒã‚’è¿½åŠ </p></div>
                        <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
                        <div class="uploaded-images" id="uploadedImages"></div>
                    </div>
                </div>
            </div>
            
            <!-- News View -->
            <div class="view" id="newsView">
                <div class="section">
                    <div class="section-header"><span class="section-title">ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</span></div>
                    <div class="keyword-tags" id="keywordTags"></div>
                </div>
                <div id="newsContainer"></div>
            </div>
            
            <!-- Week View -->
            <div class="view" id="weekView">
                <div class="week-calendar" id="weekCalendar"></div>
                <div class="section"><div class="section-header"><span class="section-title">é€±é–“ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£</span></div><div class="activity-list" id="weeklyActivities"></div></div>
                <div class="section"><div class="section-header"><span class="section-title">ä»Šæœˆã®èª­æ›¸</span><span class="section-progress" id="bookProgress">0/5</span></div><div class="book-list" id="bookList"></div><button class="add-book-btn" onclick="openAddBookModal()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>æœ¬ã‚’è¿½åŠ </button></div>
            </div>
            
            <!-- Goals View -->
            <div class="view" id="goalsView">
                <div class="section"><div class="section-header"><span class="section-title">2026å¹´ å¹´é–“ç›®æ¨™</span></div><div id="yearGoals"></div></div>
                <div class="month-tabs" id="monthTabs"></div>
                <div class="section"><div class="section-header"><span class="section-title" id="monthGoalsTitle">1æœˆã®ç›®æ¨™</span></div><div id="monthGoals"></div></div>
            </div>
            
            <!-- Plan View -->
            <div class="view" id="planView">
                <div class="quote-card" style="margin-bottom: 24px;"><p class="quote-text">è³ªé‡ã¨ä½™ç™½ã®é–“ã§ã€‚2030å¹´ã¸å‘ã‘ã¦ã€‚</p><p class="quote-source">â€” è±Šã‹ãªå¾Œæ‚”ã®å¤šã„äººç”Ÿã‚’</p></div>
                <div class="plan-tabs" id="planTabs"></div>
                <div id="fiveYearPlan"></div>
            </div>
            
            <!-- Stats View -->
            <div class="view" id="statsView">
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value" id="totalStreak">0</div><div class="stat-label">ç¶™ç¶šæ—¥æ•°</div></div>
                    <div class="stat-card"><div class="stat-value" id="totalHabits">0</div><div class="stat-label">å®Œäº†ã—ãŸç¿’æ…£</div></div>
                    <div class="stat-card"><div class="stat-value" id="totalGoals">0</div><div class="stat-label">é”æˆã—ãŸç›®æ¨™</div></div>
                    <div class="stat-card"><div class="stat-value" id="totalBooks">0</div><div class="stat-label">èª­ã‚“ã æœ¬</div></div>
                </div>
                <div class="guidelines">
                    <div class="section-title" style="margin-bottom: 16px;">å¹´é–“æŒ‡é‡</div>
                    <div class="guideline-item"><div class="guideline-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2z"/></svg></div><p class="guideline-text">æ‰¹è©•å®¶ã«ãªã‚‰ãšã€æ‰‹ã‚’å‹•ã‹ã—ç¶šã‘ã‚‹</p></div>
                    <div class="guideline-item"><div class="guideline-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></div><p class="guideline-text">è„†å¼±æ€§ã‚’èªã‚åˆã†é–¢ä¿‚æ€§ã‚’ä½œã‚‹</p></div>
                    <div class="guideline-item"><div class="guideline-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg></div><p class="guideline-text">ä¸å¯é€†æ€§ã¨ä¸€å›æ€§ã‚’å¤§åˆ‡ã«ã™ã‚‹</p></div>
                    <div class="guideline-item"><div class="guideline-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg></div><p class="guideline-text">ã‚¨ãƒƒã‚»ãƒ³ã‚·ãƒ£ãƒ«ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒèª°ã‚ˆã‚Šã‚‚å¹¸ã›ã§ã‚ã£ã¦ã»ã—ã„</p></div>
                </div>
            </div>
        </main>
        
        <nav class="bottom-nav">
            <div class="nav-list">
                <button class="nav-item active" data-view="todayView"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>ä»Šæ—¥</button>
                <button class="nav-item" data-view="newsView"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 20H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v1m2 13a2 2 0 0 1-2-2V7m2 13a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2m-4-3H9M7 16h6M7 12h6"/></svg>ãƒ‹ãƒ¥ãƒ¼ã‚¹</button>
                <button class="nav-item" data-view="weekView"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>é€±é–“</button>
                <button class="nav-item" data-view="goalsView"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>ç›®æ¨™</button>
                <button class="nav-item" data-view="planView"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>è¨ˆç”»</button>
                <button class="nav-item" data-view="statsView"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>çµ±è¨ˆ</button>
            </div>
        </nav>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="calendarModal"><div class="modal"><div class="modal-header"><span class="modal-title">æ—¥ä»˜ã‚’é¸æŠ</span><button class="modal-close" onclick="closeCalendar()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div><div class="modal-body"><div class="calendar"><div class="calendar-nav"><button onclick="prevMonth()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg></button><span class="calendar-month" id="calendarMonth"></span><button onclick="nextMonth()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg></button></div><div class="calendar-weekdays"><div class="calendar-weekday">æ—¥</div><div class="calendar-weekday">æœˆ</div><div class="calendar-weekday">ç«</div><div class="calendar-weekday">æ°´</div><div class="calendar-weekday">æœ¨</div><div class="calendar-weekday">é‡‘</div><div class="calendar-weekday">åœŸ</div></div><div class="calendar-days" id="calendarDays"></div></div></div></div></div>
    
    <div class="modal-overlay" id="settingsModal"><div class="modal"><div class="modal-header"><span class="modal-title">ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³æ™‚é–“è¨­å®š</span><button class="modal-close" onclick="closeSettings()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div><div class="modal-body">
        <div class="settings-section"><div class="settings-section-title">ğŸŒ… æœã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³é–‹å§‹æ™‚åˆ»</div><div class="settings-item"><div class="settings-item-label">é–‹å§‹æ™‚åˆ»ã‚’è¨­å®š</div><div class="settings-item-desc">ã“ã®æ™‚åˆ»ã‹ã‚‰æœãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ãŒå§‹ã¾ã‚Šã¾ã™</div><div class="time-input-group"><input type="time" class="time-input" id="morningStart" value="06:00"></div></div></div>
        <div class="settings-section"><div class="settings-section-title">ğŸŒ™ å¤œã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³é–‹å§‹æ™‚åˆ»</div><div class="settings-item"><div class="settings-item-label">é–‹å§‹æ™‚åˆ»ã‚’è¨­å®š</div><div class="settings-item-desc">ã“ã®æ™‚åˆ»ã‹ã‚‰å¤œãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ãŒå§‹ã¾ã‚Šã¾ã™</div><div class="time-input-group"><input type="time" class="time-input" id="eveningStart" value="21:00"></div></div></div>
        <button class="btn-primary" onclick="saveSettings()">ä¿å­˜ã™ã‚‹</button>
    </div></div></div>
    
    <div class="modal-overlay" id="addBookModal"><div class="modal"><div class="modal-header"><span class="modal-title">æœ¬ã‚’è¿½åŠ </span><button class="modal-close" onclick="closeAddBookModal()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div><div class="modal-body"><div class="form-group"><label class="form-label">ã‚¿ã‚¤ãƒˆãƒ«</label><input type="text" class="form-input" id="bookTitleInput" placeholder="æœ¬ã®ã‚¿ã‚¤ãƒˆãƒ«"></div><div class="form-group"><label class="form-label">è‘—è€…</label><input type="text" class="form-input" id="bookAuthorInput" placeholder="è‘—è€…å"></div><button class="btn-primary" onclick="addCustomBook()">è¿½åŠ ã™ã‚‹</button></div></div></div>
    
    <div class="modal-overlay" id="addKeywordModal"><div class="modal"><div class="modal-header"><span class="modal-title">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ </span><button class="modal-close" onclick="closeAddKeywordModal()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div><div class="modal-body"><div class="form-group"><label class="form-label">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label><input type="text" class="form-input" id="keywordInput" placeholder="ä¾‹: AI, èªçŸ¥ç—‡, ã‚¢ãƒ¼ãƒˆ"></div><button class="btn-primary" onclick="addKeyword()">è¿½åŠ ã™ã‚‹</button></div></div></div>
    
    <div class="toast" id="toast">ä¿å­˜ã—ã¾ã—ãŸ</div>

    <script>
        // ============================================
        // DATA
        // ============================================
        const QUOTES = [
            "ã‚¨ãƒƒã‚»ãƒ³ã‚·ãƒ£ãƒ«ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒèª°ã‚ˆã‚Šã‚‚å¹¸ã›ã§ã‚ã£ã¦ã»ã—ã„ã€‚ã“ã®ç¥ˆã‚Šã‚’ã€ç¥ˆã‚Šã®ã¾ã¾ã«ã—ãªã„ã€‚",
            "è±Šã‹ãªå¾Œæ‚”ã¨ã¯ã€èµ·ã“ã‚‰ãªã‹ã£ãŸã“ã¨ã‚„èµ·ã“ã•ãªã‹ã£ãŸéå»ã‚’è²¬ã‚ã‚‹ã®ã§ã¯ãªãã€èµ·ã“ã‚‰ãªã‹ã£ãŸã¾ã¾ç¾ã—ãæ®‹ã—ã¦ãŠãæ…‹åº¦ã®ã“ã¨ã ã€‚",
            "å‚ã«ã„ã‚‹ã¨ã„ã†ã“ã¨ã¯ã€ç›¸æ‰‹ã‚’å¤‰ãˆã‚ˆã†ã¨ã—ãªã„ã“ã¨ã ã€‚åŠ©ã‘ã‚ˆã†ã¨ã—ãªã„ã“ã¨ã ã€‚ãŸã ã€ãã“ã«ã„ã‚‹ã“ã¨ã€‚",
            "ç’°ä¸–ç•Œã®é•ã„ã‚’èªã‚ã€å°Šé‡ã™ã‚‹ã“ã¨ãŒã€çœŸã®å¯¾è©±ã®å‰ææ¡ä»¶ã¨ãªã‚‹ã€‚",
            "è‹¦ç—›ã‚‚ã¾ãŸã€ç™ºé…µã®ç´ æã«ãªã‚Šå¾—ã‚‹ã€‚",
            "ä½™ç™½ã¨ã¯ã€åŠ¹ç‡æ€§ã®è«–ç†ã‹ã‚‰å¤–ã‚ŒãŸã‚‚ã®ã ã€‚ã—ã‹ã—ã€äººé–“ã¨ã—ã¦ç”Ÿãã‚‹ãŸã‚ã«ã¯ã€ãã®ã‚ˆã†ãªä½™ç™½ãŒä¸å¯æ¬ ã ã€‚",
            "æ‰¹è©•å®¶ã«ãªã‚‰ãšã€æ‰‹ã‚’å‹•ã‹ã—ç¶šã‘ã‚‹ã€‚",
            "è„†å¼±æ€§ã‚’èªã‚åˆã†é–¢ä¿‚æ€§ã‚’ã€ã©ã‚Œã ã‘ä½œã‚Œã‚‹ã‹ã€‚",
            "å¾Œæ‚”ã¯ã€é¸æŠã®è¨¼ã ã€‚å¾Œæ‚”ã§ãã‚‹ã¨ã„ã†ã“ã¨ã¯ã€é¸æŠè‚¢ãŒã‚ã£ãŸã¨ã„ã†ã“ã¨ã€‚",
            "äººé–“ã‹ã‚‰ã™ã¹ã¦ã‚’å¥ªã†ã“ã¨ãŒã§ãã‚‹ã€‚ãŸã ä¸€ã¤ã®ã“ã¨ã‚’é™¤ã„ã¦ã€‚ãã‚Œã¯ã€ä¸ãˆã‚‰ã‚ŒãŸç’°å¢ƒã®ä¸­ã§è‡ªã‚‰ã®æ…‹åº¦ã‚’é¸ã¶ã¨ã„ã†ã€äººé–“ã®æœ€å¾Œã®è‡ªç”±ã§ã‚ã‚‹ã€‚",
            "ãªãœç”Ÿãã‚‹ã‹ã‚’çŸ¥ã£ã¦ã„ã‚‹è€…ã¯ã€ã©ã®ã‚ˆã†ã«ç”Ÿãã‚‹ã“ã¨ã«ã‚‚è€ãˆã‚‹ã€‚",
            "ç§ãŸã¡ã®æ™‚é–“ã¯æœ‰é™ã ã€‚é™ã‚‰ã‚ŒãŸæ™‚é–“ã®ä¸­ã§ã€ä½•ã‚’å¤§åˆ‡ã«ã—ã€ä½•ã‚’é¸ã³å–ã‚‹ã‹ã€‚",
            "è³ªé‡ã¨ä½™ç™½ã®é–“ã§ã€‚è±Šã‹ãªå¾Œæ‚”ã®å¤šã„äººç”Ÿã‚’ã€‚",
            "ç§ã«å¿…è¦ãªçµŒé¨“ã‚’ãã ã•ã„ã€‚ã¾ã ã‚ã‚‹ã¨ã™ã‚‹ã®ãªã‚‰ã€ãã‚Œã‚’ç§ã«ãã ã•ã„ã€‚"
        ];

        const MONTHS = {
            1: { theme: 'å§‹å‹•', revenue: '20ä¸‡', quote: 'å¹´é–“è¨ˆç”»ç¢ºå®šã€ãƒ‰ãƒ©ãƒ ç·´ç¿’é–‹å§‹ã€ãƒ•ã‚¡ã‚¹ãƒ†ã‚£ãƒ³ã‚°ç¿’æ…£åŒ–', goals: ['å¹´é–“è¨ˆç”»ç¢ºå®šãƒ»å…±æœ‰', 'ãƒ‰ãƒ©ãƒ ç·´ç¿’é–‹å§‹', 'ãƒ•ã‚¡ã‚¹ãƒ†ã‚£ãƒ³ã‚°ç¿’æ…£åŒ–', 'æœãƒ«ãƒ¼ãƒ†ã‚£ãƒ³å®šç€', 'æŠ•è³‡å®¶ãƒªã‚¹ãƒˆä½œæˆ', 'noteè¨˜äº‹2æœ¬', 'ç¾è¡“å±•3å›', 'èª­æ›¸5å†Š'] },
            2: { theme: 'æ·±æ˜ã‚Š', revenue: '25ä¸‡', quote: 'MBAé›†ä¸­ã€ã‚³ãƒ¼ãƒãƒ³ã‚°ç ”ä¿®ç”³è¾¼', goals: ['MBAï¼ˆè²¡å‹™ãƒ»ä¼šè¨ˆï¼‰é›†ä¸­', 'ã‚³ãƒ¼ãƒãƒ³ã‚°ç ”ä¿®ç”³è¾¼', 'è„†å¼±æ€§è«–æ–‡3æœ¬', 'ãƒ”ãƒƒãƒç·´ç¿’10å›', 'èª­æ›¸5å†Š', 'ç¾è¡“å±•3å›'] },
            3: { theme: 'å¯¾è©±', revenue: '30ä¸‡', quote: 'ä¹ƒæœ¨å‚ç‰©ä»¶æ¢ã—ã€yohakuå–¶æ¥­å¼·åŒ–', goals: ['ä¹ƒæœ¨å‚ç‰©ä»¶å†…è¦‹3ä»¶', 'æŠ•è³‡å®¶é¢è«‡3ä»¶', 'NVCãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—', 'èª­æ›¸5å†Š', 'ç¾è¡“å±•3å›'] },
            4: { theme: 'ç§»è»¢', revenue: '35ä¸‡', quote: 'ä¹ƒæœ¨å‚å¼•è¶Šã—ã€å†™çœŸå±•ä¼ç”»é–‹å§‹', goals: ['ä¹ƒæœ¨å‚å¼•è¶Šã—å®Œäº†', 'å†™çœŸå±•ä¼ç”»æ›¸ä½œæˆ', 'ãƒ•ã‚£ãƒ«ãƒ 5æœ¬æ’®å½±', 'èª­æ›¸5å†Š', 'ç¾è¡“å±•3å›'] },
            5: { theme: 'äº‹æ¥­', revenue: '45ä¸‡', quote: 'ã‚·ãƒ¼ãƒ‰èª¿é”ã€PxDTä¸ŠæœŸæˆæœ', goals: ['yohakuæœˆå•†50ä¸‡å††', 'PxDTä¸ŠæœŸæˆæœã¾ã¨ã‚', 'æŠ•è³‡å®¶é¢è«‡5ä»¶', 'èª­æ›¸5å†Š', 'ç¾è¡“å±•3å›'] },
            6: { theme: 'è©•ä¾¡', revenue: '50ä¸‡', quote: 'PxDTä¸ŠæœŸè©•ä¾¡ã€ä¸ŠåŠæœŸæŒ¯ã‚Šè¿”ã‚Š', goals: ['PxDTä¸ŠæœŸè©•ä¾¡é¢è«‡', 'ä¸ŠåŠæœŸç·æŒ¯ã‚Šè¿”ã‚Š', 'ã‚³ãƒ¼ãƒãƒ³ã‚°ç ”ä¿®é–‹å§‹', 'èª­æ›¸4å†Š', 'ç¾è¡“å±•3å›'] },
            7: { theme: 'ç¶™æ‰¿', revenue: '55ä¸‡', quote: 'è³‡æ ¼ç ”ä¿®é›†ä¸­ã€åºƒå³¶', goals: ['ã‚³ãƒ¼ãƒãƒ³ã‚°è³‡æ ¼ç ”ä¿®', 'æˆ¦äº‰ã¨è¨˜æ†¶ã®note', 'åºƒå³¶è¨ªå•è¨ˆç”»ç¢ºå®š', 'èª­æ›¸5å†Š', 'ç¾è¡“å±•3å›'] },
            8: { theme: 'ç¥ˆã‚Š', revenue: '55ä¸‡', quote: '8æœˆ6æ—¥ã€å‚ã«ã„ã‚‹ã“ã¨ã®æ„å‘³', goals: ['8/6 åºƒå³¶è¨ªå•', 'è³‡æ ¼è©¦é¨“æº–å‚™', 'å†™çœŸé¸å®š', 'èª­æ›¸4å†Š'] },
            9: { theme: 'è³‡æ ¼', revenue: '60ä¸‡', quote: 'ã‚³ãƒ¼ãƒãƒ³ã‚°è³‡æ ¼è©¦é¨“ã€å†™çœŸå±•æº–å‚™', goals: ['ã‚³ãƒ¼ãƒãƒ³ã‚°è³‡æ ¼åˆæ ¼', 'å†™çœŸå±•æº–å‚™æœ¬æ ¼åŒ–', 'ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—é–‹ç™º', 'èª­æ›¸5å†Š', 'ç¾è¡“å±•3å›'] },
            10: { theme: 'æ¥ç¶š', revenue: '70ä¸‡', quote: 'ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã¨ã‚±ã‚¢ã®é–“', goals: ['yohakuæœˆå•†80ä¸‡å††', 'ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼Ã—ã‚±ã‚¢è«–è€ƒ', 'å†™çœŸå±•å‘ŠçŸ¥', 'èª­æ›¸5å†Š', 'ç¾è¡“å±•3å›'] },
            11: { theme: 'ç™ºè¡¨', revenue: '85ä¸‡', quote: 'ãƒ•ã‚£ãƒ«ãƒ å†™çœŸå±•é–‹å‚¬ã€ã‚¹ã‚¤ã‚¹æº–å‚™', goals: ['å†™çœŸå±•é–‹å‚¬ãƒ»æˆåŠŸ', 'PxDTä¸‹æœŸæˆæœ', 'ã‚¹ã‚¤ã‚¹æ¸¡èˆªæº–å‚™', 'èª­æ›¸5å†Š', 'ç¾è¡“å±•2å›'] },
            12: { theme: 'é”æˆ', revenue: '100ä¸‡', quote: 'yohakuæœˆå•†100ä¸‡ã€ã‚¹ã‚¤ã‚¹æ¸¡èˆª', goals: ['yohakuæœˆå•†100ä¸‡å††', 'PxDTä¸‹æœŸè©•ä¾¡ãƒ»æ˜‡æ ¼', 'ã‚¹ã‚¤ã‚¹æ¸¡èˆª', '2026å¹´ç·æ‹¬note', '2027å¹´è¨ˆç”»ç­–å®š', 'èª­æ›¸4å†Š'] }
        };

        const YEAR_GOALS = [
            { text: 'yohakuæœˆå•†100ä¸‡å††é”æˆ', deadline: '12æœˆ' },
            { text: 'PxDTæ˜‡æ ¼ãƒ»æ˜‡çµ¦', deadline: 'è©•ä¾¡æœŸ' },
            { text: 'ã‚³ãƒ¼ãƒãƒ³ã‚°è³‡æ ¼å–å¾—', deadline: '9æœˆ' },
            { text: 'ãƒ•ã‚£ãƒ«ãƒ å†™çœŸå±•é–‹å‚¬', deadline: '11æœˆ' },
            { text: 'ãƒ‰ãƒ©ãƒ åŸºç¤ç¿’å¾—', deadline: 'é€šå¹´' },
            { text: 'MBAç§‘ç›®ä¿®äº†', deadline: 'é€šå¹´' },
            { text: 'ä¹ƒæœ¨å‚ã¸å¼•è¶Šã—', deadline: '4æœˆ' },
            { text: 'ã‚¹ã‚¤ã‚¹æ¸¡èˆª', deadline: '12æœˆ' }
        ];

        // æœãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ï¼ˆæ‰€è¦æ™‚é–“åˆ†å˜ä½ï¼‰
        const MORNING_HABITS = [
            { id: 'wake', name: 'èµ·åºŠãƒ»ç™½æ¹¯', duration: 5 },
            { id: 'meditation', name: 'ç‘æƒ³', duration: 15 },
            { id: 'walk', name: 'æœæ•£æ­©', duration: 30 },
            { id: 'exercise', name: 'ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°', duration: 15 },
            { id: 'breakfast', name: 'æœé£Ÿï¼ˆè…¸æ´»ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼‰', duration: 30 }
        ];

        // å¤œãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ï¼ˆæ‰€è¦æ™‚é–“åˆ†å˜ä½ï¼‰
        const EVENING_HABITS = [
            { id: 'reading', name: 'èª­æ›¸', duration: 45 },
            { id: 'study', name: 'MBAå­¦ç¿’ or ãƒ‰ãƒ©ãƒ ç·´ç¿’', duration: 30 },
            { id: 'journal', name: 'æ—¥è¨˜ãƒ»æŒ¯ã‚Šè¿”ã‚Š', duration: 15 },
            { id: 'night_meditation', name: 'å…¥æµ´ãƒ»ç‘æƒ³', duration: 30 }
        ];

        const WEEKLY_ACTIVITIES = [
            { id: 'mba', name: 'MBAå­¦ç¿’', icon: 'ğŸ“š', day: 'æœˆãƒ»æ°´ãƒ»æ—¥' },
            { id: 'drum', name: 'ãƒ‰ãƒ©ãƒ ç·´ç¿’', icon: 'ğŸ¥', day: 'ç«ãƒ»æœ¨' },
            { id: 'nvc', name: 'NVCã‚»ãƒƒã‚·ãƒ§ãƒ³', icon: 'ğŸ’¬', day: 'ç«' },
            { id: 'film', name: 'ãƒ•ã‚£ãƒ«ãƒ æ’®å½±', icon: 'ğŸ“·', day: 'åœŸãƒ»æ—¥' },
            { id: 'art', name: 'ç¾è¡“å±•', icon: 'ğŸ¨', day: 'åœŸãƒ»æ—¥' },
            { id: 'tea', name: 'èŒ¶é“', icon: 'ğŸµ', day: 'æœˆ1å› åœŸæ›œ' },
            { id: 'fasting', name: '24hãƒ•ã‚¡ã‚¹ãƒ†ã‚£ãƒ³ã‚°', icon: 'ğŸŒ™', day: 'æœˆ1å›' }
        ];

        const MONTHLY_BOOKS = {
            1: [{ title: 'ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«åŸè«–', author: 'æ³¢é ­äº®' }, { title: 'ã‚±ã‚¢ã®å€«ç†', author: 'å²¡é‡å…«ä»£' }, { title: 'å­˜åœ¨ã¨æ™‚é–“ï¼ˆå…¥é–€æ›¸ï¼‰', author: 'ãƒã‚¤ãƒ‡ã‚¬ãƒ¼' }, { title: 'äººé–“å¤±æ ¼', author: 'å¤ªå®°æ²»' }, { title: 'ç¾ä»£ã‚¢ãƒ¼ãƒˆã¨ã¯ä½•ã‹', author: 'å°å´å“²å“‰' }],
            2: [{ title: 'ã‚‚ã†ã²ã¨ã¤ã®å£°ã§', author: 'ã‚®ãƒªã‚¬ãƒ³' }, { title: 'MBAãƒ•ã‚¡ã‚¤ãƒŠãƒ³ã‚¹', author: 'ã‚°ãƒ­ãƒ¼ãƒ“ã‚¹' }, { title: 'è«–èªï¼ˆæ–°è¨³ï¼‰', author: '' }, { title: 'ã“ã“ã‚', author: 'å¤ç›®æ¼±çŸ³' }, { title: 'ç¾è¡“ã®ç‰©èª', author: 'ã‚´ãƒ³ãƒ–ãƒªãƒƒãƒ' }],
            3: [{ title: 'ã‚±ã‚¢ã®å€«ç†ã¨å…±æ„Ÿ', author: 'ã‚¹ãƒ­ãƒ¼ãƒˆ' }, { title: 'NVC äººã¨äººã¨ã®é–¢ä¿‚ã«ã„ã®ã¡ã‚’å¹ãè¾¼ã‚€æ³•', author: 'ãƒ­ãƒ¼ã‚¼ãƒ³ãƒãƒ¼ã‚°' }],
            4: [{ title: 'æ˜ã‚‹ã„éƒ¨å±‹', author: 'ãƒãƒ«ãƒˆ' }, { title: 'å†™çœŸè«–', author: 'ã‚½ãƒ³ã‚¿ã‚°' }],
            5: [{ title: '2030å¹´ã®ä¸–ç•Œåœ°å›³å¸³', author: 'è½åˆé™½ä¸€' }, { title: 'ãƒ‡ã‚¸ã‚¿ãƒ«ãƒã‚¤ãƒãƒ£ãƒ¼', author: 'è½åˆé™½ä¸€' }],
            6: [{ title: 'ã„ã®ã¡ã¯ã®ã¡ã®ã„ã®ã¡ã¸', author: 'ç¨²è‘‰ä¿Šéƒ' }],
            7: [{ title: 'ä»–è€…ã®è‹¦ç—›ã¸ã®ã¾ãªã–ã—', author: 'ã‚½ãƒ³ã‚¿ã‚°' }, { title: 'å¤œã¨éœ§', author: 'ãƒ•ãƒ©ãƒ³ã‚¯ãƒ«' }],
            8: [{ title: 'åŸçˆ†è©©é›†', author: 'å³ ä¸‰å‰' }, { title: 'ãƒ’ãƒ­ã‚·ãƒãƒ»ãƒãƒ¼ãƒˆ', author: 'å¤§æ±Ÿå¥ä¸‰éƒ' }],
            9: [{ title: 'æ„›ã™ã‚‹ã¨ã„ã†ã“ã¨', author: 'ãƒ•ãƒ­ãƒ ' }, { title: 'æš‡ã¨é€€å±ˆã®å€«ç†å­¦', author: 'åœ‹åˆ†åŠŸä¸€éƒ' }],
            10: [{ title: 'ç”Ÿå‘½ã¨ã¯ä½•ã‹', author: 'ã‚·ãƒ¥ãƒ¬ãƒ¼ãƒ‡ã‚£ãƒ³ã‚¬ãƒ¼' }, { title: 'ç”Ÿç‰©ã‹ã‚‰è¦‹ãŸä¸–ç•Œ', author: 'ãƒ¦ã‚¯ã‚¹ã‚­ãƒ¥ãƒ«' }],
            11: [{ title: 'è´ˆä¸è«–', author: 'ãƒ¢ãƒ¼ã‚¹' }],
            12: [{ title: 'ãƒ„ã‚¡ãƒ©ãƒˆã‚¥ã‚¹ãƒˆãƒ©', author: 'ãƒ‹ãƒ¼ãƒã‚§' }, { title: 'é›ªå›½', author: 'å·ç«¯åº·æˆ' }]
        };

        // 5å¹´è¨ˆç”»ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿
        const FIVE_YEAR_PLAN = {
            2026: {
                theme: 'åŸºç›¤æ§‹ç¯‰', revenue: '1,500ä¸‡',
                breakdown: { pxdt: '900ä¸‡', hb: '100ä¸‡', yohaku: '500ä¸‡' },
                yohakuMonthly: '42ä¸‡',
                quarters: [
                    { q: 'Q1', period: '1-3æœˆ', revenue: '20â†’30ä¸‡', cumulative: '75ä¸‡', events: 'ã‚³ãƒ¼ãƒãƒ³ã‚°è³‡æ ¼ç ”ä¿®é–‹å§‹' },
                    { q: 'Q2', period: '4-6æœˆ', revenue: '35â†’50ä¸‡', cumulative: '200ä¸‡', events: 'ä¹ƒæœ¨å‚å¼•è¶Šã—ã€PxDTä¸ŠæœŸè©•ä¾¡' },
                    { q: 'Q3', period: '7-9æœˆ', revenue: '50â†’60ä¸‡', cumulative: '365ä¸‡', events: 'ã‚³ãƒ¼ãƒãƒ³ã‚°è³‡æ ¼å–å¾—' },
                    { q: 'Q4', period: '10-12æœˆ', revenue: '70â†’100ä¸‡', cumulative: '500ä¸‡', events: 'å†™çœŸå±•ã€ã‚¹ã‚¤ã‚¹ã€PxDTä¸‹æœŸè©•ä¾¡' }
                ],
                smartGoals: {
                    business: ['PxDTï¼šæ˜‡æ ¼ï¼ˆ6æœˆè©•ä¾¡ï¼‰ã€å¹´å900ä¸‡å††é”æˆ', 'HERALBONYï¼šæœˆé¡8ä¸‡å††å®‰å®šã€å¹´é–“100ä¸‡å††', 'yohakuï¼š12æœˆã«æœˆå•†100ä¸‡å††é”æˆ', 'ã‚³ãƒ¼ãƒãƒ³ã‚°è³‡æ ¼ï¼š9æœˆå–å¾—'],
                    skill: ['MBAç§‘ç›®ï¼šå¹´é–“12ç§‘ç›®ä¿®äº†', 'èª­æ›¸ï¼š57å†Šï¼ˆæœˆ4-5å†Šï¼‰', 'ç¾è¡“å±•ï¼š36å›ï¼ˆæœˆ3å›ï¼‰'],
                    artist: ['ãƒ•ã‚£ãƒ«ãƒ å†™çœŸå±•ï¼š11æœˆé–‹å‚¬', 'ãƒ‰ãƒ©ãƒ ï¼šåŸºç¤ç¿’å¾—ã€ã‚¹ã‚¿ã‚¸ã‚ªç·´ç¿’é€±2å›'],
                    life: ['ä¹ƒæœ¨å‚å¼•è¶Šã—ï¼š4æœˆ', 'ä½“é‡60kgç¶­æŒ', 'ã‚¹ã‚¤ã‚¹æ¸¡èˆªï¼š12æœˆ']
                }
            },
            2027: {
                theme: 'å°‚é–€æ·±åŒ–', revenue: '2,000ä¸‡',
                breakdown: { pxdt: '1,100ä¸‡', hb: '100ä¸‡', yohaku: '800ä¸‡' },
                yohakuMonthly: '67ä¸‡',
                quarters: [
                    { q: 'Q1', period: '1-3æœˆ', revenue: '50â†’60ä¸‡', cumulative: '165ä¸‡', events: 'ã‚³ãƒ¼ãƒãƒ³ã‚°é¡§å®¢5åä½“åˆ¶' },
                    { q: 'Q2', period: '4-6æœˆ', revenue: '65â†’75ä¸‡', cumulative: '375ä¸‡', events: 'ãƒã‚¤ã‚¯å…è¨±å–å¾—ã€å†™çœŸå±•ä¼ç”»' },
                    { q: 'Q3', period: '7-9æœˆ', revenue: '75â†’85ä¸‡', cumulative: '615ä¸‡', events: 'ãƒ‰ãƒ©ãƒ åˆãƒ©ã‚¤ãƒ–ã€ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘æ—…è¡Œ' },
                    { q: 'Q4', period: '10-12æœˆ', revenue: '90â†’100ä¸‡', cumulative: '800ä¸‡', events: 'å†™çœŸå±•ã€yohaku Appä¼ç”»é–‹å§‹' }
                ],
                smartGoals: {
                    business: ['PxDTï¼šå¹´å1,100ä¸‡å††', 'yohakuï¼šæœˆå•†100ä¸‡å††å®‰å®šåŒ–', 'ã‚³ãƒ¼ãƒãƒ³ã‚°é¡§å®¢ï¼šæœˆ5åç¶™ç¶š', 'è¬›æ¼”ï¼šå¹´8å›'],
                    skill: ['MBAï¼šå…¨ç§‘ç›®ä¿®äº†', 'èª­æ›¸ï¼š60å†Š', 'ç¾è¡“å±•ï¼š36å›'],
                    artist: ['å†™çœŸå±•ï¼šç¬¬2å›é–‹å‚¬', 'ãƒ‰ãƒ©ãƒ ï¼šåˆãƒ©ã‚¤ãƒ–å‡ºæ¼”', 'ãƒ”ã‚¢ãƒï¼šåŸºç¤æ›²3æ›²ç¿’å¾—'],
                    life: ['ãƒã‚¤ã‚¯å…è¨±ï¼šå–å¾—', 'æµ·å¤–æ—…è¡Œï¼šãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘']
                }
            },
            2028: {
                theme: 'äº‹æ¥­æ‹¡å¤§', revenue: '5,000ä¸‡',
                breakdown: { pxdt: '1,300ä¸‡', hb: '120ä¸‡', yohaku: '3,580ä¸‡' },
                yohakuMonthly: '300ä¸‡',
                quarters: [
                    { q: 'Q1', period: '1-3æœˆ', revenue: '150â†’200ä¸‡', cumulative: '525ä¸‡', events: 'ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼æ¡ç”¨é–‹å§‹' },
                    { q: 'Q2', period: '4-6æœˆ', revenue: '220â†’270ä¸‡', cumulative: '1,260ä¸‡', events: 'yohaku AppÎ²ç‰ˆãƒ­ãƒ¼ãƒ³ãƒ' },
                    { q: 'Q3', period: '7-9æœˆ', revenue: '280â†’300ä¸‡', cumulative: '2,130ä¸‡', events: 'ãƒãƒ³ãƒ‰æ´»å‹•æœ¬æ ¼åŒ–' },
                    { q: 'Q4', period: '10-12æœˆ', revenue: '310â†’330ä¸‡', cumulative: '3,580ä¸‡', events: 'ç¬¬3å›å†™çœŸå±•' }
                ],
                smartGoals: {
                    business: ['yohakuï¼šæœˆå•†300ä¸‡å††é”æˆ', 'yohaku Appï¼šãƒ­ãƒ¼ãƒ³ãƒã€MAU 1,000', 'ãƒãƒ¼ãƒ ï¼š2åæ¡ç”¨', 'ã‚±ã‚¢äº‹æ¥­ï¼šBtoBç ”ä¿®10ç¤¾å°å…¥'],
                    skill: ['è¬›æ¼”ï¼šå¹´20å›'],
                    artist: ['å†™çœŸå±•ï¼šç¬¬3å›', 'ãƒ‰ãƒ©ãƒ ï¼šãƒãƒ³ãƒ‰åŠ å…¥ or çµæˆ'],
                    life: ['ãƒã‚¤ã‚¯è³¼å…¥ãƒ»ãƒ„ãƒ¼ãƒªãƒ³ã‚°é–‹å§‹', 'æµ·å¤–ï¼š3å›']
                }
            },
            2029: {
                theme: 'å¤šè§’åŒ–', revenue: '7,000ä¸‡',
                breakdown: { pxdt: '1,500ä¸‡', hb: '120ä¸‡', yohaku: '5,380ä¸‡' },
                yohakuMonthly: '450ä¸‡',
                quarters: [
                    { q: 'Q1', period: '1-3æœˆ', revenue: '350â†’400ä¸‡', cumulative: '1,125ä¸‡', events: 'ãƒãƒ¼ãƒ 5ååŒ–' },
                    { q: 'Q2', period: '4-6æœˆ', revenue: '420â†’450ä¸‡', cumulative: '2,430ä¸‡', events: 'æµ·å¤–å¸‚å ´èª¿æŸ»' },
                    { q: 'Q3', period: '7-9æœˆ', revenue: '460â†’480ä¸‡', cumulative: '3,840ä¸‡', events: 'è‡ªä¸»ä¼ç”»ãƒ©ã‚¤ãƒ–' },
                    { q: 'Q4', period: '10-12æœˆ', revenue: '490â†’500ä¸‡', cumulative: '5,380ä¸‡', events: 'ç¬¬4å›å†™çœŸå±•ï¼ˆæµ·å¤–æ¤œè¨ï¼‰' }
                ],
                smartGoals: {
                    business: ['yohakuï¼šæœˆå•†500ä¸‡å††é”æˆ', 'ãƒãƒ¼ãƒ ï¼š5åä½“åˆ¶', 'yohaku Appï¼šMAU 5,000', 'ã‚±ã‚¢äº‹æ¥­ï¼šSaaSåŒ–ç€æ‰‹'],
                    skill: ['è¬›æ¼”ï¼šå¹´30å›ï¼ˆæ¥­ç•ŒèªçŸ¥ç¢ºç«‹ï¼‰'],
                    artist: ['å†™çœŸå±•ï¼šç¬¬4å›ï¼ˆæµ·å¤–æ¤œè¨ï¼‰', 'ãƒ‰ãƒ©ãƒ ï¼šè‡ªä¸»ä¼ç”»ãƒ©ã‚¤ãƒ–é–‹å‚¬'],
                    life: ['ãƒã‚¤ã‚¯ãƒ„ãƒ¼ãƒªãƒ³ã‚°ï¼šå›½å†…åˆ¶è¦‡è¨ˆç”»', 'æµ·å¤–ï¼š3å›ä»¥ä¸Š']
                }
            },
            2030: {
                theme: 'çµ±åˆ', revenue: '1å„„',
                breakdown: { pxdt: '1,800ä¸‡', hb: '120ä¸‡', yohaku: '8,080ä¸‡' },
                yohakuMonthly: '670ä¸‡',
                quarters: [
                    { q: 'Q1', period: '1-3æœˆ', revenue: '550â†’600ä¸‡', cumulative: '1,725ä¸‡', events: 'äº‹æ¥­çµ±åˆã€åŠ¹ç‡åŒ–' },
                    { q: 'Q2', period: '4-6æœˆ', revenue: '620â†’670ä¸‡', cumulative: '3,660ä¸‡', events: 'æµ·å¤–å±•é–‹æœ¬æ ¼åŒ–' },
                    { q: 'Q3', period: '7-9æœˆ', revenue: '680â†’700ä¸‡', cumulative: '5,730ä¸‡', events: 'éŸ³æ¥½æ´»å‹•é›†å¤§æˆ' },
                    { q: 'Q4', period: '10-12æœˆ', revenue: '720â†’800ä¸‡', cumulative: '8,080ä¸‡', events: 'ç¬¬5å›å†™çœŸå±•ã€å¹´å1å„„é”æˆ' }
                ],
                smartGoals: {
                    business: ['yohakuï¼šå¹´å•†1å„„å††é”æˆ', 'ãƒãƒ¼ãƒ ï¼š10åä½“åˆ¶', 'yohaku Appï¼šMAU 20,000', 'ã‚±ã‚¢SaaSï¼šARR 1,800ä¸‡å††'],
                    skill: ['æ¥­ç•Œã§ã®èªçŸ¥ï¼šã‚±ã‚¢Ã—ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã®ç¬¬ä¸€äººè€…'],
                    artist: ['å†™çœŸå±•ï¼šç¬¬5å›ï¼ˆ5å¹´é€£ç¶šé”æˆï¼‰', 'éŸ³æ¥½ï¼šã‚¢ãƒ«ãƒãƒ åˆ¶ä½œ or å®šæœŸãƒ©ã‚¤ãƒ–'],
                    life: ['çµŒæ¸ˆçš„è‡ªç”±ã®åŸºç›¤ç¢ºç«‹', 'æµ·å¤–ï¼š4å›ä»¥ä¸Š']
                }
            }
        };

        const HEALTH_ITEMS = [
            { id: 'weight', label: 'ä½“é‡', icon: 'âš–ï¸', unit: 'kg', default: '60.0' },
            { id: 'sleep', label: 'ç¡çœ ', icon: 'ğŸ˜´', unit: 'æ™‚é–“', default: '7.0' },
            { id: 'steps', label: 'æ­©æ•°', icon: 'ğŸ‘Ÿ', unit: 'æ­©', default: '8000' },
            { id: 'water', label: 'æ°´åˆ†', icon: 'ğŸ’§', unit: 'L', default: '2.0' }
        ];

        const DEFAULT_KEYWORDS = ['AI', 'é›£è´', 'ãƒ˜ãƒ©ãƒ«ãƒœãƒ‹ãƒ¼', 'ã‚¢ãƒ¼ãƒˆ', 'ãƒ”ã‚¯ã‚·ãƒ¼ãƒ€ã‚¹ãƒˆãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã‚º', 'èªçŸ¥ç—‡'];

        // ============================================
        // STATE
        // ============================================
        let currentDate = new Date();
        let calendarViewDate = new Date();
        let selectedGoalMonth = 1;
        let selectedPlanYear = 2026;
        let db = null;
        let newsKeywords = [...DEFAULT_KEYWORDS];
        let settings = { morningStart: '06:00', eveningStart: '21:00' };

        // ============================================
        // THEME
        // ============================================
        function updateTheme() {
            const hour = new Date().getHours();
            const isDark = hour >= 18 || hour < 6;
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
            document.querySelector('meta[name="theme-color"]').content = isDark ? '#0d0d14' : '#faf9f7';
        }

        // ============================================
        // IndexedDB
        // ============================================
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('YohakuDB', 5);
                request.onerror = () => reject(request.error);
                request.onsuccess = () => { db = request.result; resolve(db); };
                request.onupgradeneeded = (e) => {
                    const database = e.target.result;
                    ['habits', 'goals', 'health', 'notes', 'books', 'images', 'customBooks', 'settings', 'keywords'].forEach(store => {
                        if (!database.objectStoreNames.contains(store)) {
                            database.createObjectStore(store, { keyPath: 'id', autoIncrement: store === 'customBooks' });
                        }
                    });
                };
            });
        }

        async function dbGet(store, key) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction([store], 'readonly');
                const req = tx.objectStore(store).get(key);
                req.onerror = () => reject(req.error);
                req.onsuccess = () => resolve(req.result);
            });
        }

        async function dbPut(store, data) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction([store], 'readwrite');
                const req = tx.objectStore(store).put(data);
                req.onerror = () => reject(req.error);
                req.onsuccess = () => resolve(req.result);
            });
        }

        async function dbGetAll(store) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction([store], 'readonly');
                const req = tx.objectStore(store).getAll();
                req.onerror = () => reject(req.error);
                req.onsuccess = () => resolve(req.result);
            });
        }

        // ============================================
        // UTILITIES
        // ============================================
        function formatDate(date) { return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`; }
        function getDateKey() { return formatDate(currentDate); }
        function getWeekday(date) { return ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][date.getDay()]; }
        function showToast(msg = 'ä¿å­˜ã—ã¾ã—ãŸ') { const t = document.getElementById('toast'); t.textContent = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2000); }
        
        function addMinutes(timeStr, minutes) {
            const [h, m] = timeStr.split(':').map(Number);
            const totalMinutes = h * 60 + m + minutes;
            const newH = Math.floor(totalMinutes / 60) % 24;
            const newM = totalMinutes % 60;
            return `${String(newH).padStart(2, '0')}:${String(newM).padStart(2, '0')}`;
        }
        
        function timeToMinutes(timeStr) { const [h, m] = timeStr.split(':').map(Number); return h * 60 + m; }
        
        function isInTimeRange(start, durationMinutes) {
            const now = new Date();
            const current = now.getHours() * 60 + now.getMinutes();
            const startM = timeToMinutes(start);
            const endM = startM + durationMinutes;
            return current >= startM && current <= endM;
        }

        // ============================================
        // TIME & PERIOD
        // ============================================
        function getTotalDuration(habits) {
            return habits.reduce((sum, h) => sum + h.duration, 0);
        }
        
        function updateDateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            const morningDuration = getTotalDuration(MORNING_HABITS);
            const eveningDuration = getTotalDuration(EVENING_HABITS);
            const isMorning = isInTimeRange(settings.morningStart, morningDuration);
            const isEvening = isInTimeRange(settings.eveningStart, eveningDuration);
            
            const periodEl = document.getElementById('timePeriod');
            const morningSection = document.getElementById('morningSection');
            const eveningSection = document.getElementById('eveningSection');
            
            periodEl.className = 'time-period';
            morningSection.classList.remove('highlighted');
            eveningSection.classList.remove('highlighted', 'evening');
            
            if (isMorning) {
                periodEl.textContent = 'ğŸŒ… æœã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã®æ™‚é–“ã§ã™';
                periodEl.classList.add('morning');
                morningSection.classList.add('highlighted');
            } else if (isEvening) {
                periodEl.textContent = 'ğŸŒ™ å¤œã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã®æ™‚é–“ã§ã™';
                periodEl.classList.add('evening');
                eveningSection.classList.add('highlighted', 'evening');
            } else {
                const hour = now.getHours();
                if (hour >= 5 && hour < 12) periodEl.textContent = 'â˜€ï¸ åˆå‰ä¸­ã§ã™';
                else if (hour >= 12 && hour < 17) periodEl.textContent = 'ğŸŒ¤ åˆå¾Œã®æ™‚é–“ã§ã™';
                else if (hour >= 17 && hour < 21) periodEl.textContent = 'ğŸŒ† å¤•æ–¹ã®æ™‚é–“ã§ã™';
                else periodEl.textContent = 'ğŸŒ™ å¤œã®æ™‚é–“ã§ã™';
            }
            
            updateTheme();
        }

        function updateTimeRangeDisplay() {
            const morningEnd = addMinutes(settings.morningStart, getTotalDuration(MORNING_HABITS));
            const eveningEnd = addMinutes(settings.eveningStart, getTotalDuration(EVENING_HABITS));
            document.getElementById('morningTimeBadge').textContent = `${settings.morningStart} - ${morningEnd}`;
            document.getElementById('eveningTimeBadge').textContent = `${settings.eveningStart} - ${eveningEnd}`;
        }

        // ============================================
        // RENDER FUNCTIONS
        // ============================================
        function updateDateDisplay() {
            document.querySelector('#currentDate .date-text').textContent = `${currentDate.getMonth() + 1}æœˆ${currentDate.getDate()}æ—¥`;
            document.querySelector('#currentDate .weekday').textContent = getWeekday(currentDate);
        }

        function updateQuote() {
            const dayOfYear = Math.floor((currentDate - new Date(currentDate.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            document.getElementById('dailyQuote').textContent = QUOTES[dayOfYear % QUOTES.length];
        }

        function updateMonthCard() {
            const month = currentDate.getMonth() + 1;
            const data = MONTHS[month];
            document.getElementById('monthTheme').textContent = data.theme;
            document.getElementById('monthRevenue').textContent = `Â¥${data.revenue}`;
            document.getElementById('monthQuote').textContent = data.quote;
        }

        async function renderHabits(habits, containerId, period, progressId, startTime) {
            const container = document.getElementById(containerId);
            const dateKey = getDateKey();
            let completed = 0;
            let currentTime = startTime;
            container.innerHTML = '';
            
            for (const habit of habits) {
                const key = `${dateKey}-${period}-${habit.id}`;
                const data = await dbGet('habits', key);
                const isCompleted = data?.completed || false;
                if (isCompleted) completed++;
                
                const timeDisplay = currentTime;
                currentTime = addMinutes(currentTime, habit.duration);
                
                const item = document.createElement('div');
                item.className = `habit-item ${isCompleted ? 'completed' : ''}`;
                item.onclick = () => toggleHabit(period, habit.id);
                item.innerHTML = `
                    <div class="habit-checkbox"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div>
                    <div class="habit-info">
                        <div class="habit-name">${habit.name}</div>
                        <div class="habit-time">${timeDisplay}ã€œï¼ˆ${habit.duration}åˆ†ï¼‰</div>
                    </div>`;
                container.appendChild(item);
            }
            document.getElementById(progressId).textContent = `${completed}/${habits.length}`;
        }

        async function renderMorningHabits() { await renderHabits(MORNING_HABITS, 'morningHabits', 'morning', 'morningProgress', settings.morningStart); }
        async function renderEveningHabits() { await renderHabits(EVENING_HABITS, 'eveningHabits', 'evening', 'eveningProgress', settings.eveningStart); }

        async function renderHealthGrid() {
            const container = document.getElementById('healthGrid');
            const dateKey = getDateKey();
            container.innerHTML = '';
            for (const item of HEALTH_ITEMS) {
                const data = await dbGet('health', `${dateKey}-${item.id}`);
                const value = data?.value || item.default;
                const div = document.createElement('div');
                div.className = 'health-item';
                div.innerHTML = `<div class="health-icon">${item.icon}</div><div class="health-label">${item.label}</div><div class="health-value"><input type="number" step="0.1" value="${value}" onchange="updateHealth('${item.id}', this.value)" onclick="this.select()"><span class="health-unit">${item.unit}</span></div>`;
                container.appendChild(div);
            }
        }

        async function renderDailyNote() {
            const data = await dbGet('notes', getDateKey());
            document.getElementById('dailyNote').value = data?.text || '';
        }

        async function renderUploadedImages() {
            const container = document.getElementById('uploadedImages');
            const data = await dbGet('images', getDateKey());
            const images = data?.images || [];
            container.innerHTML = images.map((img, i) => `<div class="uploaded-image"><img src="${img}" alt=""><button class="remove-btn" onclick="removeImage(${i})"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div>`).join('');
        }

        // ============================================
        // NEWS FUNCTIONS
        // ============================================
        async function loadKeywords() {
            const data = await dbGet('keywords', 'userKeywords');
            if (data?.keywords?.length) newsKeywords = data.keywords;
            else newsKeywords = [...DEFAULT_KEYWORDS];
        }

        async function saveKeywords() {
            await dbPut('keywords', { id: 'userKeywords', keywords: newsKeywords });
        }

        function renderKeywordTags() {
            const container = document.getElementById('keywordTags');
            container.innerHTML = newsKeywords.map((kw, i) => `<div class="keyword-tag"><span>${kw}</span><span class="remove" onclick="event.stopPropagation(); removeKeyword(${i})">Ã—</span></div>`).join('') + '<button class="add-keyword-btn" onclick="openAddKeywordModal()">+ è¿½åŠ </button>';
        }

        function renderNews() {
            const container = document.getElementById('newsContainer');
            container.innerHTML = newsKeywords.map(kw => {
                const searchUrl = `https://news.google.com/search?q=${encodeURIComponent(kw)}&hl=ja&gl=JP&ceid=JP:ja`;
                return `
                    <div class="news-card">
                        <div class="news-card-header">
                            <span class="news-keyword">${kw}</span>
                            <a href="${searchUrl}" target="_blank" class="news-link-btn">Google Newsã§é–‹ã â†’</a>
                        </div>
                        <div class="news-list">
                            <div class="news-item" onclick="window.open('${searchUrl}', '_blank')">
                                <div class="news-item-title">ã€Œ${kw}ã€ã®æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è¦‹ã‚‹</div>
                                <div class="news-item-meta">
                                    <span class="news-item-source">Google News</span>
                                    <span class="news-item-date">ã‚¿ãƒƒãƒ—ã—ã¦é–‹ã</span>
                                </div>
                            </div>
                        </div>
                    </div>`;
            }).join('');
        }

        function openAddKeywordModal() { document.getElementById('addKeywordModal').classList.add('active'); document.getElementById('keywordInput').value = ''; }
        function closeAddKeywordModal() { document.getElementById('addKeywordModal').classList.remove('active'); }

        async function addKeyword() {
            const input = document.getElementById('keywordInput').value.trim();
            if (!input) return;
            if (!newsKeywords.includes(input)) {
                newsKeywords.push(input);
                await saveKeywords();
                renderKeywordTags();
                renderNews();
            }
            closeAddKeywordModal();
            showToast('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
        }

        async function removeKeyword(index) {
            newsKeywords.splice(index, 1);
            await saveKeywords();
            renderKeywordTags();
            renderNews();
            showToast('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }

        // ============================================
        // WEEK VIEW
        // ============================================
        async function renderWeekCalendar() {
            const container = document.getElementById('weekCalendar');
            container.innerHTML = '';
            const startOfWeek = new Date(currentDate);
            startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + i);
                const dateKey = formatDate(date);
                const isActive = dateKey === formatDate(currentDate);
                let completed = 0;
                const total = MORNING_HABITS.length + EVENING_HABITS.length;
                for (const h of MORNING_HABITS) { if ((await dbGet('habits', `${dateKey}-morning-${h.id}`))?.completed) completed++; }
                for (const h of EVENING_HABITS) { if ((await dbGet('habits', `${dateKey}-evening-${h.id}`))?.completed) completed++; }
                const div = document.createElement('div');
                div.className = `week-day ${isActive ? 'active' : ''}`;
                div.onclick = () => { currentDate = new Date(date); renderAll(); };
                div.innerHTML = `<div class="week-day-name">${getWeekday(date)}</div><div class="week-day-num">${date.getDate()}</div><div class="week-day-progress"><div class="week-day-progress-bar" style="width: ${total > 0 ? (completed / total) * 100 : 0}%"></div></div>`;
                container.appendChild(div);
            }
        }

        function renderWeeklyActivities() {
            const container = document.getElementById('weeklyActivities');
            const today = getWeekday(currentDate);
            const isWeekend = today === 'åœŸ' || today === 'æ—¥';
            container.innerHTML = WEEKLY_ACTIVITIES.map(a => {
                let isToday = a.day.includes(today);
                if (a.id === 'film' && isWeekend) isToday = true;
                if (a.id === 'art' && isWeekend) isToday = true;
                return `<div class="activity-item"><div class="activity-info"><span class="activity-icon">${a.icon}</span><div><div class="activity-name">${a.name}</div><div class="activity-day">${a.day}</div></div></div><span class="activity-status ${isToday ? 'scheduled' : ''}">${isToday ? 'ä»Šæ—¥' : 'äºˆå®š'}</span></div>`;
            }).join('');
        }

        async function renderBookList() {
            const container = document.getElementById('bookList');
            const month = currentDate.getMonth() + 1;
            const books = MONTHLY_BOOKS[month] || [];
            container.innerHTML = '';
            let completed = 0;
            for (const book of books) {
                const key = `book-${month}-${book.title}`;
                const data = await dbGet('books', key);
                const isCompleted = data?.completed || false;
                if (isCompleted) completed++;
                const div = document.createElement('div');
                div.className = `book-item ${isCompleted ? 'completed' : ''}`;
                div.onclick = () => toggleBook(month, book.title);
                div.innerHTML = `<div class="book-checkbox"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div><div class="book-info"><div class="book-title">${book.title}</div><div class="book-author">${book.author}</div></div>`;
                container.appendChild(div);
            }
            const customBooks = (await dbGetAll('customBooks')).filter(b => b.month === month);
            for (const book of customBooks) {
                if (book.completed) completed++;
                const div = document.createElement('div');
                div.className = `book-item ${book.completed ? 'completed' : ''}`;
                div.onclick = () => toggleCustomBook(book.id);
                div.innerHTML = `<div class="book-checkbox"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div><div class="book-info"><div class="book-title">${book.title}</div><div class="book-author">${book.author}</div></div>`;
                container.appendChild(div);
            }
            document.getElementById('bookProgress').textContent = `${completed}/${books.length + customBooks.length}`;
        }

        // ============================================
        // GOALS
        // ============================================
        async function renderYearGoals() {
            const container = document.getElementById('yearGoals');
            container.innerHTML = '';
            for (let i = 0; i < YEAR_GOALS.length; i++) {
                const goal = YEAR_GOALS[i];
                const data = await dbGet('goals', `year-goal-${i}`);
                const isCompleted = data?.completed || false;
                const div = document.createElement('div');
                div.className = `goal-card ${isCompleted ? 'completed' : ''}`;
                div.onclick = () => toggleYearGoal(i);
                div.innerHTML = `<div class="goal-header"><div class="goal-checkbox"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div><div class="goal-content"><div class="goal-title">${goal.text}</div><div class="goal-deadline">${goal.deadline}</div></div></div>`;
                container.appendChild(div);
            }
        }

        function renderMonthTabs() {
            const container = document.getElementById('monthTabs');
            container.innerHTML = '';
            for (let m = 1; m <= 12; m++) {
                const tab = document.createElement('button');
                tab.className = `month-tab ${m === selectedGoalMonth ? 'active' : ''}`;
                tab.textContent = `${m}æœˆ`;
                tab.onclick = () => { selectedGoalMonth = m; renderMonthTabs(); renderMonthGoals(); };
                container.appendChild(tab);
            }
        }

        async function renderMonthGoals() {
            const container = document.getElementById('monthGoals');
            const data = MONTHS[selectedGoalMonth];
            document.getElementById('monthGoalsTitle').textContent = `${selectedGoalMonth}æœˆã®ç›®æ¨™`;
            container.innerHTML = '';
            for (let i = 0; i < data.goals.length; i++) {
                const goalData = await dbGet('goals', `month-${selectedGoalMonth}-goal-${i}`);
                const isCompleted = goalData?.completed || false;
                const div = document.createElement('div');
                div.className = `goal-card ${isCompleted ? 'completed' : ''}`;
                div.onclick = () => toggleMonthGoal(selectedGoalMonth, i);
                div.innerHTML = `<div class="goal-header"><div class="goal-checkbox"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div><div class="goal-content"><div class="goal-title">${data.goals[i]}</div></div></div>`;
                container.appendChild(div);
            }
        }

        // ============================================
        // FIVE YEAR PLAN
        // ============================================
        function renderPlanTabs() {
            const container = document.getElementById('planTabs');
            container.innerHTML = [2026, 2027, 2028, 2029, 2030].map(year => 
                `<button class="plan-tab ${year === selectedPlanYear ? 'active' : ''}" onclick="selectPlanYear(${year})">${year}</button>`
            ).join('');
        }

        function selectPlanYear(year) {
            selectedPlanYear = year;
            renderPlanTabs();
            renderFiveYearPlan();
        }

        function renderFiveYearPlan() {
            const container = document.getElementById('fiveYearPlan');
            const y = FIVE_YEAR_PLAN[selectedPlanYear];
            const isCurrent = selectedPlanYear === 2026;
            
            container.innerHTML = `
                <div class="plan-year-card ${isCurrent ? 'current' : ''}">
                    <div class="plan-year-header">
                        <div>
                            <div class="plan-year">${selectedPlanYear}</div>
                            <div class="plan-year-theme">${y.theme}</div>
                        </div>
                        <div class="plan-year-revenue">
                            <div class="plan-year-revenue-label">å¹´åç›®æ¨™</div>
                            <div class="plan-year-revenue-value">Â¥${y.revenue}</div>
                        </div>
                    </div>
                    <div class="plan-breakdown">
                        <div class="plan-breakdown-item"><div class="plan-breakdown-label">PxDT</div><div class="plan-breakdown-value">Â¥${y.breakdown.pxdt}</div></div>
                        <div class="plan-breakdown-item"><div class="plan-breakdown-label">HB</div><div class="plan-breakdown-value">Â¥${y.breakdown.hb}</div></div>
                        <div class="plan-breakdown-item"><div class="plan-breakdown-label">yohaku</div><div class="plan-breakdown-value">Â¥${y.breakdown.yohaku}</div></div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: var(--accent-gold-dim); border-radius: var(--radius-md); margin-bottom: 16px;">
                        <div style="font-size: 11px; color: var(--text-muted);">yohakuæœˆå•†å¹³å‡</div>
                        <div style="font-family: var(--font-display); font-size: 28px; color: var(--accent-gold);">Â¥${y.yohakuMonthly}</div>
                    </div>
                </div>
                
                <div class="section-title" style="margin: 20px 0 12px;">å››åŠæœŸãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³</div>
                ${y.quarters.map(q => `
                    <div class="plan-quarter">
                        <div class="plan-quarter-header">
                            <span class="plan-quarter-name">${q.q}ï¼ˆ${q.period}ï¼‰</span>
                            <span class="plan-quarter-revenue">Â¥${q.revenue}</span>
                        </div>
                        <div class="plan-quarter-events">${q.events}</div>
                        <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">ç´¯è¨ˆ: Â¥${q.cumulative}</div>
                    </div>
                `).join('')}
                
                <div class="section-title" style="margin: 20px 0 12px;">SMARTç›®æ¨™</div>
                <div class="plan-year-card">
                    ${Object.entries(y.smartGoals).map(([category, goals]) => `
                        <div class="plan-section" style="margin-top: 0; padding-top: 0; border-top: none;">
                            <div class="plan-section-title">${{business: 'ğŸ’¼ äº‹æ¥­ãƒ»ã‚­ãƒ£ãƒªã‚¢', skill: 'ğŸ“š ã‚¹ã‚­ãƒ«ãƒ»å­¦ç¿’', artist: 'ğŸ¨ ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆæ´»å‹•', life: 'ğŸŒ± ç”Ÿæ´»'}[category]}</div>
                            <div class="plan-milestones">
                                ${goals.map(g => `<div class="plan-milestone"><div class="plan-milestone-dot"></div><div class="plan-milestone-text">${g}</div></div>`).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function renderStats() {
            let streak = 0;
            let checkDate = new Date();
            while (streak < 365) {
                const dateKey = formatDate(checkDate);
                let dayComplete = true;
                for (const h of [...MORNING_HABITS, ...EVENING_HABITS]) {
                    const period = MORNING_HABITS.includes(h) ? 'morning' : 'evening';
                    if (!(await dbGet('habits', `${dateKey}-${period}-${h.id}`))?.completed) { dayComplete = false; break; }
                }
                if (dayComplete) { streak++; checkDate.setDate(checkDate.getDate() - 1); } else break;
            }
            document.getElementById('totalStreak').textContent = streak;
            document.getElementById('totalHabits').textContent = (await dbGetAll('habits')).filter(h => h.completed).length;
            document.getElementById('totalGoals').textContent = (await dbGetAll('goals')).filter(g => g.completed).length;
            document.getElementById('totalBooks').textContent = (await dbGetAll('books')).filter(b => b.completed).length + (await dbGetAll('customBooks')).filter(b => b.completed).length;
        }

        // ============================================
        // EVENT HANDLERS
        // ============================================
        async function toggleHabit(period, habitId) {
            const key = `${getDateKey()}-${period}-${habitId}`;
            const data = await dbGet('habits', key);
            const newValue = !(data?.completed || false);
            await dbPut('habits', { id: key, completed: newValue });
            if (period === 'morning') renderMorningHabits(); else renderEveningHabits();
            renderStats();
            showToast(newValue ? 'å®Œäº†ï¼' : 'å–ã‚Šæ¶ˆã—ã¾ã—ãŸ');
        }

        async function updateHealth(id, value) {
            await dbPut('health', { id: `${getDateKey()}-${id}`, value });
            showToast();
        }

        async function toggleBook(month, title) {
            const key = `book-${month}-${title}`;
            const data = await dbGet('books', key);
            await dbPut('books', { id: key, completed: !(data?.completed || false) });
            renderBookList(); renderStats();
            showToast(!(data?.completed) ? 'èª­äº†ï¼' : 'å–ã‚Šæ¶ˆã—ã¾ã—ãŸ');
        }

        async function toggleCustomBook(id) {
            const book = await dbGet('customBooks', id);
            if (book) { book.completed = !book.completed; await dbPut('customBooks', book); renderBookList(); renderStats(); showToast(book.completed ? 'èª­äº†ï¼' : 'å–ã‚Šæ¶ˆã—ã¾ã—ãŸ'); }
        }

        async function toggleYearGoal(index) {
            const key = `year-goal-${index}`;
            const data = await dbGet('goals', key);
            await dbPut('goals', { id: key, completed: !(data?.completed || false) });
            renderYearGoals(); renderStats();
            showToast(!(data?.completed) ? 'é”æˆï¼' : 'å–ã‚Šæ¶ˆã—ã¾ã—ãŸ');
        }

        async function toggleMonthGoal(month, index) {
            const key = `month-${month}-goal-${index}`;
            const data = await dbGet('goals', key);
            await dbPut('goals', { id: key, completed: !(data?.completed || false) });
            renderMonthGoals(); renderStats();
            showToast(!(data?.completed) ? 'é”æˆï¼' : 'å–ã‚Šæ¶ˆã—ã¾ã—ãŸ');
        }

        // Calendar
        function openCalendar() { calendarViewDate = new Date(currentDate); renderCalendar(); document.getElementById('calendarModal').classList.add('active'); }
        function closeCalendar() { document.getElementById('calendarModal').classList.remove('active'); }
        function prevMonth() { calendarViewDate.setMonth(calendarViewDate.getMonth() - 1); renderCalendar(); }
        function nextMonth() { calendarViewDate.setMonth(calendarViewDate.getMonth() + 1); renderCalendar(); }
        function renderCalendar() {
            document.getElementById('calendarMonth').textContent = `${calendarViewDate.getFullYear()}å¹´ ${calendarViewDate.getMonth() + 1}æœˆ`;
            const container = document.getElementById('calendarDays');
            const firstDay = new Date(calendarViewDate.getFullYear(), calendarViewDate.getMonth(), 1);
            const lastDay = new Date(calendarViewDate.getFullYear(), calendarViewDate.getMonth() + 1, 0);
            const startDay = firstDay.getDay();
            const totalDays = lastDay.getDate();
            const today = new Date();
            const prevMonthLastDay = new Date(calendarViewDate.getFullYear(), calendarViewDate.getMonth(), 0).getDate();
            let html = '';
            for (let i = startDay - 1; i >= 0; i--) html += `<button class="calendar-day other-month">${prevMonthLastDay - i}</button>`;
            for (let i = 1; i <= totalDays; i++) {
                const dayDate = new Date(calendarViewDate.getFullYear(), calendarViewDate.getMonth(), i);
                const isToday = formatDate(dayDate) === formatDate(today);
                const isSelected = formatDate(dayDate) === formatDate(currentDate);
                html += `<button class="calendar-day ${isToday ? 'today' : ''} ${isSelected ? 'selected' : ''}" onclick="selectDate(${i})">${i}</button>`;
            }
            const remaining = 42 - (startDay + totalDays);
            for (let i = 1; i <= remaining; i++) html += `<button class="calendar-day other-month">${i}</button>`;
            container.innerHTML = html;
        }
        function selectDate(day) { currentDate = new Date(calendarViewDate.getFullYear(), calendarViewDate.getMonth(), day); closeCalendar(); renderAll(); }

        // Settings
        function openSettings() {
            document.getElementById('morningStart').value = settings.morningStart;
            document.getElementById('eveningStart').value = settings.eveningStart;
            document.getElementById('settingsModal').classList.add('active');
        }
        function closeSettings() { document.getElementById('settingsModal').classList.remove('active'); }
        async function saveSettings() {
            settings.morningStart = document.getElementById('morningStart').value;
            settings.eveningStart = document.getElementById('eveningStart').value;
            await dbPut('settings', { id: 'routineTimes', ...settings });
            updateTimeRangeDisplay();
            updateDateTime();
            await renderMorningHabits();
            await renderEveningHabits();
            closeSettings();
            showToast('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
        }
        async function loadSettings() {
            const data = await dbGet('settings', 'routineTimes');
            if (data) {
                settings.morningStart = data.morningStart || '06:00';
                settings.eveningStart = data.eveningStart || '21:00';
            }
            updateTimeRangeDisplay();
        }

        // Add Book
        function openAddBookModal() { document.getElementById('addBookModal').classList.add('active'); document.getElementById('bookTitleInput').value = ''; document.getElementById('bookAuthorInput').value = ''; }
        function closeAddBookModal() { document.getElementById('addBookModal').classList.remove('active'); }
        async function addCustomBook() {
            const title = document.getElementById('bookTitleInput').value.trim();
            const author = document.getElementById('bookAuthorInput').value.trim();
            if (!title) { showToast('ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
            await dbPut('customBooks', { title, author, month: currentDate.getMonth() + 1, completed: false, createdAt: new Date().toISOString() });
            closeAddBookModal(); renderBookList(); showToast('æœ¬ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
        }

        // Image Upload
        document.getElementById('imageUploadArea').addEventListener('click', () => document.getElementById('imageInput').click());
        document.getElementById('imageInput').addEventListener('change', async (e) => {
            const files = Array.from(e.target.files);
            const dateKey = getDateKey();
            const data = await dbGet('images', dateKey) || { id: dateKey, images: [] };
            for (const file of files) {
                const reader = new FileReader();
                reader.onload = async (ev) => { data.images.push(ev.target.result); await dbPut('images', data); renderUploadedImages(); showToast('ç”»åƒã‚’è¿½åŠ ã—ã¾ã—ãŸ'); };
                reader.readAsDataURL(file);
            }
            e.target.value = '';
        });
        async function removeImage(index) {
            const data = await dbGet('images', getDateKey());
            if (data?.images) { data.images.splice(index, 1); await dbPut('images', data); renderUploadedImages(); showToast('ç”»åƒã‚’å‰Šé™¤ã—ã¾ã—ãŸ'); }
        }

        // Note
        let noteTimeout;
        document.getElementById('dailyNote').addEventListener('input', (e) => {
            clearTimeout(noteTimeout);
            noteTimeout = setTimeout(async () => { await dbPut('notes', { id: getDateKey(), text: e.target.value }); showToast(); }, 500);
        });

        // Navigation
        document.querySelectorAll('.nav-item').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.view).classList.add('active');
                if (btn.dataset.view === 'newsView') { renderKeywordTags(); renderNews(); }
                if (btn.dataset.view === 'planView') { renderPlanTabs(); renderFiveYearPlan(); }
            });
        });
        document.getElementById('prevDay').addEventListener('click', () => { currentDate.setDate(currentDate.getDate() - 1); renderAll(); });
        document.getElementById('nextDay').addEventListener('click', () => { currentDate.setDate(currentDate.getDate() + 1); renderAll(); });

        // ============================================
        // INIT
        // ============================================
        async function renderAll() {
            updateDateDisplay();
            updateQuote();
            updateMonthCard();
            await renderMorningHabits();
            await renderEveningHabits();
            await renderHealthGrid();
            await renderDailyNote();
            await renderUploadedImages();
            await renderWeekCalendar();
            renderWeeklyActivities();
            await renderBookList();
            await renderYearGoals();
            renderMonthTabs();
            await renderMonthGoals();
            renderPlanTabs();
            renderFiveYearPlan();
            await renderStats();
        }

        async function init() {
            try {
                updateTheme();
                await initDB();
                await loadSettings();
                await loadKeywords();
                updateDateTime();
                setInterval(updateDateTime, 1000);
                setInterval(updateTheme, 60000);
                selectedGoalMonth = currentDate.getMonth() + 1;
                await renderAll();
            } catch (error) { console.error('Init error:', error); }
        }

        init();
    </script>
</body>
</html>
